<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[颐和园 Summer Palace]]></title>
      <url>http://shenyu.wiki/2016/10/04/%E9%A2%90%E5%92%8C%E5%9B%AD/</url>
      <content type="html"><![CDATA[<blockquote>
<p>颐和园，中国清朝时期皇家园林，前身为清漪园，坐落在北京西郊，距城区十五公里，占地约二百九十公顷，与圆明园毗邻。它是以昆明湖、万寿山为基址，以杭州西湖为蓝本，汲取江南园林的设计手法而建成的一座大型山水园林，也是保存最完整的一座皇家行宫御苑，被誉为“皇家园林博物馆”，也是国家重点旅游景点。</p>
</blockquote>
<p><img src="http://static.zybuluo.com/shenyuflying/y5a04va003m6b4cwu9agky5v/2016-10-04%2012-37-23%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="昆明湖"><br>$$昆明湖$$</p>
<p>昆明湖是颐和园的主要湖泊，占全园面积的四分之三，约220公顷。南部的前湖区碧波荡漾，西望起伏、北望楼阁成群；湖中有一道西堤，堤上桃柳成行；</p>
<p><img src="http://static.zybuluo.com/shenyuflying/98ubpp8932fg35oovjeuz5e5/2016-10-04%2012-35-49%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""><br>$$十七孔桥$$<br>十七孔桥横卧湖上，湖中3岛上也有形式各异的古典建筑。昆明湖是清代皇家诸园中最大的湖泊，湖中一道长堤──西堤，自西北逶迤向南。西堤及其支堤把湖面划分为三个大小不等的水域，每个水域各有一个湖心岛。</p>
<p><img src="http://static.zybuluo.com/shenyuflying/r17fgepk5zbfc0cd5oyly2xy/2016-10-04%2012-38-18%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""><br>$$万寿山$$</p>
<p>万寿山属燕山余脉，高58.59米。建筑群依山而筑，万寿山前山，以八面三层四重檐的佛香阁为中心，组成巨大的主体建筑群。</p>
<p>2016-10-3</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[hexo静态博客修改侧边栏]]></title>
      <url>http://shenyu.wiki/2016/10/04/hexo%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2%E4%BF%AE%E6%94%B9%E4%BE%A7%E8%BE%B9%E6%A0%8F/</url>
      <content type="html"><![CDATA[<blockquote>
<p>hexo主题默认的侧边栏只有<code>首页</code>、<code>归档</code>、<code>标签</code>这几项。调研了几个比较优秀的博客之后发现，还需要添加<code>关于</code>、<code>搜索</code>、<code>阅读</code>、<code>旅行</code>等等几个侧边栏项目，那么如何在博客里面添加新的侧边栏项目呢？</p>
</blockquote>
<h2 id="添加关于、留言项目"><a href="#添加关于、留言项目" class="headerlink" title="添加关于、留言项目"></a>添加关于、留言项目</h2><p>关于、留言这两个项目实际上是利用了hexo的page页面功能。</p>
<h3 id="Step1-新建关于页面"><a href="#Step1-新建关于页面" class="headerlink" title="Step1 新建关于页面"></a>Step1 新建关于页面</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">hexo new page about</div><div class="line">INFO  Created: ~/blog/source/about/index.md</div></pre></td></tr></table></figure>
<p>打开修改为如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">title: about</div><div class="line">date: 2016-09-17 13:21:20</div><div class="line">comments: false   添加这行关闭评论</div><div class="line">---</div><div class="line">here is something about me</div></pre></td></tr></table></figure></p>
<h3 id="Step2-新建留言页面"><a href="#Step2-新建留言页面" class="headerlink" title="Step2 新建留言页面"></a>Step2 新建留言页面</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hexo new page message</div></pre></td></tr></table></figure>
<p>打开修改为如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">title: message</div><div class="line">date: 2016-09-17 13:21:20</div><div class="line">comments: true   打开评论</div><div class="line">---</div><div class="line">有事请留言</div></pre></td></tr></table></figure></p>
<h3 id="Step3-把关于、留言添加到侧边栏中"><a href="#Step3-把关于、留言添加到侧边栏中" class="headerlink" title="Step3 把关于、留言添加到侧边栏中"></a>Step3 把关于、留言添加到侧边栏中</h3><p>打开主题配置文件<code>./themes/next/_config.yml</code>，可以看到侧边栏Menu Settings有两项：<br>第一项是menu，控制侧边栏显示的项目；<br>第二项是menu_icons，控制显示项目的图标；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">menu:</div><div class="line">  home: /</div><div class="line">  books: /categories/阅读</div><div class="line">  travel: /categories/旅行</div><div class="line">  archives: /archives</div><div class="line">  tags: /tags</div><div class="line">  message: /message #添加这一行</div><div class="line">  about: /about     #添加这一行</div><div class="line"></div><div class="line">menu_icons:</div><div class="line">  enable: true</div><div class="line">  home: home</div><div class="line">  about: user     #添加这一行</div><div class="line">  categories: th</div><div class="line">  books: book</div><div class="line">  travel: plane</div><div class="line">  tags: tags</div><div class="line">  archives: archive</div><div class="line">  commonweal: heartbeat</div><div class="line">  message: comment #添加这一行</div></pre></td></tr></table></figure></p>
<p>添加我们需要的阅读、旅行两个项目。<br>然后配置项目的图标，可以参考<a href="http://fontawesome.io/icons/" target="_blank" rel="external">http://fontawesome.io/icons/</a></p>
<h3 id="Step4-生成"><a href="#Step4-生成" class="headerlink" title="Step4 生成"></a>Step4 生成</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hexo g</div></pre></td></tr></table></figure>
<p>我们看到，生成了关于、评论的页面<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/public/about/index.html</div><div class="line">/public/message/index.html</div></pre></td></tr></table></figure></p>
<h2 id="添加阅读、旅行项目"><a href="#添加阅读、旅行项目" class="headerlink" title="添加阅读、旅行项目"></a>添加阅读、旅行项目</h2><p>阅读、旅行这两个项目实际上是利用了hexo主题的categories分类功能。</p>
<h3 id="Step1-模板添加分类categories"><a href="#Step1-模板添加分类categories" class="headerlink" title="Step1  模板添加分类categories"></a>Step1  模板添加分类categories</h3><p>打开<code>./scaffolds/post.md</code>添加一行<code>categories:</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">title: &#123;&#123; title &#125;&#125;</div><div class="line">date: &#123;&#123; date &#125;&#125;</div><div class="line">tags:</div><div class="line">categories:</div><div class="line">comments: true</div><div class="line">---</div></pre></td></tr></table></figure></p>
<h3 id="Step2-把分类添加到侧边栏中"><a href="#Step2-把分类添加到侧边栏中" class="headerlink" title="Step2 把分类添加到侧边栏中"></a>Step2 把分类添加到侧边栏中</h3><p>打开主题配置文件<code>./themes/next/_config.yml</code>，可以看到侧边栏Menu Settings有两项：<br>第一项是menu，控制侧边栏显示的项目；<br>第二项是menu_icons，控制显示项目的图标；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">menu:</div><div class="line">  home: /</div><div class="line">  books: /categories/阅读</div><div class="line">  travel: /categories/旅行</div><div class="line">  archives: /archives</div><div class="line">  tags: /tags</div><div class="line">  message: /message</div><div class="line">  about: /about</div><div class="line"></div><div class="line">menu_icons:</div><div class="line">  enable: true</div><div class="line">  home: home</div><div class="line">  about: user</div><div class="line">  categories: th</div><div class="line">  books: book</div><div class="line">  travel: plane</div><div class="line">  tags: tags</div><div class="line">  archives: archive</div><div class="line">  commonweal: heartbeat</div><div class="line">  message: comment</div></pre></td></tr></table></figure></p>
<p>添加我们需要的阅读、旅行两个项目。<br>然后配置项目的图标，可以参考<a href="http://fontawesome.io/icons/" target="_blank" rel="external">http://fontawesome.io/icons/</a></p>
<h3 id="Step3-新建文章"><a href="#Step3-新建文章" class="headerlink" title="Step3 新建文章"></a>Step3 新建文章</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ hexo new &quot;我推荐的编程书籍&quot;</div><div class="line">INFO  Created: ~/blog/source/_posts/我推荐的编程书籍.md</div><div class="line">$ vim ./source/_posts/我推荐的编程书籍.md</div></pre></td></tr></table></figure>
<p>新建的文章自动添加了categories标签。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">title: 我推荐的编程书籍</div><div class="line">comments: true</div><div class="line">date: 2016-10-04 11:19:10</div><div class="line">tags: 阅读</div><div class="line">categories:</div><div class="line">---</div><div class="line">## 《代码大全》 Code Complete</div><div class="line">。。。该书籍的介绍。。。</div></pre></td></tr></table></figure></p>
<h3 id="Step4-生成-1"><a href="#Step4-生成-1" class="headerlink" title="Step4 生成"></a>Step4 生成</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hexo g</div></pre></td></tr></table></figure>
<p>我们看到，生成了书籍分类的页面index.html<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/home/yshen/blog/public/categories/书籍/index.html</div></pre></td></tr></table></figure></p>
<h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p>最后，看一下最终效果：<br><img src="http://static.zybuluo.com/shenyuflying/nsteo6fk5y9ss50gz1z22gny/side_bar.png" alt="效果图"></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[我推荐的编程书籍]]></title>
      <url>http://shenyu.wiki/2016/10/04/%E6%88%91%E6%8E%A8%E8%8D%90%E7%9A%84%E7%BC%96%E7%A8%8B%E4%B9%A6%E7%B1%8D/</url>
      <content type="html"><![CDATA[<h2 id="代码大全-Code-Complete"><a href="#代码大全-Code-Complete" class="headerlink" title="代码大全 Code Complete"></a>代码大全 Code Complete</h2><p>这里是评论。。。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[wget下载网站供离线浏览]]></title>
      <url>http://shenyu.wiki/2016/10/02/wget%E4%B8%8B%E8%BD%BD%E7%BD%91%E7%AB%99%E4%BE%9B%E7%A6%BB%E7%BA%BF%E6%B5%8F%E8%A7%88/</url>
      <content type="html"><![CDATA[<blockquote>
<p>我们经常使用wget命令来下载文件，那么能不能使用wget来下载整个网站呢？</p>
</blockquote>
<p>看wget的man说明，可以发现wget有几个特点：</p>
<ol>
<li>非交互式，可以工作在后台。</li>
<li>可以追踪html中的链接，在下载过程中把连接自动转换为本地路径，从而创建本地网站镜像。</li>
<li>健壮性高，在失败之后会不断尝试，支持断线重连。</li>
</ol>
<p>发现wget果然强大，有网站下载这个功能，而且还可以控制网站下载的方式，下面就是wget进行网站下载的命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$ wget \</div><div class="line">     --recursive \</div><div class="line">     --no-clobber \</div><div class="line">     --page-requisites \</div><div class="line">     --html-extension \</div><div class="line">     --convert-links \</div><div class="line">     --restrict-file-names=windows \</div><div class="line">     --domains shenyu.wiki \</div><div class="line">     --no-parent \</div><div class="line">         shenyu.wiki</div></pre></td></tr></table></figure>
<p>上面的命令会下载 <a href="http://www.shenyu.wiki" target="_blank" rel="external">http://www.shenyu.wiki</a> 下面所有的页面。</p>
<p>上面用到的wget网站下载选择解释：</p>
<pre><code>--recursive: 下载整个网站
--domains shenyu.wiki: 不要下载指定域名之外的网页。
--no-parent: 仅仅下载当前目录结构下的文件。
--page-requisites: 现在网页包括的所有内容(images, CSS and so on).
--html-extension: 将网页保存为html文件。
--convert-links: 将连接转换为本地连接
--restrict-file-names=unix: 文件名保存为unix格式,如果是要保存windows格式的，这里写成windows
--no-clobber: 不要覆盖已有文件，在下载中断后继续下载。
</code></pre><p>下载完成之后，生成了<code>shenyu.wiki</code>文件夹，进去可以看到该网站的内容都下载好了。可以打开index.html文件来离线浏览网站。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ ll</div><div class="line">total 220</div><div class="line">drwxr-xr-x 6 yshen yshen   4096 10月  2 16:41 ./</div><div class="line">drwxr-xr-x 3 yshen yshen   4096 10月  2 16:41 ../</div><div class="line">drwxr-xr-x 4 yshen yshen   4096 10月  2 16:41 2016/</div><div class="line">-rw-r--r-- 1 yshen yshen  21632 10月  2 13:08 about.html</div><div class="line">-rw-r--r-- 1 yshen yshen  27364 10月  2 13:08 archives.html</div><div class="line">drwxr-xr-x 2 yshen yshen   4096 10月  2 16:41 css/</div><div class="line">-rw-r--r-- 1 yshen yshen 101642 10月  2 13:08 index.html</div><div class="line">-rw-r--r-- 1 yshen yshen  19836 10月  2 13:08 message.html</div><div class="line">-rw-r--r-- 1 yshen yshen  20598 10月  2 13:08 tags.html</div><div class="line">drwxr-xr-x 2 yshen yshen   4096 10月  2 16:41 uploads/</div><div class="line">drwxr-xr-x 4 yshen yshen   4096 10月  2 16:41 vendors/</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[二进制文件 十六进制文件 互转]]></title>
      <url>http://shenyu.wiki/2016/10/02/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6-%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6-%E4%BA%92%E8%BD%AC/</url>
      <content type="html"><![CDATA[<blockquote>
<p>二进制文件用文本方式打开之后都是乱码，如何把二进制转为十六进制呢？如下一个小程序实现了二进制和十六进制相互转换。转换为十六进制之后就可以以0-9，a-f显示出来，方便阅读和以字符串形式发送。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"># 编译</div><div class="line">$ gcc c2bs.c -o c2bs</div><div class="line"></div><div class="line"># 帮助</div><div class="line">$ ./c2bs2</div><div class="line">convert to binary or strings.</div><div class="line">will read from stdin and write to stdout</div><div class="line">usage: ./c2bs2 [options]</div><div class="line">[options]</div><div class="line">    -b convert to binary</div><div class="line">    -s convert to string</div><div class="line"></div><div class="line"># 二进制可执行文件转16进制字符串</div><div class="line">$ cat ./c2bs | ./c2bs -c &gt; c2bs.hex </div><div class="line">$ head c2bs.hex</div><div class="line">7f454c4602010100000000000000000002003e000100000020064000000000004000000000000000a0110000000000000000000040003800090040001e001b000600000005000000400000000000000040004000000000004000400000000000f801000000000000f8010000000...</div><div class="line"></div><div class="line"># 十六进制字符串再转回到二进制</div><div class="line">$ cat ./c2bs.hex | ./c2bs -b &gt; c2bs</div></pre></td></tr></table></figure>
<p> 源码如下，需要注意的是，都用了不带符号的unsigned char类型，这个很关键，想想为什么？</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[])</span></span></div><div class="line">&#123;</div><div class="line"></div><div class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> in;</div><div class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> talbe[<span class="string">'f'</span>+<span class="number">1</span>];</div><div class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> in_2[<span class="number">3</span>]=&#123;<span class="number">0</span>&#125;;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (argc == <span class="number">1</span>)</div><div class="line">	&#123;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"convert to binary or strings.\n"</span>);</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"will read from stdin and write to stdout\n"</span>);</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"usage: %s [options]\n"</span></div><div class="line">			<span class="string">"[options]\n"</span></div><div class="line">			<span class="string">"    -b convert to binary\n"</span></div><div class="line">			<span class="string">"    -s convert to string\n"</span>,argv[<span class="number">0</span>]);</div><div class="line">		<span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line"></div><div class="line">	&#125;</div><div class="line">	<span class="keyword">switch</span>(argv[<span class="number">1</span>][<span class="number">1</span>])</div><div class="line">	&#123;</div><div class="line"></div><div class="line">		<span class="keyword">case</span> <span class="string">'s'</span>:</div><div class="line">			<span class="keyword">while</span>( fread(&amp;in,<span class="keyword">sizeof</span>(<span class="keyword">char</span>),<span class="number">1</span>,<span class="built_in">stdin</span>) &gt; <span class="number">0</span>)</div><div class="line">			&#123;</div><div class="line">				<span class="built_in">fprintf</span>(<span class="built_in">stdout</span>,<span class="string">"%02x"</span>,in);</div><div class="line">			&#125;</div><div class="line"></div><div class="line">		<span class="keyword">break</span>;</div><div class="line">		</div><div class="line">		<span class="keyword">case</span> <span class="string">'b'</span>:</div><div class="line"></div><div class="line">			talbe[<span class="string">'0'</span>]=<span class="number">0</span>;	</div><div class="line">			talbe[<span class="string">'1'</span>]=<span class="number">1</span>;	</div><div class="line">			talbe[<span class="string">'2'</span>]=<span class="number">2</span>;	</div><div class="line">			talbe[<span class="string">'3'</span>]=<span class="number">3</span>;	</div><div class="line">			talbe[<span class="string">'4'</span>]=<span class="number">4</span>;	</div><div class="line">			talbe[<span class="string">'5'</span>]=<span class="number">5</span>;	</div><div class="line">			talbe[<span class="string">'6'</span>]=<span class="number">6</span>;	</div><div class="line">			talbe[<span class="string">'7'</span>]=<span class="number">7</span>;	</div><div class="line">			talbe[<span class="string">'8'</span>]=<span class="number">8</span>;	</div><div class="line">			talbe[<span class="string">'9'</span>]=<span class="number">9</span>;	</div><div class="line">			talbe[<span class="string">'a'</span>]=<span class="number">10</span>;	</div><div class="line">			talbe[<span class="string">'b'</span>]=<span class="number">11</span>;	</div><div class="line">			talbe[<span class="string">'c'</span>]=<span class="number">12</span>;	</div><div class="line">			talbe[<span class="string">'d'</span>]=<span class="number">13</span>;	</div><div class="line">			talbe[<span class="string">'e'</span>]=<span class="number">14</span>;	</div><div class="line">			talbe[<span class="string">'f'</span>]=<span class="number">15</span>;	</div><div class="line">			<span class="keyword">while</span>( fread(in_2,<span class="keyword">sizeof</span>(<span class="keyword">char</span>)*<span class="number">2</span>,<span class="number">1</span>,<span class="built_in">stdin</span>) &gt; <span class="number">0</span>)</div><div class="line">			&#123;</div><div class="line">				<span class="keyword">unsigned</span> <span class="keyword">char</span> out;</div><div class="line">				out = <span class="number">16</span>*talbe[in_2[<span class="number">0</span>]] + talbe[in_2[<span class="number">1</span>]]; </div><div class="line">				<span class="built_in">fprintf</span>(<span class="built_in">stdout</span>,<span class="string">"%c"</span>,out);</div><div class="line">			&#125;</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	</div><div class="line">		<span class="keyword">default</span>:</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"unknown parameter %s"</span>,argv[<span class="number">1</span>]);</div><div class="line">		<span class="keyword">break</span>;</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[PostgreSQL count(*) 优化]]></title>
      <url>http://shenyu.wiki/2016/10/02/PostgreSQL-count-%E4%BC%98%E5%8C%96/</url>
      <content type="html"><![CDATA[<p>在PostgreSQL数据库中，count(<em>)默认是全表扫描，那么对于数据量很大的表，因为需要把表的所有页面读入到内存，需要较多IO，耗费的时间很长。在很多应用中，需要频繁的count(</em>)来统计行数，那么在此类应用中如何优化count(*)的效率呢？</p>
<h2 id="建立一个表"><a href="#建立一个表" class="headerlink" title="建立一个表"></a>建立一个表</h2><p>我们先建立一个100万行的表，来做实验。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">postgres=# create table tb ( a int, b text);</div><div class="line">CREATE TABLE</div><div class="line">postgres=# insert into tb values ( generate_series(1,1000000), 'xxxxxx');</div><div class="line">INSERT 0 1000000</div><div class="line">postgres=# select count(*) from tb;</div><div class="line">  count  </div><div class="line">---------</div><div class="line"> 1000000</div><div class="line">(1 row)</div><div class="line">Time: 652.431 ms</div></pre></td></tr></table></figure>
<p>实际执行下来，花费时间是652ms<br>下面我们来看一下执行计划</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">postgres=# explain select count(*) from tb;</div><div class="line">                            QUERY PLAN                            </div><div class="line">------------------------------------------------------------------</div><div class="line"> Aggregate  (cost=17906.00..17906.01 rows=1 width=0)</div><div class="line">   -&gt;  Seq Scan on tb  (cost=0.00..15406.00 rows=1000000 width=0)</div><div class="line">(2 rows)</div></pre></td></tr></table></figure>
<p>可以看到，count(*)是采用顺序扫描的执行计划。</p>
<h2 id="analyze会不会有改善？"><a href="#analyze会不会有改善？" class="headerlink" title="analyze会不会有改善？"></a>analyze会不会有改善？</h2><p>那么analyze会不会起作用呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">postgres=# analyze tb;</div><div class="line">ANALYZE</div><div class="line">Time: 201.853 ms</div><div class="line">postgres=# select count(*) from tb;</div><div class="line">  count  </div><div class="line">---------</div><div class="line"> 1000000</div><div class="line">(1 row)</div><div class="line">Time: 649.252 ms</div></pre></td></tr></table></figure>
<p>可以看到analyze基本没什么作用。</p>
<h2 id="主键会不会有改善？"><a href="#主键会不会有改善？" class="headerlink" title="主键会不会有改善？"></a>主键会不会有改善？</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">postgres=# alter table tb add  primary key(a);</div><div class="line">ALTER TABLE</div><div class="line">Time: 2353.671 ms</div><div class="line">postgres=# select count(*) from tb;</div><div class="line">  count  </div><div class="line">---------</div><div class="line"> 1000000</div><div class="line">(1 row)</div><div class="line"></div><div class="line">Time: 654.886 ms</div><div class="line">postgres=# alter table tb add  primary key(a);</div><div class="line">ERROR:  multiple primary keys for table &quot;tb&quot; are not allowed</div><div class="line">Time: 1.603 ms</div><div class="line">postgres=# explain select count(*) from tb;</div><div class="line">                            QUERY PLAN                            </div><div class="line">------------------------------------------------------------------</div><div class="line"> Aggregate  (cost=17906.00..17906.01 rows=1 width=0)</div><div class="line">   -&gt;  Seq Scan on tb  (cost=0.00..15406.00 rows=1000000 width=0)</div><div class="line">(2 rows)</div><div class="line"></div><div class="line">Time: 1.246 ms</div></pre></td></tr></table></figure>
<p>可以看到，加了索引之后还是在走顺序扫描，时间没有什么改善。</p>
<h2 id="索引会不会有改善？"><a href="#索引会不会有改善？" class="headerlink" title="索引会不会有改善？"></a>索引会不会有改善？</h2><p>那么建立一个索引有没有作用？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">postgres=# create index tb_idx on tb(a);</div><div class="line">CREATE INDEX</div><div class="line">Time: 2009.193 ms</div><div class="line">postgres=# select count(*) from tb;</div><div class="line">  count  </div><div class="line">---------</div><div class="line"> 1000000</div><div class="line">(1 row)</div><div class="line"></div><div class="line">Time: 654.997 ms</div><div class="line">postgres=# explain select count(*) from tb;</div><div class="line">                            QUERY PLAN                            </div><div class="line">------------------------------------------------------------------</div><div class="line"> Aggregate  (cost=17906.00..17906.01 rows=1 width=0)</div><div class="line">   -&gt;  Seq Scan on tb  (cost=0.00..15406.00 rows=1000000 width=0)</div><div class="line">(2 rows)</div></pre></td></tr></table></figure>
<p>可以看到，建立了索引之后，时间依然没有明显改善，查看执行计划，可以看到依然是走的顺序扫描。<br>为什么不走索引呢？我们把顺序扫描关闭之后。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">postgres=# set enable_seqscan = off;</div><div class="line">SET</div><div class="line">postgres=# explain (analyze,buffers) select count(*) from tb;</div><div class="line">                              QUERY PLAN                     </div><div class="line">                                           </div><div class="line">----------------------------------------------------------------------</div><div class="line"> Aggregate  (cost=33889.43..33889.44 rows=1 width=0) (actual time=1968.386..1968.387 rows=1 loo</div><div class="line">ps=1)</div><div class="line">   Buffers: shared hit=8141</div><div class="line">   -&gt;  Index Only Scan using tb_pkey on tb  (cost=0.42..31389.42 rows=1000000 width=0) (actual </div><div class="line">time=0.073..1542.385 rows=1000000 loops=1)</div><div class="line">         Heap Fetches: 1000000</div><div class="line">         Buffers: shared hit=8141</div><div class="line"> Planning time: 0.203 ms</div><div class="line"> Execution time: 1968.514 ms</div><div class="line">(7 rows)</div><div class="line">Time: 1969.929 ms</div></pre></td></tr></table></figure></p>
<p>顺序扫描之后看到时间反而变多了！查看执行计划可以看到，用的是Index Only Scan，读取到的页面是8141，而且还要读Heap上的100万条数据来查看事务信息，所以在该例子中采用索引扫描并不能有多大提升。</p>
<h2 id="优化方法——建触发器"><a href="#优化方法——建触发器" class="headerlink" title="优化方法——建触发器"></a>优化方法——建触发器</h2><p>如果这个表更新不那么频繁，可以建一个表用来缓存count的结果，再建一个触发器来更新缓存表。查的时候，查缓存count的那个表。<br>举个例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--建立count缓存表</span></div><div class="line"> <span class="keyword">create</span> <span class="keyword">table</span> tb_count(<span class="keyword">col</span> <span class="built_in">int</span>);</div><div class="line"><span class="comment">--初始化count缓存表</span></div><div class="line"> <span class="keyword">insert</span> <span class="keyword">into</span> tb_count ( <span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> tb);</div><div class="line"><span class="comment">--创建更新函数</span></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">FUNCTION</span> tb_func()  <span class="keyword">RETURNS</span> <span class="keyword">TRIGGER</span> <span class="keyword">AS</span> $$</div><div class="line">        <span class="keyword">BEGIN</span></div><div class="line">                <span class="keyword">update</span>  tb_count  <span class="keyword">set</span> <span class="keyword">col</span> = <span class="keyword">col</span> + <span class="number">1</span>;</div><div class="line">                RETURN null;</div><div class="line">        <span class="keyword">END</span>;</div><div class="line">$$ LANGUAGE plpgsql; </div><div class="line"><span class="comment">--创建触发器</span></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> tb_insert</div><div class="line">    <span class="keyword">AFTER</span> <span class="keyword">INSERT</span> <span class="keyword">ON</span> tb</div><div class="line">    <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span></div><div class="line">    <span class="keyword">EXECUTE</span> <span class="keyword">PROCEDURE</span> tb_func();</div><div class="line">    </div><div class="line"><span class="comment">--类似的创建对于如下2个的触发器</span></div><div class="line">    <span class="keyword">DELETE</span></div><div class="line">    <span class="keyword">TRUNCATE</span></div></pre></td></tr></table></figure>
<p>下面我们来看一下，优化之后的效率：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">postgres=# select count(*) from tb;</div><div class="line">  count  </div><div class="line">---------</div><div class="line"> 1000001</div><div class="line">(1 row)</div><div class="line"></div><div class="line">Time: 898.974 ms</div><div class="line">postgres=# select * from tb_count;</div><div class="line">   col   </div><div class="line">---------</div><div class="line"> 1000001</div><div class="line">(1 row)</div><div class="line"></div><div class="line">Time: 2.463 ms</div><div class="line">postgres=#</div></pre></td></tr></table></figure>
<p>可以看到，优化之后时间从原来的898ms降低为2ms。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Here Document]]></title>
      <url>http://shenyu.wiki/2016/10/02/Here-Document/</url>
      <content type="html"><![CDATA[<p>我们经常需要在shell中新建文件并输入内容，通常的做法有2种。<br>第一种： 用vim打开一个文件，输入内容，保存并退出。<br>第二种： 用echo输出重定向：echo “hello world” &gt; a.out。<br>但是这两种方法都有一定弊端，比如第一种无法在shell脚本里面实现往文件中输入内容。第二种，无法输入多行内容。<br>如果我们需要在shell脚本中对文件中输入多行内容，这时候我们Here Document就派上用场了。</p>
<h2 id="什么是Here-Document"><a href="#什么是Here-Document" class="headerlink" title="什么是Here Document?"></a>什么是Here Document?</h2><p>Here Document 是在Linux Shell 中的一种特殊的重定向方式，它的基本的形式如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cmd &lt;&lt; delimiter</div><div class="line">  Here Document Content</div><div class="line">delimiter</div></pre></td></tr></table></figure></p>
<p>它的作用就是将两个 delimiter 之间的内容(Here Document Content 部分) 传递给cmd 作为输入参数。</p>
<h2 id="在shell脚本中对文件输入多行内容"><a href="#在shell脚本中对文件输入多行内容" class="headerlink" title="在shell脚本中对文件输入多行内容"></a>在shell脚本中对文件输入多行内容</h2><p>基本方法是用here document把输入重定向给cat然后输出重定向到a.out文件。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">yshen@yshen-ThinkPad-X201 ~ $ cat &lt;&lt;EOF &gt; a.out</div><div class="line">&gt; this is line1</div><div class="line">&gt; this is line2</div><div class="line">&gt; this is line3</div><div class="line">&gt; ...</div><div class="line">&gt; this is lineN</div><div class="line">&gt; EOF</div><div class="line">yshen@yshen-ThinkPad-X201 ~ $ cat a.out </div><div class="line">this is line1</div><div class="line">this is line2</div><div class="line">this is line3</div><div class="line">...</div><div class="line">this is lineN</div></pre></td></tr></table></figure></p>
<p>这样，我们就使用Here Document在shell脚本中完成了多行文本的输入。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[贪吃蛇-基于SDL]]></title>
      <url>http://shenyu.wiki/2016/09/17/%E8%B4%AA%E5%90%83%E8%9B%87-%E5%9F%BA%E4%BA%8ESDL/</url>
      <content type="html"><![CDATA[<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>贪吃蛇不用多说了吧，就是一条蛇吃水果，吃一个他的长度就加１。</p>
<h2 id="无图无真相"><a href="#无图无真相" class="headerlink" title="无图无真相"></a>无图无真相</h2><p><img src="/uploads/snake.png" alt="tup"></p>
<p>目前只是先实现了基本的功能，移动，长度加１。还没有实现碰撞检测的功能。</p>
<a id="more"></a>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;SDL2/SDL.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;SDL2/SDL_image.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> bool int</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> true 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> false 0</span></div><div class="line"></div><div class="line"><span class="comment">//Screen dimension constants</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SCREEN_WIDTH   640</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SCREEN_HEIGHT   480</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BOX_SIZE   20</span></div><div class="line"></div><div class="line"><span class="comment">//the map grid</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BOX_WIDTH SCREEN_WIDTH/BOX_SIZE</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BOX_HEIGHT   SCREEN_HEIGHT/BOX_SIZE</span></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="number">_</span>game &#123;</div><div class="line">	<span class="keyword">bool</span> (*init) (<span class="keyword">struct</span> <span class="number">_</span>game * self);</div><div class="line">	<span class="keyword">bool</span> (*handle_events)(<span class="keyword">struct</span> <span class="number">_</span>game * self);</div><div class="line">	<span class="keyword">bool</span> (*update)(<span class="keyword">struct</span> <span class="number">_</span>game * self);</div><div class="line">	<span class="keyword">bool</span> (*render)(<span class="keyword">struct</span> <span class="number">_</span>game * self);</div><div class="line">	<span class="keyword">bool</span> (*close)(<span class="keyword">struct</span> <span class="number">_</span>game * self);</div><div class="line"></div><div class="line">	<span class="comment">//The window we'll be rendering to</span></div><div class="line">	SDL_Window* gWindow;</div><div class="line"></div><div class="line">	<span class="comment">//The window renderer</span></div><div class="line">	SDL_Renderer* gRenderer;</div><div class="line"></div><div class="line">	<span class="comment">//Event handler</span></div><div class="line">	SDL_Event e;</div><div class="line"></div><div class="line">	<span class="comment">//if want to quit</span></div><div class="line">	<span class="keyword">bool</span> quit;</div><div class="line"></div><div class="line">	<span class="comment">//if key pressed and need update the screen</span></div><div class="line">	<span class="keyword">bool</span> need_update;</div><div class="line"></div><div class="line">	<span class="comment">// use to draw a snake</span></div><div class="line">	<span class="keyword">int</span> path[BOX_WIDTH][BOX_HEIGHT];</div><div class="line">	<span class="keyword">int</span> head_x,head_y;</div><div class="line">	<span class="keyword">int</span> tail_x,tail_y;</div><div class="line"></div><div class="line">	<span class="comment">// use to draw the fruit</span></div><div class="line">	<span class="keyword">int</span> fruit_x,fruit_y;</div><div class="line">	<span class="keyword">int</span> fruit_need_update;</div><div class="line"></div><div class="line">	<span class="comment">// counter for each node used to find the tail</span></div><div class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> counter;</div><div class="line">	</div><div class="line">&#125; GameData, * Game;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="number">_</span>color &#123;</div><div class="line">	Uint8 r;</div><div class="line">	Uint8 g;</div><div class="line">	Uint8 b;</div><div class="line">	Uint8 a;</div><div class="line">&#125; Color;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">init</span><span class="params">(<span class="keyword">struct</span> <span class="number">_</span>game * self)</span></span>;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">handle_events</span><span class="params">(<span class="keyword">struct</span> <span class="number">_</span>game * self)</span></span>;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">update</span><span class="params">(<span class="keyword">struct</span> <span class="number">_</span>game * self)</span></span>;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">render</span><span class="params">(<span class="keyword">struct</span> <span class="number">_</span>game * self)</span></span>;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">render_draw_solid_rec</span><span class="params">(Game self,<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> w, <span class="keyword">int</span> h, Color c)</span></span>;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">render_draw_empty_rec</span><span class="params">(Game self,<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> w, <span class="keyword">int</span> h, Color c)</span></span>;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">render_draw_line</span><span class="params">(Game self,<span class="keyword">int</span> x1, <span class="keyword">int</span> y1, <span class="keyword">int</span> x2, <span class="keyword">int</span> y2, Color c)</span></span>;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">close</span><span class="params">(<span class="keyword">struct</span> <span class="number">_</span>game * self)</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">get_count</span><span class="params">(<span class="keyword">struct</span> <span class="number">_</span>game *self)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">return</span> self-&gt;counter++;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> newGame(game)\</span></div><div class="line">	(Game) malloc(sizeof(GameData)); \</div><div class="line">	game-&gt;init=init;\</div><div class="line">	game-&gt;handle_events=handle_events;\</div><div class="line">	game-&gt;update=update;\</div><div class="line">	game-&gt;render=render;\</div><div class="line">	game-&gt;close=close;\</div><div class="line">	game-&gt;gWindow=NULL;\</div><div class="line">	game-&gt;gRenderer=NULL;\</div><div class="line">	game-&gt;quit=false;\</div><div class="line">	game-&gt;need_update=false;\</div><div class="line">	game-&gt;length=3;\</div><div class="line">	memset(game-&gt;path,0,sizeof(game-&gt;path));\</div><div class="line">	game-&gt;counter=1;\</div><div class="line">	game-&gt;path[10][11]=get_count(game);\</div><div class="line">	game-&gt;path[10][12]=get_count(game);\</div><div class="line">	game-&gt;head_x=10;game-&gt;head_y=12;\</div><div class="line">	game-&gt;tail_x=10;game-&gt;tail_y=11;\</div><div class="line">	game-&gt;fruit_x=rand()%BOX_WIDTH;game-&gt;fruit_y=rand()%BOX_HEIGHT;\</div><div class="line">	game-&gt;fruit_need_update=false;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> have_fruit()\</span></div><div class="line">	(self-&gt;fruit_x!=-1 &amp;&amp; self-&gt;fruit_y!=-1)</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> fruit_need_update()\</span></div><div class="line">	(self-&gt;fruit_need_update)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">init</span><span class="params">(Game self)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="comment">//Initialization flag</span></div><div class="line">	<span class="keyword">bool</span> success = <span class="literal">true</span>;</div><div class="line"></div><div class="line">	<span class="comment">//Initialize SDL</span></div><div class="line">	<span class="keyword">if</span>( SDL_Init( SDL_INIT_VIDEO ) &lt; <span class="number">0</span> )</div><div class="line">	&#123;</div><div class="line">		<span class="built_in">printf</span>( <span class="string">"SDL could not initialize! SDL Error: %s\n"</span>, SDL_GetError() );</div><div class="line">		success = <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span></div><div class="line">	&#123;</div><div class="line">		<span class="comment">//Set texture filtering to linear</span></div><div class="line">		<span class="keyword">if</span>( !SDL_SetHint( SDL_HINT_RENDER_SCALE_QUALITY, <span class="string">"1"</span> ) )</div><div class="line">		&#123;</div><div class="line">			<span class="built_in">printf</span>( <span class="string">"Warning: Linear texture filtering not enabled!"</span> );</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="comment">//Create window</span></div><div class="line">		self-&gt;gWindow = SDL_CreateWindow( <span class="string">"Snake"</span>, SDL_WINDOWPOS_UNDEFINED, SDL_WINDOWPOS_UNDEFINED, SCREEN_WIDTH, SCREEN_HEIGHT, SDL_WINDOW_SHOWN );</div><div class="line">		<span class="keyword">if</span>( self-&gt;gWindow == <span class="literal">NULL</span> )</div><div class="line">		&#123;</div><div class="line">			<span class="built_in">printf</span>( <span class="string">"Window could not be created! SDL Error: %s\n"</span>, SDL_GetError() );</div><div class="line">			success = <span class="literal">false</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span></div><div class="line">		&#123;</div><div class="line">			<span class="comment">//Create renderer for window</span></div><div class="line">			self-&gt;gRenderer = SDL_CreateRenderer( self-&gt;gWindow, <span class="number">-1</span>, SDL_RENDERER_ACCELERATED );</div><div class="line">			<span class="keyword">if</span>(self-&gt;gRenderer == <span class="literal">NULL</span> )</div><div class="line">			&#123;</div><div class="line">				<span class="built_in">printf</span>( <span class="string">"Renderer could not be created! SDL Error: %s\n"</span>, SDL_GetError() );</div><div class="line">				success = <span class="literal">false</span>;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">else</span></div><div class="line">			&#123;</div><div class="line">				<span class="comment">//Initialize renderer color</span></div><div class="line">				SDL_SetRenderDrawColor( self-&gt;gRenderer, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span> );</div><div class="line"></div><div class="line">				<span class="comment">//Initialize PNG loading</span></div><div class="line">				<span class="keyword">int</span> imgFlags = IMG_INIT_PNG;</div><div class="line">				<span class="keyword">if</span>( !( IMG_Init( imgFlags ) &amp; imgFlags ) )</div><div class="line">				&#123;</div><div class="line">					<span class="built_in">printf</span>( <span class="string">"SDL_image could not initialize! SDL_image Error: %s\n"</span>, IMG_GetError() );</div><div class="line">					success = <span class="literal">false</span>;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> success;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">handle_events</span><span class="params">(Game self)</span></span></div><div class="line">&#123;</div><div class="line"></div><div class="line">	<span class="comment">//Handle events on queue</span></div><div class="line">	<span class="keyword">while</span>( SDL_PollEvent( &amp;(self-&gt;e) ) != <span class="number">0</span> )</div><div class="line">	&#123;</div><div class="line">		<span class="comment">//User requests quit</span></div><div class="line">		<span class="keyword">if</span>( self-&gt;e.type == SDL_QUIT )</div><div class="line">		&#123;</div><div class="line">			self-&gt;quit = <span class="literal">true</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="comment">//User presses a key</span></div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>( self-&gt;e.type == SDL_KEYDOWN )</div><div class="line">        &#123;</div><div class="line">			<span class="comment">//Select surfaces based on key press</span></div><div class="line">            <span class="keyword">switch</span>( self-&gt;e.key.keysym.sym )</div><div class="line">             &#123;</div><div class="line">                  <span class="keyword">case</span> SDLK_UP:</div><div class="line">				  	<span class="keyword">if</span> (self-&gt;head_y<span class="number">-1</span>!=<span class="number">-1</span>&amp;&amp; !self-&gt;path[self-&gt;head_x][self-&gt;head_y<span class="number">-1</span>])</div><div class="line">				  	&#123;</div><div class="line">		                self-&gt;head_y--;	</div><div class="line">						self-&gt;need_update=<span class="literal">true</span>;</div><div class="line">				  	&#125;</div><div class="line">                  <span class="keyword">break</span>;</div><div class="line"></div><div class="line">                  <span class="keyword">case</span> SDLK_DOWN:</div><div class="line">				  	<span class="keyword">if</span> (self-&gt;head_y+<span class="number">1</span>!=BOX_HEIGHT &amp;&amp; !self-&gt;path[self-&gt;head_x][self-&gt;head_y+<span class="number">1</span>])</div><div class="line">				  	&#123;				  	</div><div class="line">	                 	self-&gt;head_y++;</div><div class="line">						self-&gt;need_update=<span class="literal">true</span>;</div><div class="line">			  		&#125;</div><div class="line">                  <span class="keyword">break</span>;</div><div class="line"></div><div class="line">                  <span class="keyword">case</span> SDLK_LEFT:</div><div class="line">				  	<span class="keyword">if</span> (self-&gt;head_x<span class="number">-1</span>!=<span class="number">-1</span> &amp;&amp; !self-&gt;path[self-&gt;head_x<span class="number">-1</span>][self-&gt;head_y])</div><div class="line">				  	&#123;	</div><div class="line">						self-&gt;head_x--;	</div><div class="line">						self-&gt;need_update=<span class="literal">true</span>;</div><div class="line">				  	&#125;</div><div class="line">				  <span class="keyword">break</span>;</div><div class="line"></div><div class="line">                  <span class="keyword">case</span> SDLK_RIGHT:</div><div class="line">				  	<span class="keyword">if</span> (self-&gt;head_x+<span class="number">1</span>!=BOX_WIDTH &amp;&amp; !self-&gt;path[self-&gt;head_x+<span class="number">1</span>][self-&gt;head_y])</div><div class="line">				  	&#123;	</div><div class="line">	                     self-&gt;head_x++;</div><div class="line">						 self-&gt;need_update=<span class="literal">true</span>;</div><div class="line">				  	&#125;</div><div class="line">                  <span class="keyword">break</span>;</div><div class="line"></div><div class="line">              &#125;</div><div class="line"></div><div class="line">		&#125;</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">update</span><span class="params">(Game self)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> i,j;</div><div class="line">	<span class="keyword">if</span>(self-&gt;need_update)</div><div class="line">	&#123;</div><div class="line">		<span class="comment">// the head always have the biggest number</span></div><div class="line">		self-&gt;path[self-&gt;head_x][self-&gt;head_y]=get_count(self);</div><div class="line"></div><div class="line">		<span class="comment">// if head reach fruit, tail don't move</span></div><div class="line">		<span class="keyword">if</span> (self-&gt;head_x == self-&gt;fruit_x &amp;&amp; self-&gt;head_y == self-&gt;fruit_y)</div><div class="line">		&#123;</div><div class="line">			self-&gt;fruit_need_update = <span class="literal">true</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span> <span class="comment">//the head missed fruit, need move</span></div><div class="line">		&#123;</div><div class="line">			<span class="keyword">unsigned</span> <span class="keyword">int</span> max;</div><div class="line">			<span class="comment">//mark the tail as invisible</span></div><div class="line">			self-&gt;path[self-&gt;tail_x][self-&gt;tail_y]=<span class="number">0</span>;</div><div class="line"></div><div class="line">			<span class="comment">//find new tail, shall be min</span></div><div class="line">			max=self-&gt;path[self-&gt;head_x][self-&gt;head_y];</div><div class="line">			<span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;BOX_WIDTH;i++)</div><div class="line">			<span class="keyword">for</span> (j=<span class="number">0</span>;j&lt;BOX_HEIGHT;j++)</div><div class="line">			&#123;</div><div class="line">				<span class="keyword">if</span> (self-&gt;path[i][j]!=<span class="number">0</span> &amp;&amp; self-&gt;path[i][j] &lt; max)</div><div class="line">				&#123;</div><div class="line">					self-&gt;tail_x=i;</div><div class="line">					self-&gt;tail_y=j;</div><div class="line">					max = self-&gt;path[i][j];</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line"></div><div class="line">		&#125;</div><div class="line">		self-&gt;need_update=<span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line"></div><div class="line">	<span class="keyword">if</span> (have_fruit()&amp;&amp;fruit_need_update())</div><div class="line">	&#123;</div><div class="line">		self-&gt;fruit_x=rand()%BOX_WIDTH;</div><div class="line">		self-&gt;fruit_y=rand()%BOX_HEIGHT;</div><div class="line">		self-&gt;fruit_need_update=<span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line"></div><div class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">render</span><span class="params">(Game self)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> i,j;</div><div class="line">	</div><div class="line">	<span class="comment">//Clear screen</span></div><div class="line">	SDL_SetRenderDrawColor( self-&gt;gRenderer, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span> );</div><div class="line">	SDL_RenderClear( self-&gt;gRenderer );</div><div class="line"></div><div class="line">	<span class="comment">//do the drawing...</span></div><div class="line"></div><div class="line">	<span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;BOX_WIDTH;i++)</div><div class="line">	<span class="keyword">for</span> (j=<span class="number">0</span>;j&lt;BOX_HEIGHT;j++)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span> (self-&gt;path[i][j])</div><div class="line">		&#123;</div><div class="line">			Color c = &#123;<span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xFF</span> &#125;;</div><div class="line">			render_draw_solid_rec(self,i*BOX_SIZE,j*BOX_SIZE,BOX_SIZE,BOX_SIZE,c);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (have_fruit())</div><div class="line">	&#123;</div><div class="line">		Color c = &#123;<span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0xFF</span> &#125;;</div><div class="line">		render_draw_solid_rec(self,self-&gt;fruit_x*BOX_SIZE,self-&gt;fruit_y*BOX_SIZE,BOX_SIZE,BOX_SIZE,c);</div><div class="line">	&#125;</div><div class="line">		</div><div class="line">	SDL_RenderPresent( self-&gt;gRenderer );</div><div class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">close</span><span class="params">(Game self)</span></span></div><div class="line">&#123;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">render_draw_solid_rec</span><span class="params">(Game self,<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> w, <span class="keyword">int</span> h, Color c)</span></span></div><div class="line">&#123;</div><div class="line">	SDL_Rect fillRect = &#123; x,y,w,h &#125;;</div><div class="line">	SDL_SetRenderDrawColor( self-&gt;gRenderer, c.r, c.g, c.b, c.a );		</div><div class="line">	SDL_RenderFillRect( self-&gt;gRenderer, &amp;fillRect );</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">render_draw_empty_rec</span><span class="params">(Game self,<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> w, <span class="keyword">int</span> h, Color c)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="comment">//Render green outlined quad</span></div><div class="line">	SDL_Rect outlineRect = &#123; x,y,w,h&#125;;</div><div class="line">	SDL_SetRenderDrawColor( self-&gt;gRenderer, c.r, c.g, c.b, c.a );	</div><div class="line">	SDL_RenderDrawRect( self-&gt;gRenderer, &amp;outlineRect );</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">render_draw_line</span><span class="params">(Game self,<span class="keyword">int</span> x1, <span class="keyword">int</span> y1, <span class="keyword">int</span> x2, <span class="keyword">int</span> y2, Color c)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="comment">//Draw blue horizontal line</span></div><div class="line">	SDL_SetRenderDrawColor( self-&gt;gRenderer, c.r, c.g, c.b, c.a );	</div><div class="line">	SDL_RenderDrawLine( self-&gt;gRenderer, x1,y1,x2,y2);</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></div><div class="line">&#123;</div><div class="line">	Game  snake = newGame(snake) ;</div><div class="line"></div><div class="line">	snake-&gt;init(snake);</div><div class="line"></div><div class="line">	<span class="keyword">while</span>(!snake-&gt;quit)</div><div class="line">	&#123;</div><div class="line">		snake-&gt;handle_events(snake);</div><div class="line">		snake-&gt;update(snake);</div><div class="line">		snake-&gt;render(snake);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[c语言转汇编语言shell脚本]]></title>
      <url>http://shenyu.wiki/2016/09/17/c%E8%AF%AD%E8%A8%80%E8%BD%AC%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80shell%E8%84%9A%E6%9C%AC/</url>
      <content type="html"><![CDATA[<p>最近在学习汇编，为了方便写了一个shell脚本，用来把c语言转换为汇编语言。很方便。</p>
<h2 id="shell脚本"><a href="#shell脚本" class="headerlink" title="shell脚本"></a>shell脚本</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash  </div><div class="line">if [  &quot;$#&quot; = &quot;0&quot; ] ; then</div><div class="line">        echo &apos;help: c2asm FILENAME&apos;  </div><div class="line">        exit 1;</div><div class="line">fi</div><div class="line"></div><div class="line"></div><div class="line">if [ -f &quot;$1&quot; ] ; then</div><div class="line">        echo &apos;check file ok!&apos;  </div><div class="line">else</div><div class="line">        echo &apos;c2asm: file not exist&apos;  </div><div class="line">        exit 1;</div><div class="line">fi</div><div class="line">echo &apos;generating asm file...&apos;  </div><div class="line">gcc -O0 -S &quot;$1&quot;</div><div class="line">tmp=$1</div><div class="line">asmfile=$&#123;tmp%%.c&#125;.s;</div><div class="line"></div><div class="line">echo &quot;asm file generated: $asmfile&quot;  </div><div class="line">echo &apos;==================asm====================&apos;  </div><div class="line">cat &quot;$asmfile&quot; | grep -v &apos;\.&apos;</div><div class="line">echo &apos;==================c======================&apos;  </div><div class="line">cat &quot;$1&quot;</div><div class="line">echo &apos;==================END====================&apos;  </div><div class="line">echo &apos;done&apos;</div></pre></td></tr></table></figure>
<h2 id="使用效果"><a href="#使用效果" class="headerlink" title="使用效果"></a>使用效果</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">check file ok!</div><div class="line">generating asm file...</div><div class="line">asm file generated: main.s</div><div class="line">==================asm====================</div><div class="line">main:</div><div class="line">	pushq	%rbp</div><div class="line">	movq	%rsp, %rbp</div><div class="line">	movl	$1, -8(%rbp)</div><div class="line">	movl	$1, -4(%rbp)</div><div class="line">	movl	-8(%rbp), %edx</div><div class="line">	movl	-4(%rbp), %eax</div><div class="line">	addl	%edx, %eax</div><div class="line">	popq	%rbp</div><div class="line">	ret</div><div class="line">==================c======================</div><div class="line"></div><div class="line">int main()</div><div class="line">&#123;</div><div class="line">	int a,b;</div><div class="line">	a = 1;</div><div class="line">	b = 1;</div><div class="line">	return a+b;</div><div class="line"></div><div class="line">&#125;</div><div class="line">==================END====================</div><div class="line">done</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[linux shell聊天室]]></title>
      <url>http://shenyu.wiki/2016/09/17/linux-shell%E8%81%8A%E5%A4%A9%E5%AE%A4/</url>
      <content type="html"><![CDATA[<h2 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h2><p>里程碑0：</p>
<p>1、基于C/S架构的聊天室，分为客户端和服务器。<br>2、客户端登陆时输入服务器IP、port、 昵称不能重复</p>
<p>里程碑1：</p>
<p>3、可以群发消息或指定接收人<br>4、admin账号可以踢人<br>5、新加入用户可以看到聊天历史记录</p>
<p>里程碑2：</p>
<p>5、可以互传文件<br>6、保存聊天信息</p>
<p>里程碑3：</p>
<p>7、第一次登录时，需要注册。</p>
<h2 id="技术设计"><a href="#技术设计" class="headerlink" title="技术设计"></a>技术设计</h2><p>1、在shell下的图形库：curses<br>2、多线程：pthread<br>3、网络：socket<br>4、消息结构：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> msg_st  </div><div class="line">&#123;  </div><div class="line">    <span class="keyword">char</span> name[<span class="number">256</span>];  </div><div class="line">    <span class="keyword">char</span> to[<span class="number">256</span>];  </div><div class="line">    <span class="keyword">char</span> data[<span class="number">4096</span>];  </div><div class="line">    <span class="keyword">char</span> cmd[<span class="number">256</span>];  </div><div class="line"><span class="comment">/*</span></div><div class="line"> * 其中，关于cmd内容：</div><div class="line"> * login 登陆</div><div class="line"> * offline 服务器即将踢人</div><div class="line"> * user 服务发送的用户列表，数据在data里</div><div class="line"> * chat 表示这是一条消息，数据在data里</div><div class="line"> */</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>5、服务器用了epoll来监听多个fd</p>
<h2 id="登陆界面"><a href="#登陆界面" class="headerlink" title="登陆界面"></a>登陆界面</h2><p><img src="http://img.blog.csdn.net/20141228204352953?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc2hlbnl1Zmx5aW5n/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="登陆界面"></p>
<h2 id="聊天界面"><a href="#聊天界面" class="headerlink" title="聊天界面"></a>聊天界面</h2><p><img src="http://img.blog.csdn.net/20141228193822585?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc2hlbnl1Zmx5aW5n/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="聊天界面"></p>
<a id="more"></a>
<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//client.c  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;errno.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/types.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/socket.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;netdb.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;netinet/in.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;arpa/inet.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;fcntl.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/ioctl.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/select.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;pthread.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ncurses.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/epoll.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"shared_vals.h"</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">"chat_net.h"</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">"chat_ui.h"</span>  </span></div><div class="line">  </div><div class="line"><span class="keyword">char</span> promote[<span class="number">256</span>]= &#123;<span class="number">0</span>&#125;;  </div><div class="line">  </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[])</span>  </span></div><div class="line">&#123;  </div><div class="line">  </div><div class="line">    ui_init();  </div><div class="line">  </div><div class="line">  </div><div class="line">    <span class="keyword">do</span>  </div><div class="line">    &#123;  </div><div class="line">        ui_login(ip,&amp;port,name);  </div><div class="line">        <span class="keyword">if</span>(<span class="number">0</span>==net_login(ip,&amp;port,name))  </div><div class="line">        &#123;  </div><div class="line">            ui_alert(<span class="string">"Login ok!"</span>);  </div><div class="line">            <span class="keyword">break</span>;  </div><div class="line">        &#125;  </div><div class="line">        <span class="keyword">else</span>  </div><div class="line">        &#123;  </div><div class="line">            ui_alert(<span class="string">"Login failed!"</span>);  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">    <span class="keyword">while</span>(<span class="number">1</span>);  </div><div class="line">  </div><div class="line">    ui_init_wins();  </div><div class="line">  </div><div class="line">    ui_refresh_wins();  </div><div class="line">    wprintw(win[<span class="number">1</span>],<span class="string">"IP:%s\nPORT:%d\nNAME:%s"</span>,ip,port,name);  </div><div class="line">    ui_refresh_wins();  </div><div class="line">  </div><div class="line"><span class="comment">//    int i=0;  </span></div><div class="line"><span class="comment">//    for(i=0; i&lt;100; i++)  </span></div><div class="line"><span class="comment">//        ui_print_msg("This is a test message!");  </span></div><div class="line">  </div><div class="line">  </div><div class="line">  </div><div class="line">  </div><div class="line">    <span class="comment">//generate promote as [from] [to]  </span></div><div class="line">    <span class="built_in">sprintf</span>(promote,<span class="string">"[%s]:"</span>, name);  </div><div class="line">    <span class="comment">//start recev process  </span></div><div class="line">  </div><div class="line">    <span class="keyword">pthread_t</span> thread;  </div><div class="line">    <span class="keyword">int</span> res=pthread_create(&amp;thread,<span class="literal">NULL</span>,(<span class="keyword">void</span> *)net_getmsg,(<span class="keyword">void</span>*)<span class="literal">NULL</span>);  </div><div class="line">    <span class="keyword">if</span>(res!=<span class="number">0</span>)  </div><div class="line">    &#123;  </div><div class="line">          ui_alert(<span class="string">"Error"</span>);  </div><div class="line">          getch();  </div><div class="line">    &#125;  </div><div class="line">    <span class="keyword">while</span>(<span class="number">1</span>)  </div><div class="line">    &#123;  </div><div class="line">        ui_promote(promote);  </div><div class="line">  </div><div class="line">        <span class="keyword">int</span> c=<span class="number">0</span>;  </div><div class="line">        <span class="keyword">struct</span> msg_st msg_client;  </div><div class="line">        <span class="built_in">memset</span>((<span class="keyword">void</span> *)&amp;msg_client,<span class="number">0</span>,<span class="keyword">sizeof</span>(msg_client));  </div><div class="line">        ui_getmsg(msg_client.data);  </div><div class="line">        <span class="built_in">strcpy</span>(msg_client.name,name);  </div><div class="line">        <span class="built_in">strcpy</span>(msg_client.cmd,<span class="string">"chat"</span>);  </div><div class="line">        write(sockfd,&amp;msg_client,<span class="keyword">sizeof</span>(msg_client));  </div><div class="line">  </div><div class="line">  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    net_end();  </div><div class="line">    ui_end();  </div><div class="line">  </div><div class="line">  </div><div class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//chat_net.h  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _CHAT_NET_H_  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _CHAT_NET_H_  </span></div><div class="line">  </div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;errno.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/types.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/socket.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;netdb.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;netinet/in.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;arpa/inet.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;fcntl.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/ioctl.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/select.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;pthread.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ncurses.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/epoll.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"shared_vals.h"</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span>  <span class="meta-string">"chat_ui.h"</span>  </span></div><div class="line"><span class="keyword">int</span> sockfd;  </div><div class="line"><span class="keyword">int</span> len;  </div><div class="line"><span class="keyword">struct</span> sockaddr_in address;  </div><div class="line"><span class="keyword">int</span> result;  </div><div class="line"><span class="keyword">char</span> ip[<span class="number">256</span>];  </div><div class="line"><span class="keyword">int</span>  port;  </div><div class="line"><span class="keyword">char</span> name[<span class="number">256</span>];  </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">net_login</span><span class="params">(<span class="keyword">char</span> *ip,<span class="keyword">int</span> * port,<span class="keyword">char</span> *name)</span>  </span></div><div class="line">&#123;  </div><div class="line">  </div><div class="line">  </div><div class="line">    sockfd=socket(AF_INET,SOCK_STREAM,<span class="number">0</span>);  </div><div class="line">    address.sin_family=AF_INET;  </div><div class="line">    address.sin_addr.s_addr=inet_addr(<span class="string">"127.0.0.1"</span>);  </div><div class="line">    address.sin_port=htons(*port);  </div><div class="line">    len=<span class="keyword">sizeof</span>(address);  </div><div class="line">    result=connect(sockfd,(<span class="keyword">struct</span> sockaddr *)&amp;address,len);  </div><div class="line">    <span class="keyword">if</span>(result==<span class="number">-1</span>)  </div><div class="line">    &#123;  </div><div class="line">        <span class="built_in">printf</span>(<span class="string">"ERROR:%s\n"</span>,strerror(errno));  </div><div class="line">        close(sockfd);  </div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="keyword">struct</span> msg_st msg;  </div><div class="line">    <span class="built_in">memset</span>((<span class="keyword">void</span> *)&amp;msg,<span class="number">0</span>,<span class="keyword">sizeof</span>(msg));  </div><div class="line">    <span class="built_in">sprintf</span>(msg.cmd,<span class="string">"login"</span>);  </div><div class="line">    <span class="built_in">strcpy</span>(msg.name,name);  </div><div class="line">    <span class="comment">//  fgets(msg.name,256,stdin);  </span></div><div class="line">    <span class="comment">//printf("checking name [%s]...\n",msg.name);  </span></div><div class="line">    write(sockfd,&amp; msg,<span class="keyword">sizeof</span>( msg));  </div><div class="line">  </div><div class="line">    usleep(<span class="number">100000</span>);  </div><div class="line">    <span class="keyword">int</span> nread=<span class="number">0</span>;  </div><div class="line">    ioctl(sockfd,FIONREAD,&amp;nread);  </div><div class="line">    <span class="keyword">if</span>(nread!=<span class="number">0</span>)  </div><div class="line">    &#123;  </div><div class="line">        read(sockfd,&amp;msg,<span class="keyword">sizeof</span>(msg));  </div><div class="line">        <span class="keyword">if</span>(<span class="built_in">strcmp</span>(<span class="string">"ok"</span>,msg.data)==<span class="number">0</span>)  </div><div class="line">        &#123;  </div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;<span class="comment">//login ok  </span></div><div class="line">        &#125;  </div><div class="line">        <span class="keyword">else</span>  </div><div class="line">        &#123;  </div><div class="line">  </div><div class="line">            <span class="comment">// printf("Login failed!\n");  </span></div><div class="line">            close(sockfd);  </div><div class="line">            <span class="keyword">return</span> <span class="number">-1</span>;<span class="comment">//login failed  </span></div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line"><span class="comment">//   printf("Login failed!\n");  </span></div><div class="line">    close(sockfd);  </div><div class="line">    <span class="keyword">return</span> <span class="number">-1</span>;<span class="comment">//login failed  </span></div><div class="line">  </div><div class="line">&#125;  </div><div class="line">  </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">net_getmsg</span><span class="params">()</span>  </span></div><div class="line">&#123;  </div><div class="line">  </div><div class="line">    <span class="keyword">while</span>(<span class="number">1</span>)  </div><div class="line">    &#123;  </div><div class="line">        usleep(<span class="number">100000</span>);  </div><div class="line">        <span class="keyword">int</span> nread=<span class="number">0</span>;  </div><div class="line">        ioctl(sockfd,FIONREAD,&amp;nread);  </div><div class="line">        <span class="keyword">if</span>(nread!=<span class="number">0</span>)  </div><div class="line">        &#123;  </div><div class="line">            <span class="keyword">struct</span> msg_st msg_read;  </div><div class="line">            read(sockfd,&amp;msg_read,<span class="keyword">sizeof</span>(msg_read));  </div><div class="line">            <span class="keyword">if</span>(<span class="built_in">strncmp</span>(msg_read.cmd,<span class="string">"chat"</span>,<span class="number">4</span>)==<span class="number">0</span>)  </div><div class="line">            &#123;  </div><div class="line">                <span class="keyword">struct</span> tm *tm_ptr;  </div><div class="line">                <span class="keyword">time_t</span> the_time;  </div><div class="line">                (<span class="keyword">void</span>)time(&amp;the_time);  </div><div class="line">                tm_ptr=gmtime(&amp;the_time);  </div><div class="line">                <span class="keyword">char</span> buff[<span class="number">256</span>]=&#123;<span class="number">0</span>&#125;;  </div><div class="line">                <span class="built_in">sprintf</span>(buff,<span class="string">"\n[%02d:%02d:%02d]"</span>,tm_ptr-&gt;tm_hour,tm_ptr-&gt;tm_min,tm_ptr-&gt;tm_sec);  </div><div class="line">                <span class="built_in">strcat</span>(buff,msg_read.name);  </div><div class="line">                <span class="built_in">strcat</span>(buff,<span class="string">":"</span>);  </div><div class="line">                ui_print_msg(buff);  </div><div class="line">                ui_print_msg(msg_read.data);  </div><div class="line">            &#125;  </div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strncmp</span>(msg_read.cmd,<span class="string">"user"</span>,<span class="number">4</span>)==<span class="number">0</span>)  </div><div class="line">            &#123;  </div><div class="line">                 ui_list_users(msg_read.data);  </div><div class="line">                 ui_input_win_active();  </div><div class="line">            &#125;  </div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strncmp</span>(msg_read.cmd,<span class="string">"chat"</span>,<span class="number">4</span>)==<span class="number">0</span>)  </div><div class="line">            &#123;  </div><div class="line">            &#125;  </div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strncmp</span>(msg_read.cmd,<span class="string">"chat"</span>,<span class="number">4</span>)==<span class="number">0</span>)  </div><div class="line">            &#123;  </div><div class="line">            &#125;  </div><div class="line">            <span class="keyword">else</span>  </div><div class="line">            &#123;  </div><div class="line">            &#125;  </div><div class="line">            <span class="comment">//debug  </span></div><div class="line">  </div><div class="line">            <span class="comment">//todo  </span></div><div class="line">  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">    pthread_exit(<span class="literal">NULL</span>);  </div><div class="line">  </div><div class="line">&#125;  </div><div class="line">  </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">net_end</span><span class="params">()</span>  </span></div><div class="line">&#123;  </div><div class="line">  </div><div class="line">    close(sockfd);  </div><div class="line">  </div><div class="line">&#125;  </div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//chat_ui.h  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _CHAT_UI_H_  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _CHAT_UI_H_  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;curses.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> WIN_MAX  10  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> USR_MAX  20l  </span></div><div class="line">  </div><div class="line"><span class="comment">//need from other files  </span></div><div class="line"><span class="comment">//char ip[256];  </span></div><div class="line"><span class="comment">//int port;  </span></div><div class="line"><span class="comment">//char name[256];  </span></div><div class="line">  </div><div class="line"><span class="comment">//char *usr_list[USR_MAX]=&#123;"Shenyu",  </span></div><div class="line"><span class="comment">//                            "Wanglm",  </span></div><div class="line"> <span class="comment">//                           NULL&#125;;  </span></div><div class="line">  </div><div class="line">  </div><div class="line"><span class="comment">////  </span></div><div class="line">WINDOW * win[WIN_MAX ]=&#123;<span class="number">0</span>&#125;;<span class="comment">//max open win = 10  </span></div><div class="line"><span class="keyword">int</span> cur_x,cur_y;  </div><div class="line">  </div><div class="line">  </div><div class="line">  </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">ui_refresh_wins</span><span class="params">()</span> <span class="comment">//refresh all open wins  </span></span></div><div class="line">&#123;  </div><div class="line">    <span class="keyword">int</span> i=<span class="number">0</span>;  </div><div class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;WIN_MAX ;i++)  </div><div class="line">    &#123;  </div><div class="line">        <span class="keyword">if</span>(win [i]!=<span class="literal">NULL</span>)  </div><div class="line">        &#123;  </div><div class="line">            touchwin(win [i]);  </div><div class="line">            wrefresh(win [i]);  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">    <span class="comment">//the input always active  </span></div><div class="line">  </div><div class="line">&#125;  </div><div class="line">  </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">ui_input_win_active</span><span class="params">()</span>  </span></div><div class="line">&#123;  </div><div class="line">      touchwin(win [<span class="number">2</span>]);  </div><div class="line">      wrefresh(win [<span class="number">2</span>]);  </div><div class="line">&#125;  </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">ui_init</span><span class="params">()</span>  </span></div><div class="line">&#123;  </div><div class="line">    initscr();  </div><div class="line">    refresh();  </div><div class="line">  </div><div class="line">    start_color();  </div><div class="line">  </div><div class="line">    init_pair(<span class="number">1</span>,COLOR_BLACK,COLOR_CYAN);  </div><div class="line">    init_pair(<span class="number">2</span>,COLOR_YELLOW,COLOR_BLUE);  </div><div class="line">    init_pair(<span class="number">3</span>,COLOR_YELLOW,COLOR_RED);  </div><div class="line">  </div><div class="line">  </div><div class="line">&#125;  </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">ui_init_wins</span><span class="params">()</span>  </span></div><div class="line">&#123;  </div><div class="line">    win[<span class="number">0</span>]=newwin(<span class="number">20</span>,<span class="number">10</span>,<span class="number">0</span>,<span class="number">0</span>);  </div><div class="line">    win[<span class="number">1</span>]=newwin(<span class="number">20</span>,<span class="number">50</span>,<span class="number">0</span>,<span class="number">10</span>);  </div><div class="line">    win[<span class="number">2</span>]=newwin(<span class="number">1</span>,<span class="number">60</span>,<span class="number">20</span>,<span class="number">0</span>);  </div><div class="line">  </div><div class="line">  </div><div class="line">    wbkgd(win[<span class="number">0</span>],COLOR_PAIR(<span class="number">1</span>));  </div><div class="line">    wbkgd(win[<span class="number">1</span>],COLOR_PAIR(<span class="number">2</span>)|A_BOLD);  </div><div class="line">    wbkgd(win[<span class="number">2</span>],COLOR_PAIR(<span class="number">3</span>)|A_BOLD);  </div><div class="line">    scrollok(win[<span class="number">0</span>],TRUE);  </div><div class="line">    scrollok(win[<span class="number">1</span>],TRUE);  </div><div class="line">  </div><div class="line">  </div><div class="line">    keypad(win[<span class="number">0</span>],TRUE);  </div><div class="line">    keypad(win[<span class="number">1</span>],TRUE);  </div><div class="line">    keypad(win[<span class="number">2</span>],TRUE);  </div><div class="line">    keypad(stdscr, TRUE);  </div><div class="line">&#125;  </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">ui_login</span><span class="params">(<span class="keyword">char</span> *ip,<span class="keyword">int</span> * port,<span class="keyword">char</span> *name)</span>  </span></div><div class="line">&#123;  </div><div class="line">    win[<span class="number">3</span>]=newwin(<span class="number">10</span>,<span class="number">40</span>,<span class="number">5</span>,<span class="number">10</span>);  </div><div class="line">    wbkgd(win[<span class="number">3</span>],COLOR_PAIR(<span class="number">3</span>)|A_BOLD);  </div><div class="line">  </div><div class="line">    wrefresh(win[<span class="number">3</span>]);  </div><div class="line">    mvwprintw(win[<span class="number">3</span>],<span class="number">3</span>,<span class="number">3</span>,<span class="string">"Server   IP:\n"</span>);  </div><div class="line">    mvwprintw(win[<span class="number">3</span>],<span class="number">4</span>,<span class="number">3</span>,<span class="string">"Server port:\n"</span>);  </div><div class="line">    mvwprintw(win[<span class="number">3</span>],<span class="number">5</span>,<span class="number">3</span>,<span class="string">"User name  :\n"</span>);  </div><div class="line">    wrefresh(win[<span class="number">3</span>]);  </div><div class="line">  </div><div class="line">    wmove(win[<span class="number">3</span>],<span class="number">3</span>,<span class="number">16</span>);  </div><div class="line">    wrefresh(win[<span class="number">3</span>]);  </div><div class="line">    wgetnstr(win[<span class="number">3</span>],ip,<span class="number">100</span>);  </div><div class="line">  </div><div class="line">    wmove(win[<span class="number">3</span>],<span class="number">4</span>,<span class="number">16</span>);  </div><div class="line">    wrefresh(win[<span class="number">3</span>]);  </div><div class="line">    wscanw(win[<span class="number">3</span>],<span class="string">"%d"</span>, port);  </div><div class="line">  </div><div class="line">    wmove(win[<span class="number">3</span>],<span class="number">5</span>,<span class="number">16</span>);  </div><div class="line">    wrefresh(win[<span class="number">3</span>]);  </div><div class="line">    wgetnstr(win[<span class="number">3</span>],name,<span class="number">100</span>);  </div><div class="line">    delwin(win[<span class="number">3</span>]);  </div><div class="line">  </div><div class="line">&#125;  </div><div class="line">  </div><div class="line">  </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">ui_list_users</span><span class="params">(<span class="keyword">char</span> * data)</span>  </span></div><div class="line">&#123;  </div><div class="line"><span class="keyword">int</span> i=<span class="number">0</span>;  </div><div class="line">wclear(win[<span class="number">0</span>]);  </div><div class="line"> wprintw(win[<span class="number">0</span>],<span class="string">"--users--\n"</span>);  </div><div class="line"> wprintw(win[<span class="number">0</span>],<span class="string">"%s\n"</span>,data);  </div><div class="line">wrefresh(win[<span class="number">0</span>]);  </div><div class="line">  </div><div class="line">&#125;  </div><div class="line">  </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">ui_print_msg</span><span class="params">(<span class="keyword">char</span> *msg)</span>  </span></div><div class="line">&#123;  </div><div class="line">  </div><div class="line">   wprintw(win[<span class="number">1</span>],<span class="string">"%s\n"</span>,msg);  </div><div class="line">   wrefresh(win[<span class="number">1</span>]);  </div><div class="line">&#125;  </div><div class="line">  </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">ui_alert</span><span class="params">(<span class="keyword">char</span> *msg)</span>  </span></div><div class="line">&#123;  </div><div class="line">    win[<span class="number">4</span>]=newwin(<span class="number">10</span>,<span class="number">40</span>,<span class="number">5</span>,<span class="number">10</span>);  </div><div class="line">    wbkgd(win[<span class="number">4</span>],COLOR_PAIR(<span class="number">3</span>)|A_BOLD);  </div><div class="line">    wrefresh(win[<span class="number">4</span>]);  </div><div class="line">    mvwprintw(win[<span class="number">4</span>],<span class="number">5</span>,<span class="number">3</span>,<span class="string">"%s\n   Press any key to continue..."</span>,msg);  </div><div class="line">    wrefresh(win[<span class="number">4</span>]);  </div><div class="line">    getch();  </div><div class="line">    delwin(win[<span class="number">3</span>]);  </div><div class="line">  </div><div class="line">  </div><div class="line">&#125;  </div><div class="line">  </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">ui_end</span><span class="params">()</span>  </span></div><div class="line">&#123;  </div><div class="line">    endwin();  </div><div class="line">&#125;  </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">ui_promote</span><span class="params">(<span class="keyword">char</span> *msg)</span>  </span></div><div class="line">&#123;  </div><div class="line"> ui_input_win_active();  </div><div class="line"> wclear(win[<span class="number">2</span>]);  </div><div class="line"> wprintw(win[<span class="number">2</span>],<span class="string">"%s"</span>,msg);  </div><div class="line"> wrefresh(win[<span class="number">2</span>]);  </div><div class="line">&#125;  </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">ui_getmsg</span><span class="params">(<span class="keyword">char</span> * buff)</span>  </span></div><div class="line">&#123;  </div><div class="line"> ui_input_win_active();  </div><div class="line"> wgetnstr(win[<span class="number">2</span>],buff,<span class="number">4096</span>);  </div><div class="line">  </div><div class="line">&#125;  </div><div class="line"><span class="comment">//sample programs for UI  </span></div><div class="line"><span class="comment">//int main(int argc, char * argv[])  </span></div><div class="line"><span class="comment">//&#123;  </span></div><div class="line"><span class="comment">//  </span></div><div class="line"><span class="comment">//  </span></div><div class="line"><span class="comment">//    ui_init();  </span></div><div class="line"><span class="comment">//    ui_login(ip,&amp;port,name);  </span></div><div class="line"><span class="comment">//  </span></div><div class="line"><span class="comment">//    ui_init_wins();  </span></div><div class="line"><span class="comment">//    ui_list_users( usr_list );  </span></div><div class="line"><span class="comment">//    ui_refresh_wins();  </span></div><div class="line"><span class="comment">//    wprintw(win[1],"IP:%s\nPORT:%d\nNAME:%s",ip,port,name);  </span></div><div class="line"><span class="comment">//    ui_refresh_wins();  </span></div><div class="line"><span class="comment">//  </span></div><div class="line"><span class="comment">//int i=0;  </span></div><div class="line"><span class="comment">//for(i=0;i&lt;100;i++)  </span></div><div class="line"><span class="comment">//    ui_print_msg("This is a test message!");  </span></div><div class="line"><span class="comment">//  </span></div><div class="line"><span class="comment">//  </span></div><div class="line"><span class="comment">//    ui_refresh_wins();  </span></div><div class="line"><span class="comment">//    getch();  </span></div><div class="line"><span class="comment">//&#125;  </span></div><div class="line">  </div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// _CHAT_UI_H_</span></span></div></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _SHARED_VALS_H_  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _SHARED_VALS_H_  </span></div><div class="line">  </div><div class="line"><span class="keyword">struct</span> msg_st  </div><div class="line">&#123;  </div><div class="line">    <span class="keyword">char</span> name[<span class="number">256</span>];<span class="comment">//发送信息人  </span></div><div class="line">    <span class="keyword">char</span> to[<span class="number">256</span>];  <span class="comment">//接收人  </span></div><div class="line">    <span class="keyword">char</span> data[<span class="number">4096</span>];<span class="comment">//数据  </span></div><div class="line">    <span class="keyword">char</span> cmd[<span class="number">256</span>];<span class="comment">//消息的类型  </span></div><div class="line">&#125;;  </div><div class="line">  </div><div class="line"><span class="comment">//login 登陆  </span></div><div class="line"><span class="comment">//offline 服务器即将踢人  </span></div><div class="line"><span class="comment">//user 服务发送的用户列表，数据在data里  </span></div><div class="line"><span class="comment">//chat 表示这是一条消息，数据在data里  </span></div><div class="line">  </div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;errno.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/types.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/socket.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;netdb.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;netinet/in.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;arpa/inet.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;fcntl.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/ioctl.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/select.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;pthread.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/epoll.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXEVENTS 64  </span></div><div class="line">  </div><div class="line"><span class="keyword">struct</span> msg_st  </div><div class="line">&#123;  </div><div class="line">    <span class="keyword">char</span> name[<span class="number">256</span>];  </div><div class="line">    <span class="keyword">char</span> to[<span class="number">256</span>];  </div><div class="line">    <span class="keyword">char</span> data[<span class="number">4096</span>];  </div><div class="line">    <span class="keyword">char</span> cmd[<span class="number">256</span>];  </div><div class="line">&#125;;  </div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_CLIENTS 256  </span></div><div class="line"><span class="keyword">int</span> chat_clients_sets[MAX_CLIENTS]=&#123;<span class="number">0</span>&#125;;  </div><div class="line"><span class="keyword">char</span> *chat_clients_names [MAX_CLIENTS] = &#123;<span class="number">0</span>&#125;;  </div><div class="line"><span class="keyword">int</span> chat_clients_count=<span class="number">0</span>;  </div><div class="line">  </div><div class="line">  </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">chat_clients_add</span><span class="params">(<span class="keyword">int</span> fd,<span class="keyword">char</span> * <span class="number">_</span>name)</span>  </span></div><div class="line">&#123;  </div><div class="line">    <span class="keyword">int</span> i=<span class="number">0</span>;  </div><div class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;MAX_CLIENTS; i++)  </div><div class="line">    &#123;  </div><div class="line">        <span class="keyword">if</span>(chat_clients_sets[i]==<span class="number">0</span>)  </div><div class="line">        &#123;  </div><div class="line">            chat_clients_sets[i]=fd;  </div><div class="line">  </div><div class="line">            <span class="keyword">int</span> len=<span class="built_in">strlen</span>(<span class="number">_</span>name)+<span class="number">1</span>;  </div><div class="line">            <span class="keyword">char</span> *ptr=<span class="built_in">malloc</span>(len*<span class="keyword">sizeof</span>(<span class="keyword">char</span>));  </div><div class="line">            <span class="built_in">memset</span>(ptr,<span class="number">0</span>,<span class="keyword">sizeof</span>(ptr));  </div><div class="line">            <span class="built_in">strcpy</span>(ptr,<span class="number">_</span>name);  </div><div class="line">            *(chat_clients_names+i)=ptr;  </div><div class="line">  </div><div class="line">            chat_clients_count++;  </div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">    <span class="keyword">return</span> <span class="number">-1</span>;  </div><div class="line">&#125;  </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">chat_clients_del</span><span class="params">(<span class="keyword">int</span> fd)</span>  </span></div><div class="line">&#123;  </div><div class="line">    <span class="keyword">int</span> i=<span class="number">0</span>;  </div><div class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;MAX_CLIENTS;i++)  </div><div class="line">    &#123;  </div><div class="line">        <span class="keyword">if</span>(chat_clients_sets[i]==fd)  </div><div class="line">        &#123;  </div><div class="line">            chat_clients_sets[i]=<span class="number">0</span>;  </div><div class="line">            <span class="built_in">free</span>(*(chat_clients_names+i));  </div><div class="line">            *(chat_clients_names+i)=<span class="literal">NULL</span>;  </div><div class="line">            chat_clients_count--;  </div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">    <span class="keyword">return</span> <span class="number">-1</span>;  </div><div class="line">&#125;  </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">chat_user_list</span><span class="params">(<span class="keyword">struct</span> msg_st * m)</span>  </span></div><div class="line">&#123;  </div><div class="line">    <span class="built_in">memset</span>( m,<span class="number">0</span>,<span class="keyword">sizeof</span>(<span class="keyword">struct</span> msg_st));  </div><div class="line">    <span class="built_in">strcpy</span>(m-&gt;cmd,<span class="string">"user"</span>);  </div><div class="line">    <span class="keyword">int</span> i=<span class="number">0</span>;  </div><div class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;MAX_CLIENTS;i++)  </div><div class="line">    &#123;  </div><div class="line">        <span class="keyword">if</span>(*(chat_clients_names+i)!=<span class="literal">NULL</span>)  </div><div class="line">        &#123;  </div><div class="line">            <span class="keyword">char</span> buff[<span class="number">4096</span>];  </div><div class="line">            <span class="built_in">memset</span>(buff,<span class="number">0</span>,<span class="keyword">sizeof</span>(buff));  </div><div class="line">  </div><div class="line">            <span class="built_in">sprintf</span>(buff,<span class="string">"%s\n"</span>,*(chat_clients_names+i));  </div><div class="line">            <span class="built_in">strcat</span>(m-&gt;data,buff);  </div><div class="line">  </div><div class="line">        &#125;  </div><div class="line">  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">  </div><div class="line">&#125;  </div><div class="line">  </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">chat_clients_sendto_all</span><span class="params">(<span class="keyword">struct</span> msg_st * mymsg)</span>  </span></div><div class="line">&#123;  </div><div class="line">  </div><div class="line">    <span class="keyword">int</span> j=<span class="number">0</span>;  </div><div class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; MAX_CLIENTS; j++)  </div><div class="line">    &#123;  </div><div class="line">        <span class="keyword">if</span>(chat_clients_sets[j]!=<span class="number">0</span>)  </div><div class="line">        &#123;  </div><div class="line">  </div><div class="line">            <span class="built_in">printf</span>(<span class="string">"send to %s\n"</span>,(*mymsg).name);  </div><div class="line">          <span class="keyword">int</span>    s = write (chat_clients_sets[j] , mymsg, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> msg_st));  </div><div class="line">            <span class="keyword">if</span> (s == <span class="number">-1</span>)  </div><div class="line">            &#123;  </div><div class="line">                perror (<span class="string">"write"</span>);  </div><div class="line">                <span class="built_in">abort</span> ();  </div><div class="line">            &#125;  </div><div class="line">  </div><div class="line">        &#125;  </div><div class="line">  </div><div class="line">  </div><div class="line">  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">&#125;  </div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span>  </span></div><div class="line"><span class="title">create_and_bind</span> <span class="params">(<span class="keyword">char</span> *port)</span>  </div><div class="line">&#123;  </div><div class="line">    <span class="keyword">struct</span> addrinfo hints;  </div><div class="line">    <span class="keyword">struct</span> addrinfo *result, *rp;  </div><div class="line">    <span class="keyword">int</span> s, sfd;  </div><div class="line">  </div><div class="line">    <span class="built_in">memset</span> (&amp;hints, <span class="number">0</span>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> addrinfo));  </div><div class="line">    hints.ai_family = AF_UNSPEC;     <span class="comment">/* Return IPv4 and IPv6 choices */</span>  </div><div class="line">    hints.ai_socktype = SOCK_STREAM; <span class="comment">/* We want a TCP socket */</span>  </div><div class="line">    hints.ai_flags = <span class="number">0x0001</span>;  <span class="comment">/* All interfaces */</span>  </div><div class="line">  </div><div class="line">    s = getaddrinfo (<span class="literal">NULL</span>, port, &amp;hints, &amp;result);  </div><div class="line">    <span class="keyword">if</span> (s != <span class="number">0</span>)  </div><div class="line">    &#123;  </div><div class="line">        <span class="built_in">fprintf</span> (<span class="built_in">stderr</span>, <span class="string">"getaddrinfo: %s\n"</span>, gai_strerror (s));  </div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="keyword">for</span> (rp = result; rp != <span class="literal">NULL</span>; rp = rp-&gt;ai_next)  </div><div class="line">    &#123;  </div><div class="line">        sfd = socket (rp-&gt;ai_family, rp-&gt;ai_socktype, rp-&gt;ai_protocol);  </div><div class="line">        <span class="keyword">if</span> (sfd == <span class="number">-1</span>)  </div><div class="line">            <span class="keyword">continue</span>;  </div><div class="line">        s = bind (sfd, rp-&gt;ai_addr, rp-&gt;ai_addrlen);  </div><div class="line">        <span class="keyword">if</span> (s == <span class="number">0</span>)  </div><div class="line">        &#123;  </div><div class="line">            <span class="comment">/* We managed to bind successfully! */</span>  </div><div class="line">            <span class="keyword">break</span>;  </div><div class="line">        &#125;  </div><div class="line">  </div><div class="line">        close (sfd);  </div><div class="line">    &#125;  </div><div class="line">    <span class="keyword">if</span> (rp == <span class="literal">NULL</span>)  </div><div class="line">    &#123;  </div><div class="line">        <span class="built_in">fprintf</span> (<span class="built_in">stderr</span>, <span class="string">"Could not bind\n"</span>);  </div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;  </div><div class="line">    &#125;  </div><div class="line">    freeaddrinfo (result);  </div><div class="line">    <span class="keyword">return</span> sfd;  </div><div class="line">&#125;  </div><div class="line">  </div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span>  </span></div><div class="line"><span class="title">make_socket_non_blocking</span> <span class="params">(<span class="keyword">int</span> sfd)</span>  </div><div class="line">&#123;  </div><div class="line">    <span class="keyword">int</span> flags, s;  </div><div class="line">  </div><div class="line">    flags = fcntl (sfd, F_GETFL, <span class="number">0</span>);  </div><div class="line">    <span class="keyword">if</span> (flags == <span class="number">-1</span>)  </div><div class="line">    &#123;  </div><div class="line">        perror (<span class="string">"fcntl"</span>);  </div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    flags |= O_NONBLOCK;  </div><div class="line">    s = fcntl (sfd, F_SETFL, flags);  </div><div class="line">    <span class="keyword">if</span> (s == <span class="number">-1</span>)  </div><div class="line">    &#123;  </div><div class="line">        perror (<span class="string">"fcntl"</span>);  </div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;  </div><div class="line">&#125;  </div><div class="line">  </div><div class="line">    <span class="keyword">int</span> sfd, s;  </div><div class="line">    <span class="keyword">int</span> efd;  </div><div class="line">    <span class="keyword">struct</span> epoll_event event;  </div><div class="line">    <span class="keyword">struct</span> epoll_event *events;  </div><div class="line">  </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[])</span>  </span></div><div class="line">&#123;  </div><div class="line">  </div><div class="line">  <span class="keyword">if</span> (argc != <span class="number">2</span>)  </div><div class="line">    &#123;  </div><div class="line">        <span class="built_in">fprintf</span> (<span class="built_in">stderr</span>, <span class="string">"Usage: %s [port]\n"</span>, argv[<span class="number">0</span>]);  </div><div class="line">        <span class="built_in">exit</span> (EXIT_FAILURE);  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    sfd = create_and_bind (argv[<span class="number">1</span>]);  </div><div class="line">    <span class="keyword">if</span> (sfd == <span class="number">-1</span>)  </div><div class="line">        <span class="built_in">abort</span> ();  </div><div class="line">  </div><div class="line">    s = make_socket_non_blocking (sfd);  </div><div class="line">    <span class="keyword">if</span> (s == <span class="number">-1</span>)  </div><div class="line">        <span class="built_in">abort</span> ();  </div><div class="line">  </div><div class="line">    s = listen (sfd, SOMAXCONN);  </div><div class="line">    <span class="keyword">if</span> (s == <span class="number">-1</span>)  </div><div class="line">    &#123;  </div><div class="line">        perror (<span class="string">"listen"</span>);  </div><div class="line">        <span class="built_in">abort</span> ();  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    efd = epoll_create1 (<span class="number">0</span>);  </div><div class="line">    <span class="keyword">if</span> (efd == <span class="number">-1</span>)  </div><div class="line">    &#123;  </div><div class="line">        perror (<span class="string">"epoll_create"</span>);  </div><div class="line">        <span class="built_in">abort</span> ();  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    event.data.fd = sfd;  </div><div class="line">    event.events = EPOLLIN | EPOLLET;  </div><div class="line">    s = epoll_ctl (efd, EPOLL_CTL_ADD, sfd, &amp;event);  </div><div class="line">    <span class="keyword">if</span> (s == <span class="number">-1</span>)  </div><div class="line">    &#123;  </div><div class="line">        perror (<span class="string">"epoll_ctl"</span>);  </div><div class="line">        <span class="built_in">abort</span> ();  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="comment">/* Buffer where events are returned */</span>  </div><div class="line">    events = <span class="built_in">calloc</span> (MAXEVENTS, <span class="keyword">sizeof</span> event);  </div><div class="line">&#125;  </div><div class="line">  </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">server_accept_clients</span><span class="params">()</span>  </span></div><div class="line">&#123;  </div><div class="line"> <span class="comment">/* We have a notification on the listening socket, which </span></div><div class="line">                   means one or more incoming connections. */  </div><div class="line">                <span class="keyword">while</span> (<span class="number">1</span>)  </div><div class="line">                &#123;  </div><div class="line">                    <span class="keyword">struct</span> sockaddr in_addr;  </div><div class="line">                    <span class="keyword">socklen_t</span> in_len;  </div><div class="line">                    <span class="keyword">int</span> infd;  </div><div class="line">                    <span class="keyword">char</span> hbuf[NI_MAXHOST], sbuf[NI_MAXSERV];  </div><div class="line">  </div><div class="line">                    in_len = <span class="keyword">sizeof</span> in_addr;  </div><div class="line">                    infd = accept (sfd, &amp;in_addr, &amp;in_len);  </div><div class="line">                    <span class="keyword">if</span> (infd == <span class="number">-1</span>)  </div><div class="line">                    &#123;  </div><div class="line">                        <span class="keyword">if</span> ((errno == EAGAIN) ||  </div><div class="line">                                (errno == EWOULDBLOCK))  </div><div class="line">                        &#123;  </div><div class="line">                            <span class="comment">/* We have processed all incoming </span></div><div class="line">                               connections. */  </div><div class="line">                            <span class="keyword">break</span>;  </div><div class="line">                        &#125;  </div><div class="line">                        <span class="keyword">else</span>  </div><div class="line">                        &#123;  </div><div class="line">                            perror (<span class="string">"accept"</span>);  </div><div class="line">                            <span class="keyword">break</span>;  </div><div class="line">                        &#125;  </div><div class="line">                    &#125;  </div><div class="line">  </div><div class="line">                     <span class="keyword">int</span> s = getnameinfo (&amp;in_addr, in_len,  </div><div class="line">                                     hbuf, <span class="keyword">sizeof</span> hbuf,  </div><div class="line">                                     sbuf, <span class="keyword">sizeof</span> sbuf,  </div><div class="line">                                     NI_NUMERICHOST | NI_NUMERICSERV);  </div><div class="line">                    <span class="keyword">if</span> (s == <span class="number">0</span>)  </div><div class="line">                    &#123;  </div><div class="line">                        <span class="built_in">printf</span>(<span class="string">"Server: accepted connection on descriptor %d "</span>  </div><div class="line">                               <span class="string">"(host=%s, port=%s)\n"</span>, infd, hbuf, sbuf);  </div><div class="line">                    &#125;  </div><div class="line">  </div><div class="line">                    <span class="comment">/* Make the incoming socket non-blocking and add it to the </span></div><div class="line">                       list of fds to monitor. */  </div><div class="line">                    s = make_socket_non_blocking (infd);  </div><div class="line">                    <span class="keyword">if</span> (s == <span class="number">-1</span>)  </div><div class="line">                        <span class="built_in">abort</span> ();  </div><div class="line">  </div><div class="line">                    event.data.fd = infd;  </div><div class="line">                    event.events = EPOLLIN | EPOLLET;  </div><div class="line">                    s = epoll_ctl (efd, EPOLL_CTL_ADD, infd, &amp;event);  </div><div class="line">                    <span class="comment">//add to clients sets  </span></div><div class="line">                   <span class="comment">// chat_clients_add(infd);  </span></div><div class="line">                    <span class="keyword">if</span> (s == <span class="number">-1</span>)  </div><div class="line">                    &#123;  </div><div class="line">                        perror (<span class="string">"epoll_ctl"</span>);  </div><div class="line">                        <span class="built_in">abort</span> ();  </div><div class="line">                    &#125;  </div><div class="line">                &#125;  </div><div class="line">&#125;  </div><div class="line"><span class="function"><span class="keyword">int</span>  </span></div><div class="line"><span class="title">main</span> <span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span>  </div><div class="line">&#123;  </div><div class="line">  </div><div class="line">    init(argc,argv);  </div><div class="line">  </div><div class="line">    <span class="comment">/* The event loop */</span>  </div><div class="line">    <span class="keyword">while</span> (<span class="number">1</span>)  </div><div class="line">    &#123;  </div><div class="line">        <span class="keyword">int</span> n, i;  </div><div class="line">  </div><div class="line">        n = epoll_wait (efd, events, MAXEVENTS, <span class="number">-1</span>);  </div><div class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++)  </div><div class="line">        &#123;  </div><div class="line">            <span class="keyword">if</span> ((events[i].events &amp; EPOLLERR) ||  </div><div class="line">                    (events[i].events &amp; EPOLLHUP) ||  </div><div class="line">                    (!(events[i].events &amp; EPOLLIN)))  </div><div class="line">            &#123;  </div><div class="line">                <span class="comment">/* An error has occured on this fd, or the socket is not </span></div><div class="line">                   ready for reading (why were we notified then?) */  </div><div class="line">                <span class="built_in">fprintf</span> (<span class="built_in">stderr</span>, <span class="string">"epoll error\n"</span>);  </div><div class="line">                close (events[i].data.fd);  </div><div class="line">                <span class="keyword">continue</span>;  </div><div class="line">            &#125;  </div><div class="line">  </div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (sfd == events[i].data.fd)  </div><div class="line">            &#123;  </div><div class="line">                server_accept_clients();  </div><div class="line">                <span class="keyword">continue</span>;  </div><div class="line">            &#125;  </div><div class="line">            <span class="keyword">else</span>  </div><div class="line">            &#123;  </div><div class="line">                <span class="comment">/* We have data on the fd waiting to be read. Read and </span></div><div class="line">                   display it. We must read whatever data is available </div><div class="line">                   completely, as we are running in edge-triggered mode </div><div class="line">                   and won't get a notification again for the same </div><div class="line">                   data. */  </div><div class="line">                <span class="keyword">int</span> done = <span class="number">0</span>;  </div><div class="line">  </div><div class="line">                <span class="keyword">while</span> (<span class="number">1</span>)  </div><div class="line">                &#123;  </div><div class="line">                    <span class="keyword">ssize_t</span> count;  </div><div class="line">                    <span class="comment">//char buf[512]= &#123;0&#125;;  </span></div><div class="line">                    <span class="keyword">struct</span> msg_st mymsg;  </div><div class="line">                    <span class="built_in">memset</span>((<span class="keyword">void</span> *)&amp;mymsg,<span class="number">0</span>,<span class="keyword">sizeof</span>(mymsg));  </div><div class="line">                    count = read (events[i].data.fd, (<span class="keyword">void</span> *)&amp;mymsg, <span class="keyword">sizeof</span>(mymsg));  </div><div class="line">  </div><div class="line">                    <span class="keyword">if</span> (count == <span class="number">-1</span>)  </div><div class="line">                    &#123;  </div><div class="line">                        <span class="comment">/* If errno == EAGAIN, that means we have read all </span></div><div class="line">                           data. So go back to the main loop. */  </div><div class="line">                        <span class="keyword">if</span> (errno != EAGAIN)  </div><div class="line">                        &#123;  </div><div class="line">                            perror (<span class="string">"read"</span>);  </div><div class="line">                            done = <span class="number">1</span>;  </div><div class="line">                        &#125;  </div><div class="line">                        <span class="keyword">break</span>;  </div><div class="line">                    &#125;  </div><div class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (count == <span class="number">0</span>)  </div><div class="line">                    &#123;  </div><div class="line">                        <span class="comment">/* End of file. The remote has closed the </span></div><div class="line">                           connection. */  </div><div class="line">                        done = <span class="number">1</span>;  </div><div class="line">                        <span class="keyword">break</span>;  </div><div class="line">                    &#125;  </div><div class="line">                    <span class="comment">/* do a little work here*/</span>  </div><div class="line">  </div><div class="line">                    <span class="comment">/* Write the buffer to standard output */</span>  </div><div class="line">                    <span class="built_in">printf</span>(<span class="string">"Server: msg from client [%s]-[%s]\n"</span>,mymsg.name,mymsg.data);  </div><div class="line">  </div><div class="line">                    <span class="keyword">if</span>(<span class="built_in">strncmp</span>(mymsg.cmd,<span class="string">"login"</span>,<span class="number">5</span>)==<span class="number">0</span>)  </div><div class="line">                    &#123;  </div><div class="line">                        <span class="built_in">printf</span>(<span class="string">"return login ok!\n"</span>);  </div><div class="line">                        <span class="built_in">strcpy</span>(mymsg.data,<span class="string">"ok"</span>);  </div><div class="line">                        chat_clients_add(events[i].data.fd,mymsg.name);  </div><div class="line">                          chat_clients_sendto_all(&amp;mymsg);  </div><div class="line">                          <span class="keyword">continue</span>;  </div><div class="line">                    &#125;  </div><div class="line">  </div><div class="line">  </div><div class="line">  </div><div class="line">                    <span class="built_in">strcpy</span>(mymsg.cmd,<span class="string">"chat"</span>);  </div><div class="line">                    chat_clients_sendto_all(&amp;mymsg);  </div><div class="line">                    usleep(<span class="number">100000</span>);  </div><div class="line">                    chat_user_list(&amp;mymsg);  </div><div class="line">                    <span class="built_in">printf</span>(<span class="string">"==user==\n%s\n"</span>,mymsg.data);  </div><div class="line">                    chat_clients_sendto_all(&amp;mymsg);  </div><div class="line">  </div><div class="line">                &#125;  </div><div class="line">  </div><div class="line">                <span class="keyword">if</span> (done)  </div><div class="line">                &#123;  </div><div class="line">                    <span class="built_in">printf</span> (<span class="string">"Server: closed connection on descriptor %d\n"</span>,  </div><div class="line">                            events[i].data.fd);  </div><div class="line">  </div><div class="line">                    <span class="comment">/* Closing the descriptor will make epoll remove it </span></div><div class="line">                       from the set of descriptors which are monitored. */  </div><div class="line">                    close (events[i].data.fd);  </div><div class="line">                &#125;  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="built_in">free</span> (events);  </div><div class="line">  </div><div class="line">    close (sfd);  </div><div class="line">  </div><div class="line">    <span class="keyword">return</span> EXIT_SUCCESS;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[在linux shell 下切换程序]]></title>
      <url>http://shenyu.wiki/2016/09/17/linux-shell-%E5%88%87%E6%8D%A2%E7%A8%8B%E5%BA%8F/</url>
      <content type="html"><![CDATA[<p>我们都知道，在 Windows 上我们可以轻松打开多个窗口并用Alt+TAB进行切换。但是在 Linux Shell下如何实现呢？请看下面的介绍。</p>
<h2 id="让程序在后台执行"><a href="#让程序在后台执行" class="headerlink" title="让程序在后台执行"></a>让程序在后台执行</h2><p>命令： &amp;<br>这个用在一个命令的最后，可以把这个命令放到后台执行。<br>例如 ./program1 &amp;程序便在后台执行了，此时用户可以继续输入其他命令。</p>
<h2 id="把程序放到后台"><a href="#把程序放到后台" class="headerlink" title="把程序放到后台"></a>把程序放到后台</h2><p>命令：ctrl + z<br>可以将一个正在前台执行的命令放到后台，并且暂停。</p>
<h2 id="查看当前有多少在后台运行的命令"><a href="#查看当前有多少在后台运行的命令" class="headerlink" title="查看当前有多少在后台运行的命令"></a>查看当前有多少在后台运行的命令</h2><p>命令：jobs<br>查看当前有多少在后台运行的命令</p>
<h2 id="将后台中的命令调至前台继续运行"><a href="#将后台中的命令调至前台继续运行" class="headerlink" title="将后台中的命令调至前台继续运行"></a>将后台中的命令调至前台继续运行</h2><p>命令：fg<br>如果后台中有多个命令，可以用 fg %jobnumber将选中的命令调出，%jobnumber是通过jobs命令查到的后台正在执行的命令的序号(不是pid)。</p>
<h2 id="将一个在后台暂停的命令，变成继续执行"><a href="#将一个在后台暂停的命令，变成继续执行" class="headerlink" title="将一个在后台暂停的命令，变成继续执行"></a>将一个在后台暂停的命令，变成继续执行</h2><p>命令：bg<br>将一个在后台暂停的命令，变成继续执行<br>如果后台中有多个命令，可以用bg %jobnumber将选中的命令调出，%jobnumber是通过jobs命令查到的后台正在执行的命令的序号(不是pid)</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[奥运会成绩管理系统]]></title>
      <url>http://shenyu.wiki/2016/09/17/%E5%A5%A5%E8%BF%90%E4%BC%9A%E6%88%90%E7%BB%A9%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/</url>
      <content type="html"><![CDATA[<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>要求编程实现奥运会成绩管理系统，具有如下功能：初始化、录入成绩、取消成绩、查询奖牌榜。</p>
<h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>能够任何时候初始化，清空系统所有数据。<br>函数原型：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">void init (void);</div></pre></td></tr></table></figure></p>
<h3 id="录入成绩"><a href="#录入成绩" class="headerlink" title="录入成绩"></a>录入成绩</h3><p>录入运动员取得成绩情况。<br>函数原型：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bool enter_score(int time, int country, char * name, int sport, int medal);</div></pre></td></tr></table></figure></p>
<p>入参：</p>
<ul>
<li>时间： 0-30 单位为天，录入成绩时，时间必须不变或递增</li>
<li>国家：运动员所在的国家，有中、美、日、韩、俄、英</li>
<li>名字：运动员的名字，10个字符以内，只有字母，区分大小写</li>
<li>项目：比赛获奖的项目，1-11，共11个项目。 录入成绩顺序，一个项目必须先录入金牌，再录入银牌，最后录入铜牌。</li>
<li>奖牌：金牌、银牌、铜牌</li>
</ul>
<h3 id="取消成绩"><a href="#取消成绩" class="headerlink" title="取消成绩"></a>取消成绩</h3><p>取消一条取得的成绩，该项目成绩取消后，其他选手的成绩自动上调。如：取消金牌，则原来的银牌变金牌，铜牌变银牌。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">bool cancle_score(int time, char * name, int sport);</div><div class="line">void query_score(void);</div></pre></td></tr></table></figure></p>
<h3 id="查询奖牌榜"><a href="#查询奖牌榜" class="headerlink" title="查询奖牌榜"></a>查询奖牌榜</h3><p>按照比赛获奖情况，生成奖牌榜，排序并显示。</p>
<p>例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">____________________________________________</div><div class="line">|  COUNTRY  | GOLD | SILVER | BRONZE | RANK |</div><div class="line">|-------------------------------------------|</div><div class="line">|      CHINA|     2|       0|       0|     1|</div><div class="line">|    AMERICA|     2|       0|       0|     1|</div><div class="line">|      KOREA|     0|       2|       0|     3|</div><div class="line">|     RUSSUA|     0|       0|       3|     4|</div><div class="line">|      JAPAN|     0|       0|       0|     5|</div><div class="line">|    ENGLAND|     0|       0|       0|     5|</div><div class="line">____________________________________________</div></pre></td></tr></table></figure></p>
<p>说明：</p>
<ul>
<li>排序规则：先金牌、再银牌、最后铜牌。</li>
<li>相同奖牌情况排序相同，比如并列第一的情况。</li>
</ul>
<a id="more"></a>
<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div><div class="line">554</div><div class="line">555</div><div class="line">556</div><div class="line">557</div><div class="line">558</div><div class="line">559</div><div class="line">560</div><div class="line">561</div><div class="line">562</div><div class="line">563</div><div class="line">564</div><div class="line">565</div><div class="line">566</div><div class="line">567</div><div class="line">568</div><div class="line">569</div><div class="line">570</div><div class="line">571</div><div class="line">572</div><div class="line">573</div><div class="line">574</div><div class="line">575</div><div class="line">576</div><div class="line">577</div><div class="line">578</div><div class="line">579</div><div class="line">580</div><div class="line">581</div><div class="line">582</div><div class="line">583</div><div class="line">584</div><div class="line">585</div><div class="line">586</div><div class="line">587</div><div class="line">588</div><div class="line">589</div><div class="line">590</div><div class="line">591</div><div class="line">592</div><div class="line">593</div><div class="line">594</div><div class="line">595</div><div class="line">596</div><div class="line">597</div><div class="line">598</div><div class="line">599</div><div class="line">600</div><div class="line">601</div><div class="line">602</div><div class="line">603</div><div class="line">604</div><div class="line">605</div><div class="line">606</div><div class="line">607</div><div class="line">608</div><div class="line">609</div><div class="line">610</div><div class="line">611</div><div class="line">612</div><div class="line">613</div><div class="line">614</div><div class="line">615</div><div class="line">616</div><div class="line">617</div><div class="line">618</div><div class="line">619</div><div class="line">620</div><div class="line">621</div><div class="line">622</div><div class="line">623</div><div class="line">624</div><div class="line">625</div><div class="line">626</div><div class="line">627</div><div class="line">628</div><div class="line">629</div><div class="line">630</div><div class="line">631</div><div class="line">632</div><div class="line">633</div><div class="line">634</div><div class="line">635</div><div class="line">636</div><div class="line">637</div><div class="line">638</div><div class="line">639</div><div class="line">640</div><div class="line">641</div><div class="line">642</div><div class="line">643</div><div class="line">644</div><div class="line">645</div><div class="line">646</div><div class="line">647</div><div class="line">648</div><div class="line">649</div><div class="line">650</div><div class="line">651</div><div class="line">652</div><div class="line">653</div><div class="line">654</div><div class="line">655</div><div class="line">656</div><div class="line">657</div><div class="line">658</div><div class="line">659</div><div class="line">660</div><div class="line">661</div><div class="line">662</div><div class="line">663</div><div class="line">664</div><div class="line">665</div><div class="line">666</div><div class="line">667</div><div class="line">668</div><div class="line">669</div><div class="line">670</div><div class="line">671</div><div class="line">672</div><div class="line">673</div><div class="line">674</div><div class="line">675</div><div class="line">676</div><div class="line">677</div><div class="line">678</div><div class="line">679</div><div class="line">680</div><div class="line">681</div><div class="line">682</div><div class="line">683</div><div class="line">684</div><div class="line">685</div><div class="line">686</div><div class="line">687</div><div class="line">688</div><div class="line">689</div><div class="line">690</div><div class="line">691</div><div class="line">692</div><div class="line">693</div><div class="line">694</div><div class="line">695</div><div class="line">696</div><div class="line">697</div><div class="line">698</div><div class="line">699</div><div class="line">700</div><div class="line">701</div><div class="line">702</div><div class="line">703</div><div class="line">704</div><div class="line">705</div><div class="line">706</div><div class="line">707</div><div class="line">708</div><div class="line">709</div><div class="line">710</div><div class="line">711</div><div class="line">712</div><div class="line">713</div><div class="line">714</div><div class="line">715</div><div class="line">716</div><div class="line">717</div><div class="line">718</div><div class="line">719</div><div class="line">720</div><div class="line">721</div><div class="line">722</div><div class="line">723</div><div class="line">724</div><div class="line">725</div><div class="line">726</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ctype.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DEBUG</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> false 0</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> true  1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> bool  int</span></div><div class="line"></div><div class="line"><span class="comment">/* prototype for medal */</span></div><div class="line"><span class="keyword">enum</span> Medal &#123;</div><div class="line">	MEDAL_BEGIN,</div><div class="line">	GOLD,</div><div class="line">	SILVER,</div><div class="line">	BRONZE,</div><div class="line">	MEDAL_END</div><div class="line">&#125;;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="number">_</span>medal_str &#123;</div><div class="line">	<span class="keyword">int</span> medal;</div><div class="line">	<span class="keyword">char</span> str[<span class="number">256</span>];</div><div class="line">&#125; medal_str;</div><div class="line">medal_str m_s[] = &#123;</div><div class="line">	&#123;MEDAL_BEGIN,<span class="string">"INVALID"</span>&#125;,</div><div class="line">	&#123;GOLD,<span class="string">"GOLD"</span>&#125;,</div><div class="line">	&#123;SILVER,<span class="string">"SILVER"</span>&#125;,</div><div class="line">	&#123;BRONZE,<span class="string">"BRONZE"</span>&#125;</div><div class="line">&#125;;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> medal2str(medal) m_s[medal].str</span></div><div class="line"></div><div class="line"><span class="comment">/* prototype for country */</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> COUNTRY_COUNT 6</span></div><div class="line"><span class="keyword">enum</span> Country &#123;</div><div class="line">	CHINA,</div><div class="line">	AMERICA,</div><div class="line">	JAPAN,</div><div class="line">	KOREA,</div><div class="line">	RUSSUA,</div><div class="line">	ENGLAND,</div><div class="line">	COUNTRY_END</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="number">_</span>country_str &#123;</div><div class="line">	<span class="keyword">int</span> country;</div><div class="line">	<span class="keyword">char</span> str[<span class="number">256</span>];</div><div class="line">&#125; country_str;</div><div class="line"></div><div class="line">country_str c_s[] = &#123;</div><div class="line">	&#123;CHINA, <span class="string">"CHINA"</span>&#125;,</div><div class="line">	&#123;AMERICA, <span class="string">"AMERICA"</span>&#125;,</div><div class="line">	&#123;JAPAN,<span class="string">"JAPAN"</span>&#125;,</div><div class="line">	&#123;KOREA,<span class="string">"KOREA"</span>&#125;,</div><div class="line">	&#123;RUSSUA,<span class="string">"RUSSUA"</span>&#125;,</div><div class="line">	&#123;ENGLAND,<span class="string">"ENGLAND"</span>&#125;</div><div class="line">&#125;;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> country2str(country) c_s[country].str</span></div><div class="line"></div><div class="line"><span class="comment">/* prototype for sport */</span></div><div class="line"><span class="keyword">enum</span> Sport &#123;</div><div class="line">	SPORT_BEGIN,</div><div class="line">	S1,S2,S3,S4,S5,S6,S7,S8,S9,S10,S11,</div><div class="line">	SPORT_END</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">/* prototype for game record */</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NAME_LEN 10</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="number">_</span>Record &#123;</div><div class="line">	<span class="keyword">int</span> time;</div><div class="line">	<span class="keyword">int</span> country;</div><div class="line">	<span class="keyword">char</span> name[NAME_LEN+<span class="number">1</span>];</div><div class="line">	<span class="keyword">int</span> sport;</div><div class="line">	<span class="keyword">int</span> medal;</div><div class="line">	<span class="keyword">bool</span> valid;	</div><div class="line">&#125; Record;</div><div class="line"></div><div class="line"><span class="comment">/* prototype for medal list */</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="number">_</span>medal_list &#123;</div><div class="line">	<span class="keyword">int</span> country;</div><div class="line">	<span class="keyword">int</span> gold;</div><div class="line">	<span class="keyword">int</span> silver;</div><div class="line">	<span class="keyword">int</span> bronze;</div><div class="line">	<span class="keyword">int</span> rank;</div><div class="line">&#125; MedalList;</div><div class="line"></div><div class="line"><span class="comment">/* Global vars */</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> REC_LEN 1024   <span class="comment">/* how many record can hold */</span></span></div><div class="line">Record record[REC_LEN];<span class="comment">/* where to hold all records */</span></div><div class="line"><span class="keyword">int</span>    current_record; <span class="comment">/* current count of record */</span></div><div class="line"><span class="keyword">int</span>    sys_time;       <span class="comment">/* system time */</span></div><div class="line">MedalList medal_list[COUNTRY_COUNT]; <span class="comment">/* country's medal list */</span></div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"> *  API of this program</div><div class="line"> *</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span> <span class="params">(<span class="keyword">void</span>)</span></span>;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">enter_score</span><span class="params">(<span class="keyword">int</span> time, <span class="keyword">int</span> country, <span class="keyword">char</span> * name, <span class="keyword">int</span> sport, <span class="keyword">int</span> medal)</span></span>;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cancle_score</span><span class="params">(<span class="keyword">int</span> time, <span class="keyword">char</span> * name, <span class="keyword">int</span> sport)</span></span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">query_score</span><span class="params">(<span class="keyword">void</span>)</span></span>;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"> * Internals</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check_name</span><span class="params">(<span class="keyword">int</span> country, <span class="keyword">char</span> * name)</span></span>; <span class="comment">/* check if name is ok */</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">err_report</span><span class="params">(<span class="keyword">char</span> * msg)</span>   <span class="comment">/* report error use for debug */</span></span></div><div class="line">&#123;</div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> DEBUG</span></div><div class="line">	<span class="built_in">printf</span>(<span class="string">"ERROR:%s\n"</span>,msg);</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check_sport_name_medal</span><span class="params">(<span class="keyword">int</span> sport,<span class="keyword">char</span>* name, <span class="keyword">int</span> medal)</span></span>;<span class="comment">/* check lots of conflicting cases */</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">print_record</span><span class="params">(<span class="keyword">void</span>)</span></span>; <span class="comment">/* print the record arry */</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">gen_medal_list</span><span class="params">(<span class="keyword">void</span>)</span></span>; <span class="comment">/* print the medal list */</span></div><div class="line"><span class="function"><span class="keyword">int</span>  <span class="title">comp_medal_list</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span>* <span class="number">_</span>a, <span class="keyword">const</span> <span class="keyword">void</span> * <span class="number">_b</span>)</span></span>; <span class="comment">/* use for sort the medal list*/</span></div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"> * Test cases</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">test_insert</span><span class="params">()</span></span>;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">test_cancle</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> TEST(func) \</span></div><div class="line">	printf(<span class="meta-string">"===================================================\n"</span>);\</div><div class="line">	printf(<span class="meta-string">"                Test %d                            \n"</span>,all_tests);\</div><div class="line">	printf(<span class="meta-string">"===================================================\n"</span>);\</div><div class="line">	<span class="meta-keyword">if</span> (func()) \</div><div class="line">	&#123;\</div><div class="line">		passed_tests++; \</div><div class="line">	printf(<span class="meta-string">"====Test %d PASSED=================================\n\n"</span>,all_tests);\</div><div class="line">	&#125;\</div><div class="line">	<span class="meta-keyword">else</span>\</div><div class="line">	&#123;\</div><div class="line">	printf(<span class="meta-string">"====Test %d FAILED=================================\n\n"</span>,all_tests);\</div><div class="line">	&#125;\</div><div class="line">	all_tests++;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">void</span>)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> i;</div><div class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; REC_LEN; i++)</div><div class="line">	&#123;</div><div class="line">		record[i].time = <span class="number">0</span>;</div><div class="line">		record[i].country = <span class="number">0</span>;</div><div class="line">		<span class="built_in">memset</span>(record[i].name,<span class="string">'\0'</span>,<span class="keyword">sizeof</span>(record[i].name));</div><div class="line">		record[i].sport = <span class="number">0</span>;</div><div class="line">		record[i].medal = <span class="number">0</span>;</div><div class="line">		record[i].valid = <span class="literal">true</span>; <span class="comment">/* default is true ,later can be set to false*/</span></div><div class="line">	&#125;</div><div class="line">	sys_time = <span class="number">0</span>;</div><div class="line">	current_record = <span class="number">0</span>;</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">enter_score</span><span class="params">(<span class="keyword">int</span> time, <span class="keyword">int</span> country, <span class="keyword">char</span> * name, <span class="keyword">int</span> sport, <span class="keyword">int</span> medal)</span></span></div><div class="line">&#123;</div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> DEBUG</span></div><div class="line">	<span class="built_in">printf</span>(<span class="string">"DEBUG: enter_score(time=%d,country=%s,name=%s,sport=%d,medal=%s)\n"</span>,</div><div class="line">						time, country2str(country), name, sport, medal2str(medal));</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line">	<span class="comment">/* check time within 0,30 */</span></div><div class="line">	<span class="keyword">if</span> (time &lt; <span class="number">0</span> || time &gt; <span class="number">30</span>)</div><div class="line">	&#123;</div><div class="line">		err_report(<span class="string">"time should be within [0,30]"</span>);</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/* check sys_time: time should &gt;= sys_time */</span></div><div class="line">	<span class="keyword">if</span> (time &lt; sys_time)</div><div class="line">	&#123;</div><div class="line">		err_report(<span class="string">"time should &gt;= sys_time"</span>);</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/* check if name is valied */</span></div><div class="line">	<span class="keyword">if</span> (!check_name(country, name))</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/* check if country valid */</span></div><div class="line">	<span class="keyword">if</span> (country &gt;= COUNTRY_END || country &lt; <span class="number">0</span>)</div><div class="line">	&#123;</div><div class="line">		err_report(<span class="string">"country is not valid"</span>);</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/* check if sport is valid */</span></div><div class="line">	<span class="keyword">if</span> (sport &gt;= SPORT_END || sport &lt;= SPORT_BEGIN)</div><div class="line">	&#123;</div><div class="line">		err_report(<span class="string">"sport is not valid"</span>);</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/* check if medal is valid */</span></div><div class="line">	<span class="keyword">if</span> (medal &gt;= MEDAL_END || medal &lt;= MEDAL_BEGIN)</div><div class="line">	&#123;</div><div class="line">		err_report(<span class="string">"medal is not valid"</span>);</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/* in the same sport: gold first, then silver, bronze come last */</span></div><div class="line">	<span class="comment">/* check if sport medal aready have */</span></div><div class="line">	<span class="keyword">if</span> (!check_sport_name_medal(sport,name, medal))</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/* check if we reach REC_LEN */</span></div><div class="line">	<span class="keyword">if</span> (current_record == REC_LEN)</div><div class="line">	&#123;</div><div class="line">		err_report(<span class="string">"no space for a new record"</span>);</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/* check ok, do the actual entry*/</span></div><div class="line">	record[current_record].country = country;</div><div class="line">	record[current_record].sport   = sport;</div><div class="line">	record[current_record].medal   = medal;</div><div class="line">	record[current_record].time    = time;</div><div class="line">	<span class="built_in">memcpy</span>(record[current_record].name,name,<span class="keyword">sizeof</span>(<span class="keyword">char</span>)*<span class="built_in">strlen</span>(name));</div><div class="line">	current_record++;</div><div class="line"></div><div class="line">	<span class="comment">/* update the systime */</span></div><div class="line">	sys_time = time;</div><div class="line">	<span class="keyword">return</span> <span class="literal">true</span>;		</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check_name</span><span class="params">(<span class="keyword">int</span> country, <span class="keyword">char</span> * name)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> i, len;</div><div class="line">	<span class="comment">/* check name length */</span></div><div class="line">	<span class="keyword">if</span> (!name)</div><div class="line">	&#123;</div><div class="line">		err_report(<span class="string">"name can not be NULL"</span>);</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line">	len = <span class="built_in">strlen</span>(name);</div><div class="line">	<span class="keyword">if</span> (len &gt; NAME_LEN)</div><div class="line">	&#123;</div><div class="line">		err_report(<span class="string">"name len should be 1 to 10"</span>);</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/* check if name contain ony letters */</span></div><div class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span> (!<span class="built_in">isalpha</span>(name[i]))</div><div class="line">		&#123;</div><div class="line">			err_report(<span class="string">"name contains char that is not alpha"</span>);</div><div class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/* check if already have the same name in another country*/</span></div><div class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; current_record; i++)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span> (<span class="built_in">strcmp</span>(record[i].name,name) == <span class="number">0</span> &amp;&amp; record[i].country != country)</div><div class="line">		&#123;</div><div class="line">			err_report(<span class="string">"player cannot play in different country"</span>);</div><div class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">		&#125;		</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check_sport_name_medal</span><span class="params">(<span class="keyword">int</span> sport, <span class="keyword">char</span> * name, <span class="keyword">int</span> medal)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> i;</div><div class="line">	<span class="keyword">int</span> found_gold = <span class="literal">false</span>;</div><div class="line">	<span class="keyword">int</span> found_silver = <span class="literal">false</span>;</div><div class="line">	<span class="keyword">int</span> found_bronze = <span class="literal">false</span>;</div><div class="line">	<span class="comment">/* if the record is empty */</span></div><div class="line">	<span class="keyword">if</span> (current_record == <span class="number">0</span> &amp;&amp; medal != GOLD)</div><div class="line">	&#123;</div><div class="line">			err_report(<span class="string">"GOLD for this sport  must come first"</span>);</div><div class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/* the first record of the game must be gold */</span></div><div class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; current_record; i++)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span> (record[i].sport == sport &amp;&amp; record[i].medal == GOLD)</div><div class="line">		&#123;</div><div class="line">			found_gold = <span class="literal">true</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span> (record[i].sport == sport &amp;&amp; record[i].medal == SILVER)</div><div class="line">		&#123;</div><div class="line">			found_silver = <span class="literal">true</span>;	</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span> (record[i].sport == sport &amp;&amp; record[i].medal == BRONZE)</div><div class="line">		&#123;</div><div class="line">			found_bronze = <span class="literal">true</span>;	</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/* the record is not empty loop the record */</span>	</div><div class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; current_record; i++)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span> (record[i].sport == sport &amp;&amp; </div><div class="line">			<span class="built_in">strcmp</span>(name,record[i].name) == <span class="number">0</span>)</div><div class="line">		&#123;</div><div class="line">			err_report(<span class="string">"sport has played by the player"</span>);</div><div class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line"></div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="keyword">if</span> (record[i].sport == sport &amp;&amp; </div><div class="line">			record[i].medal == medal &amp;&amp;</div><div class="line">			record[i].valid)</div><div class="line">		&#123;</div><div class="line">			err_report(<span class="string">"sport has already has the medal"</span>);</div><div class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line"></div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="keyword">if</span> (record[i].sport == sport &amp;&amp;</div><div class="line">			record[i].medal == medal &amp;&amp;</div><div class="line">			!record[i].valid         &amp;&amp;</div><div class="line">			<span class="built_in">strcmp</span>(name,record[i].name) == <span class="number">0</span>)</div><div class="line">	 	&#123;</div><div class="line">			err_report(<span class="string">"current sport and medal win by player has been cancled"</span>);</div><div class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">			</div><div class="line">		&#125;</div><div class="line"></div><div class="line"></div><div class="line">		<span class="keyword">if</span> (record[i].sport == sport &amp;&amp;</div><div class="line">			record[i].medal != MEDAL_BEGIN &amp;&amp;</div><div class="line">			record[i].valid    	     &amp;&amp;</div><div class="line">			<span class="built_in">strcmp</span>(name,record[i].name) == <span class="number">0</span>)</div><div class="line">	 	&#123;</div><div class="line">			err_report(<span class="string">"medal for this sport cannot be won by same player twice"</span>);</div><div class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">			</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="keyword">if</span> (record[i].sport == sport &amp;&amp; record[i].valid)</div><div class="line">		&#123;</div><div class="line">			<span class="keyword">if</span> (medal == GOLD &amp;&amp; !found_gold)</div><div class="line">			&#123;</div><div class="line">				<span class="comment">/* there are already silver or bronze in this sport*/</span></div><div class="line">				<span class="keyword">if</span> (record[i].medal == SILVER ||</div><div class="line">					record[i].medal == BRONZE)</div><div class="line">				&#123;</div><div class="line">					err_report(<span class="string">"GOLD for this sport must be entered first"</span>);</div><div class="line">					<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			</div><div class="line">			<span class="keyword">if</span> (medal == SILVER &amp;&amp; !found_silver &amp;&amp; found_gold)</div><div class="line">			&#123;</div><div class="line">				<span class="comment">/* there are already bronze in this sport*/</span></div><div class="line">				<span class="keyword">if</span> (record[i].medal == BRONZE)</div><div class="line">				&#123;</div><div class="line">					err_report(<span class="string">"SILVER for this sport  must be entered second"</span>);</div><div class="line">					<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">	</div><div class="line">			<span class="keyword">if</span> (medal == BRONZE &amp;&amp; !found_bronze &amp;&amp; found_silver &amp;&amp; found_gold)</div><div class="line">			&#123;</div><div class="line">				<span class="keyword">continue</span>;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span>  <span class="title">cancle_score</span><span class="params">(<span class="keyword">int</span> time, <span class="keyword">char</span> * name, <span class="keyword">int</span> sport)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> i , flag = <span class="literal">false</span>, found = <span class="literal">false</span>;</div><div class="line">	<span class="keyword">int</span> cancled_medal;</div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> DEBUG</span></div><div class="line">	<span class="built_in">printf</span>(<span class="string">"DEBUG:cancle_score(time=%d,name=%s,sport=%d)\n"</span>,</div><div class="line">			time,name,sport);</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line">	<span class="keyword">if</span> (!name)</div><div class="line">	&#123;</div><div class="line">		err_report(<span class="string">"name cannot be null"</span>);</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/* check time within 0,30 */</span></div><div class="line">	<span class="keyword">if</span> (time &lt; <span class="number">0</span> || time &gt; <span class="number">30</span>)</div><div class="line">	&#123;</div><div class="line">		err_report(<span class="string">"time should be within [0,30]"</span>);</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/* check if sport is valid */</span></div><div class="line">	<span class="keyword">if</span> (sport &gt;= SPORT_END || sport &lt;= SPORT_BEGIN)</div><div class="line">	&#123;</div><div class="line">		err_report(<span class="string">"sport is not valid"</span>);</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; current_record ; i++)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span> (record[i].time == time &amp;&amp;</div><div class="line">			record[i].sport == sport &amp;&amp;</div><div class="line">			(<span class="built_in">strcmp</span>(record[i].name, name) == <span class="number">0</span>))</div><div class="line">		&#123;</div><div class="line">			found = <span class="literal">true</span>;</div><div class="line">			<span class="keyword">if</span> (record[i].valid)</div><div class="line">			&#123;</div><div class="line">				record[i].valid = <span class="literal">false</span>;</div><div class="line">				cancled_medal   = record[i].medal;</div><div class="line">				flag = <span class="literal">true</span>;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">else</span></div><div class="line">			&#123;</div><div class="line"></div><div class="line">				flag = <span class="literal">false</span>;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (!found)</div><div class="line">	&#123;</div><div class="line">		err_report(<span class="string">"no matching score to be cancled"</span>);</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (!flag)</div><div class="line">	&#123;</div><div class="line">		err_report(<span class="string">"score already cancled"</span>);	</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/* do upgrade work */</span></div><div class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; current_record; i++)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span> (sport == record[i].sport &amp;&amp; record[i].valid)</div><div class="line">		&#123;</div><div class="line">			<span class="keyword">switch</span>(cancled_medal)</div><div class="line">			&#123;</div><div class="line">				<span class="keyword">case</span> GOLD:</div><div class="line">					<span class="keyword">if</span> (record[i].medal == SILVER ||</div><div class="line">						record[i].medal == BRONZE)</div><div class="line">					&#123;</div><div class="line">						record[i].medal --;</div><div class="line">					&#125;</div><div class="line">				<span class="keyword">break</span>;</div><div class="line">				<span class="keyword">case</span> SILVER:</div><div class="line">					<span class="keyword">if</span> (record[i].medal == BRONZE)</div><div class="line">					&#123;</div><div class="line">						record[i].medal --;</div><div class="line">					&#125;</div><div class="line">				<span class="keyword">break</span>;</div><div class="line">				<span class="keyword">case</span> BRONZE:</div><div class="line">					<span class="keyword">continue</span>;</div><div class="line">				<span class="keyword">break</span>;</div><div class="line"></div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">print_record</span><span class="params">(<span class="keyword">void</span>)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> i;</div><div class="line"></div><div class="line">	<span class="built_in">printf</span>(<span class="string">"____________________________________________________________\n"</span>);</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"|   TIME  |  COUNTRY  |  SPORT  |   NAME   |  MEDAL | VALID |\n"</span>);</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"|-----------------------------------------------------------|\n"</span>);</div><div class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; current_record ; i++)</div><div class="line">	&#123;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"|%9d|%10s |%8d |%10s|%8s | %5s|\n"</span>,</div><div class="line">				record[i].time,</div><div class="line">				country2str(record[i].country),</div><div class="line">				record[i].sport,</div><div class="line">				record[i].name,</div><div class="line">				medal2str(record[i].medal),</div><div class="line">				record[i].valid == <span class="literal">true</span> ? <span class="string">"true"</span> : <span class="string">"false"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"____________________________________________________________\n"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">comp_medal_list</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span>* <span class="number">_</span>a, <span class="keyword">const</span> <span class="keyword">void</span> * <span class="number">_b</span>)</span></span></div><div class="line">&#123;</div><div class="line">	MedalList* a = (MedalList*) <span class="number">_</span>a;</div><div class="line">	MedalList* b = (MedalList*) <span class="number">_b</span>;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (a-&gt;gold &gt; b-&gt;gold)</div><div class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">	<span class="keyword">if</span> (a-&gt;gold &lt; b-&gt;gold)</div><div class="line">		<span class="keyword">return</span> <span class="number">1</span>;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (a-&gt;silver &gt; b-&gt;silver)</div><div class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">	<span class="keyword">if</span> (a-&gt;silver &lt; b-&gt;silver)</div><div class="line">		<span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">	</div><div class="line">	<span class="keyword">if</span> (a-&gt;bronze &gt; b-&gt;bronze)</div><div class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">	<span class="keyword">if</span> (a-&gt;bronze &lt; b-&gt;bronze)</div><div class="line">		<span class="keyword">return</span> <span class="number">1</span>;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">	</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">gen_medal_list</span><span class="params">(<span class="keyword">void</span>)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> i;</div><div class="line">	<span class="keyword">int</span> rank_skip = <span class="number">0</span>;</div><div class="line">	<span class="keyword">int</span> curr_rank = <span class="number">1</span>;</div><div class="line"></div><div class="line">	<span class="comment">/* clear the medal list first */</span></div><div class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; COUNTRY_COUNT; i++)</div><div class="line">	&#123;</div><div class="line">		medal_list[i].country = i;</div><div class="line">		medal_list[i].gold    = <span class="number">0</span>;</div><div class="line">		medal_list[i].silver  = <span class="number">0</span>;</div><div class="line">		medal_list[i].bronze  = <span class="number">0</span>;</div><div class="line">		medal_list[i].rank    = <span class="number">0</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/* add the record into medal list */</span></div><div class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; current_record ; i++)</div><div class="line">	&#123;</div><div class="line">		</div><div class="line">		<span class="comment">/* only check for valid record */</span></div><div class="line">		<span class="keyword">if</span> (!record[i].valid)</div><div class="line">			<span class="keyword">continue</span>;</div><div class="line"></div><div class="line">		medal_list[record[i].country].gold  += record[i].medal == GOLD   ? <span class="number">1</span>:<span class="number">0</span>; </div><div class="line">		medal_list[record[i].country].silver+= record[i].medal == SILVER ? <span class="number">1</span>:<span class="number">0</span>; </div><div class="line">		medal_list[record[i].country].bronze+= record[i].medal == BRONZE ? <span class="number">1</span>:<span class="number">0</span>; </div><div class="line">	&#125;</div><div class="line"></div><div class="line"></div><div class="line">	<span class="comment">/* sort the medal list, ignore the first one */</span></div><div class="line">	qsort(medal_list, COUNTRY_COUNT, <span class="keyword">sizeof</span>(MedalList), comp_medal_list);</div><div class="line">	</div><div class="line">	medal_list[<span class="number">0</span>].rank = curr_rank;	</div><div class="line">	<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; COUNTRY_COUNT; i++)</div><div class="line">	&#123;</div><div class="line">		<span class="comment">/* if rank is the same */</span></div><div class="line">		<span class="keyword">if</span> (medal_list[i].gold == medal_list[i<span class="number">-1</span>].gold &amp;&amp;</div><div class="line">			medal_list[i].silver == medal_list[i<span class="number">-1</span>].silver &amp;&amp;	</div><div class="line">			medal_list[i].bronze == medal_list[i<span class="number">-1</span>].bronze )	</div><div class="line">		&#123;</div><div class="line">			medal_list[i].rank = curr_rank;</div><div class="line">			rank_skip++;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span></div><div class="line">		&#123;</div><div class="line">			curr_rank++;</div><div class="line">			medal_list[i].rank = curr_rank + rank_skip;</div><div class="line">			curr_rank += rank_skip;			</div><div class="line">			rank_skip = <span class="number">0</span>;</div><div class="line">	</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">query_score</span><span class="params">(<span class="keyword">void</span>)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> i = <span class="number">0</span>;</div><div class="line">	</div><div class="line">	<span class="comment">/* do the hard work */</span></div><div class="line">	gen_medal_list();</div><div class="line"></div><div class="line">	<span class="comment">/* ok, output the table */</span></div><div class="line">	<span class="built_in">printf</span>(<span class="string">"____________________________________________\n"</span>);</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"|  COUNTRY  | GOLD | SILVER | BRONZE | RANK |\n"</span>);</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"|-------------------------------------------|\n"</span>);</div><div class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; COUNTRY_COUNT; i++)	</div><div class="line">	&#123;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"|%11s|%6d|%8d|%8d|%6d|\n"</span>,</div><div class="line">			country2str(medal_list[i].country),</div><div class="line">			medal_list[i].gold,</div><div class="line">			medal_list[i].silver,</div><div class="line">			medal_list[i].bronze,</div><div class="line">			medal_list[i].rank</div><div class="line">			);</div><div class="line">	</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"____________________________________________\n"</span>);</div><div class="line">&#125;</div><div class="line"><span class="comment">/* below are all test cases */</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">test_insert</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	init();</div><div class="line">	<span class="keyword">if</span> (!enter_score(<span class="number">0</span>,CHINA,<span class="string">"yshen"</span>,S1,GOLD))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="keyword">if</span> (!enter_score(<span class="number">1</span>,CHINA,<span class="string">"lmwang"</span>,S2,GOLD))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="keyword">if</span> (!enter_score(<span class="number">1</span>,AMERICA,<span class="string">"xiaohua"</span>,S3,GOLD))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="keyword">if</span> (!enter_score(<span class="number">2</span>,AMERICA,<span class="string">"xiaoming"</span>,S4,GOLD))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="keyword">if</span> (!enter_score(<span class="number">2</span>,KOREA,<span class="string">"ddf"</span>,S5,SILVER))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="keyword">if</span> (!enter_score(<span class="number">2</span>,KOREA,<span class="string">"xiaox"</span>,S6,SILVER))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="keyword">if</span> (!enter_score(<span class="number">3</span>,RUSSUA,<span class="string">"xtyu"</span>,S7,BRONZE))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="keyword">if</span> (!enter_score(<span class="number">3</span>,RUSSUA,<span class="string">"xtyu"</span>,S8,BRONZE))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="keyword">if</span> (!enter_score(<span class="number">3</span>,RUSSUA,<span class="string">"xtyu"</span>,S9,BRONZE))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	print_record();</div><div class="line">	query_score();</div><div class="line">	<span class="comment">/* should fail: invalid name */</span></div><div class="line">	<span class="keyword">if</span> (enter_score(<span class="number">3</span>,CHINA,<span class="string">"1234"</span>,S2,GOLD))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="comment">/* should fail: invalid time */</span></div><div class="line">	<span class="keyword">if</span> (enter_score(<span class="number">0</span>,CHINA,<span class="string">"yshen"</span>,S2,GOLD))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="comment">/* should fail: medal already won by others */</span></div><div class="line">	<span class="keyword">if</span> (enter_score(<span class="number">6</span>,CHINA,<span class="string">"player"</span>,S2,GOLD))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="comment">/* should fail: yshen cannot win twice one game */</span></div><div class="line">	<span class="keyword">if</span> (enter_score(<span class="number">6</span>,CHINA,<span class="string">"yshen"</span>,S1,GOLD))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="comment">/* fail: yshen cannot play in two different country */</span></div><div class="line">	<span class="keyword">if</span> (enter_score(<span class="number">6</span>,AMERICA,<span class="string">"yshen"</span>,S8,GOLD))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="comment">/* fail: sport is not valid */</span></div><div class="line">	<span class="keyword">if</span> (enter_score(<span class="number">6</span>,AMERICA,<span class="string">"llt"</span>,<span class="number">100</span>,GOLD))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="comment">/* fail: name len=11 is not valid*/</span></div><div class="line">	<span class="keyword">if</span> (enter_score(<span class="number">6</span>,AMERICA,<span class="string">"abcdefghijk"</span>,S10,SILVER))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="comment">/* fail: name len=11 is not valid*/</span></div><div class="line">	<span class="keyword">if</span> (enter_score(<span class="number">6</span>,AMERICA,<span class="literal">NULL</span>,S10,SILVER))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	print_record();</div><div class="line">	query_score();</div><div class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">test_cancle</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	init();</div><div class="line">	<span class="keyword">if</span> (!enter_score(<span class="number">0</span>,CHINA,<span class="string">"shenyu"</span>,S1,GOLD))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="comment">/* only can be entered once */</span></div><div class="line">	<span class="keyword">if</span> (enter_score(<span class="number">0</span>,CHINA,<span class="string">"shenyu"</span>,S1,GOLD))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="keyword">if</span> (!enter_score(<span class="number">1</span>,CHINA,<span class="string">"lmwang"</span>,S2,GOLD))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="keyword">if</span> (!cancle_score(<span class="number">1</span>,<span class="string">"lmwang"</span>,S2))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="comment">/* cancel again should fail */</span></div><div class="line">	<span class="keyword">if</span> (cancle_score(<span class="number">1</span>,<span class="string">"lmwang"</span>,S2))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="comment">/* cancled score cannot be entered again */</span></div><div class="line">	<span class="keyword">if</span> (enter_score(<span class="number">1</span>,CHINA,<span class="string">"lmwang"</span>,S2,GOLD))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="comment">/* S2 can be win by others */</span></div><div class="line">	<span class="keyword">if</span> (!enter_score(<span class="number">1</span>,CHINA,<span class="string">"shenyu"</span>,S2,GOLD))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	print_record();</div><div class="line">	<span class="comment">/* player can win other game  */</span></div><div class="line">	<span class="keyword">if</span> (!enter_score(<span class="number">1</span>,CHINA,<span class="string">"lmwang"</span>,S3,GOLD))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	print_record();</div><div class="line">	<span class="comment">/* cancled score should not be inside */</span></div><div class="line">	query_score();</div><div class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">test_gold_order</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	init();</div><div class="line"></div><div class="line">	<span class="comment">/* check gold must be first */</span></div><div class="line">	<span class="keyword">if</span> (enter_score(<span class="number">0</span>,CHINA,<span class="string">"shenyu"</span>,S1,SILVER))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="comment">/* ok, first rec */</span></div><div class="line">	<span class="keyword">if</span> (!enter_score(<span class="number">0</span>,CHINA,<span class="string">"shenyu"</span>,S1,GOLD))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="comment">/* player cannot win silver and gold of same game */</span></div><div class="line">	<span class="keyword">if</span> (enter_score(<span class="number">0</span>,CHINA,<span class="string">"shenyu"</span>,S1,SILVER))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="comment">/* ok, second rec */</span></div><div class="line">	<span class="keyword">if</span> (!enter_score(<span class="number">0</span>,CHINA,<span class="string">"shenyu"</span>,S2,BRONZE))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="comment">/* gold cannot come after bronze */</span>	</div><div class="line">	<span class="keyword">if</span> (enter_score(<span class="number">0</span>,CHINA,<span class="string">"wlm"</span>,S2,GOLD))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	print_record();</div><div class="line">	query_score();</div><div class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">	</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">test_upgrade</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	init();</div><div class="line">	</div><div class="line">	<span class="comment">/* check gold must be first */</span></div><div class="line">	<span class="keyword">if</span> (!enter_score(<span class="number">0</span>,CHINA,<span class="string">"shenyu"</span>,S1,GOLD))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="comment">/* check gold must be first */</span></div><div class="line">	<span class="keyword">if</span> (!enter_score(<span class="number">0</span>,CHINA,<span class="string">"shenyu"</span>,S2,GOLD))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="comment">/* check gold must be first */</span></div><div class="line">	<span class="keyword">if</span> (!enter_score(<span class="number">0</span>,CHINA,<span class="string">"wanglim"</span>,S1,SILVER))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="comment">/* check gold must be first */</span></div><div class="line">	<span class="keyword">if</span> (!cancle_score(<span class="number">0</span>,<span class="string">"shenyu"</span>,S1))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="comment">/* check gold must be first */</span></div><div class="line">	<span class="keyword">if</span> (enter_score(<span class="number">0</span>,CHINA,<span class="string">"shenyu"</span>,S1,SILVER))</div><div class="line">	&#123;</div><div class="line">		print_record();</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/* check gold must be first */</span></div><div class="line">	<span class="keyword">if</span> (!enter_score(<span class="number">0</span>,CHINA,<span class="string">"xiaoqia"</span>,S1,SILVER))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="comment">/* check gold must be first */</span></div><div class="line">	<span class="keyword">if</span> (!enter_score(<span class="number">0</span>,CHINA,<span class="string">"xiaohua"</span>,S1,BRONZE))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	<span class="comment">/* check gold must be first */</span></div><div class="line">	<span class="keyword">if</span> (!cancle_score(<span class="number">0</span>,<span class="string">"wanglim"</span>,S1))</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;	</div><div class="line">	print_record();</div><div class="line">	query_score();</div><div class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">/* TESTS */</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> all_tests = <span class="number">0</span>, passed_tests = <span class="number">0</span>;</div><div class="line">	TEST(test_insert);</div><div class="line">	TEST(test_cancle);</div><div class="line">	TEST(test_gold_order);</div><div class="line">	TEST(test_upgrade);</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"====Test Results===================================\n"</span>);</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"all    tests: %d\n"</span>, all_tests);</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"passed tests: %d\n"</span>, passed_tests);</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"===================================================\n"</span>);</div><div class="line">	</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div></pre></td><td class="code"><pre><div class="line">===================================================</div><div class="line">                Test 0                            </div><div class="line">===================================================</div><div class="line">DEBUG: enter_score(time=0,country=CHINA,name=yshen,sport=1,medal=GOLD)</div><div class="line">DEBUG: enter_score(time=1,country=CHINA,name=lmwang,sport=2,medal=GOLD)</div><div class="line">DEBUG: enter_score(time=1,country=AMERICA,name=xiaohua,sport=3,medal=GOLD)</div><div class="line">DEBUG: enter_score(time=2,country=AMERICA,name=xiaoming,sport=4,medal=GOLD)</div><div class="line">DEBUG: enter_score(time=2,country=KOREA,name=ddf,sport=5,medal=SILVER)</div><div class="line">DEBUG: enter_score(time=2,country=KOREA,name=xiaox,sport=6,medal=SILVER)</div><div class="line">DEBUG: enter_score(time=3,country=RUSSUA,name=xtyu,sport=7,medal=BRONZE)</div><div class="line">DEBUG: enter_score(time=3,country=RUSSUA,name=xtyu,sport=8,medal=BRONZE)</div><div class="line">DEBUG: enter_score(time=3,country=RUSSUA,name=xtyu,sport=9,medal=BRONZE)</div><div class="line">____________________________________________________________</div><div class="line">|   TIME  |  COUNTRY  |  SPORT  |   NAME   |  MEDAL | VALID |</div><div class="line">|-----------------------------------------------------------|</div><div class="line">|        0|     CHINA |       1 |     yshen|    GOLD |  true|</div><div class="line">|        1|     CHINA |       2 |    lmwang|    GOLD |  true|</div><div class="line">|        1|   AMERICA |       3 |   xiaohua|    GOLD |  true|</div><div class="line">|        2|   AMERICA |       4 |  xiaoming|    GOLD |  true|</div><div class="line">|        2|     KOREA |       5 |       ddf|  SILVER |  true|</div><div class="line">|        2|     KOREA |       6 |     xiaox|  SILVER |  true|</div><div class="line">|        3|    RUSSUA |       7 |      xtyu|  BRONZE |  true|</div><div class="line">|        3|    RUSSUA |       8 |      xtyu|  BRONZE |  true|</div><div class="line">|        3|    RUSSUA |       9 |      xtyu|  BRONZE |  true|</div><div class="line">____________________________________________________________</div><div class="line">____________________________________________</div><div class="line">|  COUNTRY  | GOLD | SILVER | BRONZE | RANK |</div><div class="line">|-------------------------------------------|</div><div class="line">|      CHINA|     2|       0|       0|     1|</div><div class="line">|    AMERICA|     2|       0|       0|     1|</div><div class="line">|      KOREA|     0|       2|       0|     3|</div><div class="line">|     RUSSUA|     0|       0|       3|     4|</div><div class="line">|      JAPAN|     0|       0|       0|     5|</div><div class="line">|    ENGLAND|     0|       0|       0|     5|</div><div class="line">____________________________________________</div><div class="line">DEBUG: enter_score(time=3,country=CHINA,name=1234,sport=2,medal=GOLD)</div><div class="line">ERROR:name contains char that is not alpha</div><div class="line">DEBUG: enter_score(time=0,country=CHINA,name=yshen,sport=2,medal=GOLD)</div><div class="line">ERROR:time should &gt;= sys_time</div><div class="line">DEBUG: enter_score(time=6,country=CHINA,name=player,sport=2,medal=GOLD)</div><div class="line">ERROR:sport has already has the medal</div><div class="line">DEBUG: enter_score(time=6,country=CHINA,name=yshen,sport=1,medal=GOLD)</div><div class="line">ERROR:sport has played by the player</div><div class="line">DEBUG: enter_score(time=6,country=AMERICA,name=yshen,sport=8,medal=GOLD)</div><div class="line">ERROR:player cannot play in different country</div><div class="line">DEBUG: enter_score(time=6,country=AMERICA,name=llt,sport=100,medal=GOLD)</div><div class="line">ERROR:sport is not valid</div><div class="line">DEBUG: enter_score(time=6,country=AMERICA,name=abcdefghijk,sport=10,medal=SILVER)</div><div class="line">ERROR:name len should be 1 to 10</div><div class="line">DEBUG: enter_score(time=6,country=AMERICA,name=(null),sport=10,medal=SILVER)</div><div class="line">ERROR:name can not be NULL</div><div class="line">____________________________________________________________</div><div class="line">|   TIME  |  COUNTRY  |  SPORT  |   NAME   |  MEDAL | VALID |</div><div class="line">|-----------------------------------------------------------|</div><div class="line">|        0|     CHINA |       1 |     yshen|    GOLD |  true|</div><div class="line">|        1|     CHINA |       2 |    lmwang|    GOLD |  true|</div><div class="line">|        1|   AMERICA |       3 |   xiaohua|    GOLD |  true|</div><div class="line">|        2|   AMERICA |       4 |  xiaoming|    GOLD |  true|</div><div class="line">|        2|     KOREA |       5 |       ddf|  SILVER |  true|</div><div class="line">|        2|     KOREA |       6 |     xiaox|  SILVER |  true|</div><div class="line">|        3|    RUSSUA |       7 |      xtyu|  BRONZE |  true|</div><div class="line">|        3|    RUSSUA |       8 |      xtyu|  BRONZE |  true|</div><div class="line">|        3|    RUSSUA |       9 |      xtyu|  BRONZE |  true|</div><div class="line">____________________________________________________________</div><div class="line">____________________________________________</div><div class="line">|  COUNTRY  | GOLD | SILVER | BRONZE | RANK |</div><div class="line">|-------------------------------------------|</div><div class="line">|      CHINA|     2|       0|       0|     1|</div><div class="line">|    AMERICA|     2|       0|       0|     1|</div><div class="line">|      KOREA|     0|       2|       0|     3|</div><div class="line">|     RUSSUA|     0|       0|       3|     4|</div><div class="line">|      JAPAN|     0|       0|       0|     5|</div><div class="line">|    ENGLAND|     0|       0|       0|     5|</div><div class="line">____________________________________________</div><div class="line">====Test 0 PASSED=================================</div><div class="line"></div><div class="line">===================================================</div><div class="line">                Test 1                            </div><div class="line">===================================================</div><div class="line">DEBUG: enter_score(time=0,country=CHINA,name=shenyu,sport=1,medal=GOLD)</div><div class="line">DEBUG: enter_score(time=0,country=CHINA,name=shenyu,sport=1,medal=GOLD)</div><div class="line">ERROR:sport has played by the player</div><div class="line">DEBUG: enter_score(time=1,country=CHINA,name=lmwang,sport=2,medal=GOLD)</div><div class="line">DEBUG:cancle_score(time=1,name=lmwang,sport=2)</div><div class="line">DEBUG:cancle_score(time=1,name=lmwang,sport=2)</div><div class="line">ERROR:score already cancled</div><div class="line">DEBUG: enter_score(time=1,country=CHINA,name=lmwang,sport=2,medal=GOLD)</div><div class="line">ERROR:sport has played by the player</div><div class="line">DEBUG: enter_score(time=1,country=CHINA,name=shenyu,sport=2,medal=GOLD)</div><div class="line">____________________________________________________________</div><div class="line">|   TIME  |  COUNTRY  |  SPORT  |   NAME   |  MEDAL | VALID |</div><div class="line">|-----------------------------------------------------------|</div><div class="line">|        0|     CHINA |       1 |    shenyu|    GOLD |  true|</div><div class="line">|        1|     CHINA |       2 |    lmwang|    GOLD | false|</div><div class="line">|        1|     CHINA |       2 |    shenyu|    GOLD |  true|</div><div class="line">____________________________________________________________</div><div class="line">DEBUG: enter_score(time=1,country=CHINA,name=lmwang,sport=3,medal=GOLD)</div><div class="line">____________________________________________________________</div><div class="line">|   TIME  |  COUNTRY  |  SPORT  |   NAME   |  MEDAL | VALID |</div><div class="line">|-----------------------------------------------------------|</div><div class="line">|        0|     CHINA |       1 |    shenyu|    GOLD |  true|</div><div class="line">|        1|     CHINA |       2 |    lmwang|    GOLD | false|</div><div class="line">|        1|     CHINA |       2 |    shenyu|    GOLD |  true|</div><div class="line">|        1|     CHINA |       3 |    lmwang|    GOLD |  true|</div><div class="line">____________________________________________________________</div><div class="line">____________________________________________</div><div class="line">|  COUNTRY  | GOLD | SILVER | BRONZE | RANK |</div><div class="line">|-------------------------------------------|</div><div class="line">|      CHINA|     3|       0|       0|     1|</div><div class="line">|    AMERICA|     0|       0|       0|     2|</div><div class="line">|      JAPAN|     0|       0|       0|     2|</div><div class="line">|      KOREA|     0|       0|       0|     2|</div><div class="line">|     RUSSUA|     0|       0|       0|     2|</div><div class="line">|    ENGLAND|     0|       0|       0|     2|</div><div class="line">____________________________________________</div><div class="line">====Test 1 PASSED=================================</div><div class="line"></div><div class="line">===================================================</div><div class="line">                Test 2                            </div><div class="line">===================================================</div><div class="line">DEBUG: enter_score(time=0,country=CHINA,name=shenyu,sport=1,medal=SILVER)</div><div class="line">ERROR:GOLD for this sport  must come first</div><div class="line">DEBUG: enter_score(time=0,country=CHINA,name=shenyu,sport=1,medal=GOLD)</div><div class="line">DEBUG: enter_score(time=0,country=CHINA,name=shenyu,sport=1,medal=SILVER)</div><div class="line">ERROR:sport has played by the player</div><div class="line">DEBUG: enter_score(time=0,country=CHINA,name=shenyu,sport=2,medal=BRONZE)</div><div class="line">DEBUG: enter_score(time=0,country=CHINA,name=wlm,sport=2,medal=GOLD)</div><div class="line">ERROR:GOLD for this sport must be entered first</div><div class="line">____________________________________________________________</div><div class="line">|   TIME  |  COUNTRY  |  SPORT  |   NAME   |  MEDAL | VALID |</div><div class="line">|-----------------------------------------------------------|</div><div class="line">|        0|     CHINA |       1 |    shenyu|    GOLD |  true|</div><div class="line">|        0|     CHINA |       2 |    shenyu|  BRONZE |  true|</div><div class="line">____________________________________________________________</div><div class="line">____________________________________________</div><div class="line">|  COUNTRY  | GOLD | SILVER | BRONZE | RANK |</div><div class="line">|-------------------------------------------|</div><div class="line">|      CHINA|     1|       0|       1|     1|</div><div class="line">|    AMERICA|     0|       0|       0|     2|</div><div class="line">|      JAPAN|     0|       0|       0|     2|</div><div class="line">|      KOREA|     0|       0|       0|     2|</div><div class="line">|     RUSSUA|     0|       0|       0|     2|</div><div class="line">|    ENGLAND|     0|       0|       0|     2|</div><div class="line">____________________________________________</div><div class="line">====Test 2 PASSED=================================</div><div class="line"></div><div class="line">===================================================</div><div class="line">                Test 3                            </div><div class="line">===================================================</div><div class="line">DEBUG: enter_score(time=0,country=CHINA,name=shenyu,sport=1,medal=GOLD)</div><div class="line">DEBUG: enter_score(time=0,country=CHINA,name=shenyu,sport=2,medal=GOLD)</div><div class="line">DEBUG: enter_score(time=0,country=CHINA,name=wanglim,sport=1,medal=SILVER)</div><div class="line">DEBUG:cancle_score(time=0,name=shenyu,sport=1)</div><div class="line">DEBUG: enter_score(time=0,country=CHINA,name=shenyu,sport=1,medal=SILVER)</div><div class="line">ERROR:sport has played by the player</div><div class="line">DEBUG: enter_score(time=0,country=CHINA,name=xiaoqia,sport=1,medal=SILVER)</div><div class="line">DEBUG: enter_score(time=0,country=CHINA,name=xiaohua,sport=1,medal=BRONZE)</div><div class="line">DEBUG:cancle_score(time=0,name=wanglim,sport=1)</div><div class="line">____________________________________________________________</div><div class="line">|   TIME  |  COUNTRY  |  SPORT  |   NAME   |  MEDAL | VALID |</div><div class="line">|-----------------------------------------------------------|</div><div class="line">|        0|     CHINA |       1 |    shenyu|    GOLD | false|</div><div class="line">|        0|     CHINA |       2 |    shenyu|    GOLD |  true|</div><div class="line">|        0|     CHINA |       1 |   wanglim|    GOLD | false|</div><div class="line">|        0|     CHINA |       1 |   xiaoqia|    GOLD |  true|</div><div class="line">|        0|     CHINA |       1 |   xiaohua|  SILVER |  true|</div><div class="line">____________________________________________________________</div><div class="line">____________________________________________</div><div class="line">|  COUNTRY  | GOLD | SILVER | BRONZE | RANK |</div><div class="line">|-------------------------------------------|</div><div class="line">|      CHINA|     2|       1|       0|     1|</div><div class="line">|    AMERICA|     0|       0|       0|     2|</div><div class="line">|      JAPAN|     0|       0|       0|     2|</div><div class="line">|      KOREA|     0|       0|       0|     2|</div><div class="line">|     RUSSUA|     0|       0|       0|     2|</div><div class="line">|    ENGLAND|     0|       0|       0|     2|</div><div class="line">____________________________________________</div><div class="line">====Test 3 PASSED=================================</div><div class="line"></div><div class="line">====Test Results===================================</div><div class="line">all    tests: 4</div><div class="line">passed tests: 4</div><div class="line">===================================================</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Mathjax公式]]></title>
      <url>http://shenyu.wiki/2016/09/17/Mathjax%E5%85%AC%E5%BC%8F/</url>
      <content type="html"><![CDATA[<p>利用mathjax可以方便的输入latex格式的公式，例如输入如下文本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$$E=mc^2$$</div></pre></td></tr></table></figure></p>
<p>就会自动生成如下格式化的公式<br>$$E=mc^2$$</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[长城 Great Wall]]></title>
      <url>http://shenyu.wiki/2016/09/15/%E9%95%BF%E5%9F%8E/</url>
      <content type="html"><![CDATA[<blockquote>
<p>长城（Great Wall）又称万里长城，是中国古代的军事防御工程。长城修筑的历史可上溯到西周时期，发生在首都镐京（今陕西西安）的著名的典故“烽火戏诸侯”就源于此。春秋战国时期列国争霸，互相防守，长城修筑进入第一个高潮，但此时修筑的长度都比较短。秦灭六国统一天下后，秦始皇连接和修缮战国长城，始有万里长城之称。</p>
</blockquote>
<p><img src="http://static.zybuluo.com/shenyuflying/gzsbxd49ixdcm1yjk6p4kbma/2016-10-04%2013-05-31%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""><br>$$八达岭长城$$</p>
<p>八达岭长城，位于北京市延庆区军都山关沟古道北口。是中国古代伟大的防御工程万里长城的重要组成部分，是明长城的一个隘口。八达岭长城为居庸关的重要前哨，古称“居庸之险不在关而在八达岭”。</p>
<p><img src="http://static.zybuluo.com/shenyuflying/cu9g6kwjxit08k639it2btj4/2016-10-04%2012-58-54%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""><br>$$烽火台$$<br>烽火台高均五丈，周围建小城，高一丈五尺，上设悬楼垒木，下设壕堑吊桥，外设塌窖陷阱；门道上置水柜，冬日盛冰、夏日盛水；不修台阶，以绳梯上下；每台有火铳、火炮2门，有守卒10人。</p>
<p><img src="http://static.zybuluo.com/shenyuflying/hgfm3n6odz2f1k2ilmz42gyu/2016-10-04%2012-54-09%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""><br>$$城墙$$</p>
<p>八达岭长城城墙高6～9米，平面呈梯形，底宽6.5～7.5米、顶宽4.5～5.8米。大部墙顶宽阔平坦，可以“五马并骑、十人并行”；城墙中线偏于外侧，外侧墙高，内侧墙低。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[北京奥林匹克公园 Beijing Olympic Park]]></title>
      <url>http://shenyu.wiki/2016/06/09/%E5%8C%97%E4%BA%AC%E5%A5%A5%E6%9E%97%E5%8C%B9%E5%85%8B%E5%85%AC%E5%9B%AD/</url>
      <content type="html"><![CDATA[<blockquote>
<p>北京奥林匹克公园位于北京市朝阳区，地处北京城中轴线北端。2008年奥运会比赛期间，有鸟巢、水立方、国家体育馆、等10个奥运会竞赛场馆。</p>
</blockquote>
<p><img src="http://static.zybuluo.com/shenyuflying/usu0xch6mcnp42rby3u62p8p/2016-10-04%2013-45-00%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""><br>$$ 鸟巢　水立方$$<br>国家游泳中心又称水立方,长宽高分别为177m ×177m×30m。其与国家体育场(俗称鸟巢)分列于北京城市中轴线北端的两侧。</p>
<p><img src="http://static.zybuluo.com/shenyuflying/k0ej1vatj5ffs5vkn9uwpa4j/2016-10-04%2013-44-17%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""><br>$$ 鸟巢$$<br>国家体育场（鸟巢）位于北京奥林匹克公园中心区南部，为2008年北京奥运会的主体育场。工程总占地面积21公顷。奥运会后成为北京市民参与体育活动及享受体育娱乐的大型专业场所，并成为地标性的体育建筑和奥运遗产。</p>
<p><img src="http://static.zybuluo.com/shenyuflying/hpflyee8d2bh61j7gr7yzwx9/2016-10-04%2013-46-17%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""><br>$$湖$$<br>森林公园的湖泊作为“龙头”，引起整个奥林匹克公园之中的龙形水系，把自然引入城市。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[天安门 Tiananmen]]></title>
      <url>http://shenyu.wiki/2016/05/01/%E5%A4%A9%E5%AE%89%E9%97%A8/</url>
      <content type="html"><![CDATA[<blockquote>
<p>天安门，坐落在中华人民共和国首都北京市的中心、故宫的南端，与天安门广场以及人民英雄纪念碑、毛主席纪念堂、人民大会堂、中国国家博物馆隔长安街相望，占地面积4800平方米，以杰出的建筑艺术和特殊的政治地位为世人所瞩目。</p>
</blockquote>
<p><img src="http://static.zybuluo.com/shenyuflying/bnyu3xl0wxhl05pnn8y5p207/CghzfFW655SATWClAA_8fZQFgUE656.jpg" alt=""><br>$$天安门广场$$<br>天安门广场位于北京市中心，南北长880米，东西宽500米，面积达44万平方米，可容纳100万人举行盛大集会。是当今世界上最大的城中广场。</p>
<p><img src="http://static.zybuluo.com/shenyuflying/fjim634uhf8dcj13zwk7ocqv/2016-10-04%2013-17-24%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""><br>$$天安门$$<br>天安门是明清两代北京皇城的正门，始建于明朝永乐十五年（1417年）。天安门城楼长66米、宽37米。正中门洞上方悬挂着毛泽东画像，两边分别是“中华人民共和国万岁”和“世界人民大团结万岁”的大幅标语。</p>
<p><img src="http://static.zybuluo.com/shenyuflying/9jz54rnyvcztch5gfgjvxv09/2016-10-04%2013-19-51%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""><br>$$天安门城楼$$<br>天安门城楼为中国传统的重檐歇山顶建筑。城楼为木结构建筑，大殿飞檐下是排列有序的斗拱和梁枋。斗拱为中国传统木构架体系中独有，是斗形木弓形横木组成的具有翘、昂、拱特点的木制构件。梁枋又分额枋、檐枋，斗拱下面是额枋，上面彩画和金龙图案，柱子之间的构件叫檐枋，会有金龙和玺图案。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[mysql大数据处理]]></title>
      <url>http://shenyu.wiki/2015/02/17/mysql%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/</url>
      <content type="html"><![CDATA[<h2 id="任务"><a href="#任务" class="headerlink" title="任务"></a>任务</h2><blockquote>
<p>将近10天的温度数据，9个温度测点，采样间隔为1分钟，共计12万行数据，需要导出每小时的温度数据。</p>
</blockquote>
<p>ps: 现在有很多工具，比如mysql workbench可以很方便完成数据导入的工作。这里用ｃ语言把数据转为insert语句，是为了更好的解释其中的工作原理。</p>
<h2 id="数据格式"><a href="#数据格式" class="headerlink" title="数据格式"></a>数据格式</h2><p>数据格式如下：有3列，分别是日期，时间，温度。文件名是测点编号。</p>
<p><img src="http://img.blog.csdn.net/20141125135942138?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc2hlbnl1Zmx5aW5n/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="ddd"></p>
<h2 id="数据库设计为如下"><a href="#数据库设计为如下" class="headerlink" title="数据库设计为如下"></a>数据库设计为如下</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">create</span> <span class="keyword">database</span> sensorDB;  </div><div class="line"><span class="keyword">use</span> sensorDB;  </div><div class="line"><span class="keyword">create</span> <span class="keyword">table</span> sensor  </div><div class="line">(  </div><div class="line">    <span class="keyword">ID</span> <span class="built_in">smallint</span> ,  </div><div class="line">    dt <span class="built_in">Date</span>,  </div><div class="line">    tm <span class="keyword">Time</span>,  </div><div class="line">    temp <span class="built_in">float</span>,  </div><div class="line">    primary <span class="keyword">key</span> (<span class="keyword">ID</span>,dt,tm)  </div><div class="line">);</div></pre></td></tr></table></figure>
<p>建立一个视图把dt和tm两个字段合并<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">create</span> <span class="keyword">view</span> temperature  </div><div class="line"><span class="keyword">as</span>  </div><div class="line"><span class="keyword">select</span> <span class="keyword">ID</span>, <span class="keyword">cast</span>(<span class="keyword">CONCAT</span>(dt,<span class="string">' '</span>,tm) <span class="keyword">as</span> datetime) <span class="string">'时间'</span> , temp <span class="keyword">from</span> sensor   ;</div></pre></td></tr></table></figure></p>
<h2 id="txt格式文件导入数据库"><a href="#txt格式文件导入数据库" class="headerlink" title="txt格式文件导入数据库"></a>txt格式文件导入数据库</h2><p>用C语言写了一个小工具，可以把txt转成sql语句【见后面的源代码】        运行后，输入txt的文件名，要插入的表名，和传感器的编号即可。   程序运行完毕之后，自动生成sql语句如下：<br><img src="http://img.blog.csdn.net/20141125140008127?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc2hlbnl1Zmx5aW5n/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="d"><br>然后直接运行sql语句，数据就导入到数据库中了。</p>
<h2 id="按指定间隔查询数据"><a href="#按指定间隔查询数据" class="headerlink" title="按指定间隔查询数据"></a>按指定间隔查询数据</h2><p>利用了timestampdiff（）来计算时间间隔 ，并利用%来逐个判断</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> temperature <span class="keyword">where</span> <span class="keyword">ID</span> = <span class="number">9</span> <span class="keyword">and</span>  <span class="keyword">timestampdiff</span>(<span class="keyword">MINUTE</span>,时间,<span class="string">'2014-04-19 15:00:00'</span>)%<span class="number">60</span> =<span class="number">0</span>;</div></pre></td></tr></table></figure>
<p>如下便是间隔1小时的温度数据</p>
<p><img src="http://img.blog.csdn.net/20141125140019422?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc2hlbnl1Zmx5aW5n/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="dd"></p>
<h2 id="附件：txt转sql源代码-C"><a href="#附件：txt转sql源代码-C" class="headerlink" title="附件：txt转sql源代码 C"></a>附件：txt转sql源代码 C</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span>  </span></div><div class="line">  </div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BUFFER_LEN 2048  </span></div><div class="line"><span class="keyword">const</span> <span class="keyword">char</span> sp[] = &#123; <span class="string">' '</span>, <span class="string">'\t'</span>, <span class="string">';'</span>,<span class="string">'\r'</span>,<span class="string">'\n'</span> &#125;;  </div><div class="line">  </div><div class="line">   </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">error</span><span class="params">(<span class="keyword">char</span> *msg)</span>  </span></div><div class="line">&#123;  </div><div class="line">    <span class="built_in">printf</span>(<span class="string">"ERROR:%s"</span>,msg);  </div><div class="line">    fflush(<span class="built_in">stdin</span>);  </div><div class="line">    getchar();  </div><div class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);  </div><div class="line">&#125;  </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">isSeperator</span><span class="params">(<span class="keyword">char</span>  ch)</span>  </span></div><div class="line">&#123;  </div><div class="line">      </div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(sp) / <span class="keyword">sizeof</span>(<span class="keyword">char</span>); i++)  </div><div class="line">    &#123;  </div><div class="line">        <span class="keyword">if</span> ( ch == sp[i])  </div><div class="line">        &#123;  </div><div class="line">            <span class="keyword">return</span> <span class="number">1</span>;  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;  </div><div class="line">&#125;  </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span>  </span></div><div class="line">&#123;  </div><div class="line">    <span class="built_in">printf</span>(<span class="string">"=============================\n"</span>);  </div><div class="line">    <span class="built_in">printf</span>(<span class="string">"          txt2sql\n"</span>);  </div><div class="line">    <span class="built_in">printf</span>(<span class="string">"=============================\n"</span>);  </div><div class="line">    <span class="built_in">printf</span>(<span class="string">"data fielname: "</span>);  </div><div class="line">    fflush(<span class="built_in">stdin</span>);  </div><div class="line">    <span class="keyword">char</span> filename_in[<span class="number">256</span>], filename_out[<span class="number">256</span>];  </div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>,filename_in);  </div><div class="line">    <span class="built_in">strcpy</span>(filename_out, filename_in);  </div><div class="line">    <span class="built_in">strcat</span>(filename_out, <span class="string">"_sql.txt"</span>);  </div><div class="line">    <span class="built_in">strcat</span>(filename_in, <span class="string">".txt"</span>);  </div><div class="line">    <span class="built_in">printf</span>(<span class="string">"table name: "</span>);  </div><div class="line">    fflush(<span class="built_in">stdin</span>);  </div><div class="line">    <span class="keyword">char</span> table_name[<span class="number">256</span>];  </div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>, table_name);  </div><div class="line">  </div><div class="line">    <span class="built_in">printf</span>(<span class="string">"sensor ID: "</span>);  </div><div class="line">    fflush(<span class="built_in">stdin</span>);  </div><div class="line">    <span class="keyword">char</span> sensor_ID[<span class="number">256</span>];  </div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>, sensor_ID);  </div><div class="line">  </div><div class="line">  </div><div class="line">    FILE *fin = fopen(filename_in, <span class="string">"r"</span>);  </div><div class="line">    FILE *fout = fopen(filename_out, <span class="string">"w"</span>);  </div><div class="line">    <span class="keyword">if</span> (fin == <span class="literal">NULL</span> || fout == <span class="literal">NULL</span>)  </div><div class="line">    &#123;  </div><div class="line">        error(<span class="string">"cannot open file"</span>);  </div><div class="line">    &#125;  </div><div class="line">    <span class="keyword">char</span> buffer[BUFFER_LEN];  </div><div class="line">    <span class="keyword">while</span> (fgets(buffer, BUFFER_LEN, fin) != <span class="number">0</span>)  </div><div class="line">    &#123;  </div><div class="line">        <span class="comment">//除去多余的分隔符  </span></div><div class="line">        <span class="keyword">char</span> elem[BUFFER_LEN];  </div><div class="line">        <span class="keyword">int</span> k = <span class="number">0</span>;  </div><div class="line">        <span class="built_in">memset</span>(elem, <span class="number">0</span>, <span class="keyword">sizeof</span>(elem));  </div><div class="line">  </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(buffer); i++)  </div><div class="line">        &#123;  </div><div class="line">            <span class="keyword">if</span> (buffer[i] == <span class="string">'\n'</span> || buffer[i] == <span class="string">'\r'</span> || buffer[i]==<span class="string">'\0'</span>) buffer[i] = <span class="string">' '</span>;  </div><div class="line">        &#125;  </div><div class="line">  </div><div class="line">  </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(buffer); i++)  </div><div class="line">        &#123;  </div><div class="line">            <span class="keyword">if</span> (!isSeperator(buffer[i]))  </div><div class="line">            &#123;  </div><div class="line">                elem[k++] = buffer[i];  </div><div class="line">            &#125;  </div><div class="line">            <span class="keyword">else</span>  </div><div class="line">            &#123;  </div><div class="line">                <span class="comment">//如果最后一个是分隔符则跳过  </span></div><div class="line">                <span class="keyword">if</span> (i == <span class="built_in">strlen</span>(buffer) &amp;&amp; isSeperator(buffer[i]))  </div><div class="line">                    <span class="keyword">continue</span>;  </div><div class="line">                <span class="comment">//如果下一个还是分隔符，则跳过。  </span></div><div class="line">                <span class="keyword">if</span> (i != <span class="built_in">strlen</span>(buffer) - <span class="number">1</span> &amp;&amp; isSeperator(buffer[i + <span class="number">1</span>]))  </div><div class="line">                    <span class="keyword">continue</span>;  </div><div class="line">                <span class="keyword">if</span> (i != <span class="built_in">strlen</span>(buffer) - <span class="number">1</span> &amp;&amp; !isSeperator(buffer[i + <span class="number">1</span>]))  </div><div class="line">                                elem[k++] = buffer[i];  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">        <span class="comment">/*printf("\"%s\"",elem);*/</span>  </div><div class="line">        <span class="comment">//经过处理的elem只有包含一个分隔符在一起的情况，最后没有空元素  </span></div><div class="line">  </div><div class="line">        <span class="built_in">fprintf</span>(fout, <span class="string">"INSERT INTO %s VALUES ('%s',"</span>, table_name,sensor_ID);  </div><div class="line">        <span class="keyword">int</span> left = <span class="number">0</span>;  </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(elem); i++)  </div><div class="line">        &#123;  </div><div class="line">            <span class="keyword">if</span> (isSeperator(elem[i]))  </div><div class="line">            &#123;  </div><div class="line">                  </div><div class="line">                <span class="built_in">fprintf</span>(fout, <span class="string">"\'"</span>);  </div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = left; j &lt; i; j++)  </div><div class="line">                &#123;  </div><div class="line">                    <span class="built_in">fprintf</span>(fout, <span class="string">"%c"</span>, elem[j]);  </div><div class="line">                &#125;  </div><div class="line">                <span class="built_in">fprintf</span>(fout, <span class="string">"\',"</span>);  </div><div class="line">                left = i + <span class="number">1</span>;  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">        <span class="comment">//the last one  </span></div><div class="line">        <span class="built_in">fprintf</span>(fout, <span class="string">"\'"</span>);  </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = left; j &lt; <span class="built_in">strlen</span>(elem); j++)  </div><div class="line">        &#123;  </div><div class="line">            <span class="built_in">fprintf</span>(fout, <span class="string">"%c"</span>, elem[j]);  </div><div class="line">        &#125;  </div><div class="line">        <span class="built_in">fprintf</span>(fout, <span class="string">"\');\n"</span>);  </div><div class="line">           </div><div class="line">    &#125;  </div><div class="line">      </div><div class="line">  </div><div class="line">  </div><div class="line">    fclose(fin);   </div><div class="line">    fclose(fout);  </div><div class="line">  </div><div class="line">    <span class="built_in">printf</span>(<span class="string">"Done!"</span>);  </div><div class="line">    fflush(<span class="built_in">stdin</span>);  </div><div class="line">    getchar();  </div><div class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[动态增长的栈]]></title>
      <url>http://shenyu.wiki/2015/01/31/%E5%8A%A8%E6%80%81%E5%A2%9E%E9%95%BF%E7%9A%84%E6%A0%88/</url>
      <content type="html"><![CDATA[<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>C语言实现stack数据结构<br>能够</p>
<ol>
<li>push的时候动态增长。每次扩大一倍：2,4,8,16,32…</li>
<li>pop的时候还能自动释放地址。</li>
</ol>
<a id="more"></a> 
<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span>  </span></div><div class="line">   </div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">"linked_list_stack/my_linked_list_stack.h"</span>  </span></div><div class="line">  </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span>  </span></div><div class="line">&#123;  </div><div class="line">    MY_STACK  <span class="built_in">stack</span>;  </div><div class="line">    my_stack_init(&amp;<span class="built_in">stack</span>);  </div><div class="line">    my_stack_push(&amp;<span class="built_in">stack</span>,<span class="number">1</span>);  </div><div class="line">    my_stack_push(&amp;<span class="built_in">stack</span>,<span class="number">2</span>);  </div><div class="line">    my_stack_push(&amp;<span class="built_in">stack</span>,<span class="number">3</span>);  </div><div class="line">    my_stack_push(&amp;<span class="built_in">stack</span>,<span class="number">4</span>);  </div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%ld\n"</span>,my_stack_pop(&amp;<span class="built_in">stack</span>));  </div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%ld\n"</span>,my_stack_pop(&amp;<span class="built_in">stack</span>));  </div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%ld\n"</span>,my_stack_pop(&amp;<span class="built_in">stack</span>));  </div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%ld\n"</span>,my_stack_pop(&amp;<span class="built_in">stack</span>));  </div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _MY_STACK_H_  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _MY_STACK_H_  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span> <span class="comment">/*memset(void *s, int c, size_t n)*/</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _DEBUG_  </span></div><div class="line"><span class="comment">/*type for the stack T ,you can typedef your own*/</span>  </div><div class="line">  </div><div class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">int</span> T;  </div><div class="line"><span class="keyword">struct</span> my_block_st  </div><div class="line">&#123;  </div><div class="line">    T * ptr;<span class="comment">/*point to the allocate memory*/</span>  </div><div class="line">    <span class="keyword">struct</span> my_block_st * pre;  </div><div class="line">    <span class="keyword">int</span>  index;  </div><div class="line">    <span class="keyword">size_t</span> block_size;<span class="comment">/*size of the current block ...*/</span>  </div><div class="line">&#125;;  </div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> my_block_st MY_BLOCK;  </div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> my_block_st *  MY_STACK; <span class="comment">/*point to the last block*/</span>  </div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">my_stack_init_block</span><span class="params">(MY_BLOCK **block_ptr)</span>  </span></div><div class="line">&#123;  </div><div class="line">    <span class="comment">/*initially the size=1, and twice the size each time*/</span>  </div><div class="line">     (*block_ptr)-&gt;block_size = (*block_ptr)-&gt;block_size*<span class="number">2</span>;  </div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _DEBUG_  </span></div><div class="line">    <span class="built_in">printf</span>(<span class="string">"my_stack_init_block() size=%ld\n"</span>,((*block_ptr)-&gt;block_size));  </div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span>  </span></div><div class="line">    (*block_ptr)-&gt;ptr =(T *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(T)* ((*block_ptr)-&gt;block_size));</div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _DEBUG_  </span></div><div class="line">    <span class="built_in">printf</span>(<span class="string">"new block add=%p\n"</span>,(*block_ptr)-&gt;ptr);  </div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span>  </span></div><div class="line">    <span class="keyword">if</span>((*block_ptr)-&gt;ptr==<span class="literal">NULL</span>)  </div><div class="line">    &#123;  </div><div class="line">        <span class="built_in">printf</span>(<span class="string">"malloc err\n"</span>);  </div><div class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);  </div><div class="line">    &#125;  </div><div class="line">    (*block_ptr)-&gt;index=<span class="number">-1</span>;  </div><div class="line">    <span class="built_in">memset</span>((*block_ptr)-&gt;ptr,<span class="number">0</span>,<span class="keyword">sizeof</span>((*block_ptr)-&gt;ptr));  </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">my_stack_init</span><span class="params">(MY_STACK * s)</span>  </span></div><div class="line">&#123;  </div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _DEBUG_  </span></div><div class="line">    <span class="built_in">printf</span>(<span class="string">"my_stack_init()\n"</span>);  </div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span>  </span></div><div class="line">    *s=(MY_STACK)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(MY_BLOCK ));  </div><div class="line">    (*s)-&gt;block_size=<span class="number">1</span>;  </div><div class="line">    my_stack_init_block(&amp;(*s));  </div><div class="line">    (*s)-&gt;pre=<span class="literal">NULL</span>;  </div><div class="line">&#125;  </div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">my_stack_add_block</span><span class="params">(MY_STACK *s)</span>  </span></div><div class="line">&#123;  </div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _DEBUG_  </span></div><div class="line">    <span class="built_in">printf</span>(<span class="string">"my_stack_add_block()\n"</span>);  </div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span>  </span></div><div class="line">    MY_BLOCK   * ptr_block=(MY_BLOCK*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(MY_BLOCK));  </div><div class="line">    ptr_block-&gt;block_size = (*s)-&gt;block_size;<span class="comment">/*pass the current size o new block*/</span>  </div><div class="line">    my_stack_init_block(&amp;ptr_block);  </div><div class="line">    MY_BLOCK *tmp_ptr= (*s);  </div><div class="line">    *s=ptr_block;  </div><div class="line">    (*s)-&gt;pre=tmp_ptr;  </div><div class="line">&#125;  </div><div class="line">  </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">my_block_is_full</span><span class="params">(MY_BLOCK **s)</span>  </span></div><div class="line">&#123;  </div><div class="line">    <span class="keyword">if</span>(((*s)-&gt;index)==((*s)-&gt;block_size<span class="number">-1</span>))  </div><div class="line">    &#123;  </div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;  </div><div class="line">    &#125;  </div><div class="line">    <span class="keyword">else</span>  </div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;  </div><div class="line">&#125;  </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">my_block_is_empty</span><span class="params">(MY_STACK *s)</span>  </span></div><div class="line">&#123;  </div><div class="line">    <span class="keyword">if</span>( (*s)-&gt;index==<span class="number">-1</span>)  </div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;  </div><div class="line">    <span class="keyword">else</span>  </div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;  </div><div class="line">&#125;  </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">my_stack_is_empty</span><span class="params">(MY_STACK *s)</span>  </span></div><div class="line">&#123;  </div><div class="line">    <span class="keyword">if</span>( (*s)-&gt;pre==<span class="literal">NULL</span> &amp;&amp; (*s)-&gt; index==<span class="number">-1</span>)  </div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;  </div><div class="line">    <span class="keyword">else</span>  </div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;  </div><div class="line">&#125;  </div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">my_stack_push</span><span class="params">(MY_STACK *s, T elem)</span>  </span></div><div class="line">&#123;  </div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _DEBUG_  </span></div><div class="line">    <span class="built_in">printf</span>(<span class="string">"my_stack_push(%ld)\n"</span>,elem);  </div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span>  </span></div><div class="line">    <span class="keyword">if</span>(my_block_is_full(&amp;(*s)))  </div><div class="line">    &#123;  </div><div class="line">        my_stack_add_block(&amp;(*s));  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    ( *s)-&gt;index++;  </div><div class="line">    *(( *s)-&gt;ptr+(*s)-&gt;index)=elem;  </div><div class="line">&#125;  </div><div class="line">  </div><div class="line"><span class="function">T <span class="title">my_stack_pop</span><span class="params">(MY_STACK *s)</span>  </span></div><div class="line">&#123;  </div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _DEBUG_  </span></div><div class="line">    <span class="built_in">printf</span>(<span class="string">"my_stack_pop()\n"</span>);  </div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span>  </span></div><div class="line">    <span class="keyword">if</span>(my_stack_is_empty(&amp;(*s)))  </div><div class="line">    &#123;  </div><div class="line">        <span class="built_in">printf</span>(<span class="string">"err: empty stack cannot pop!\n"</span>);  </div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;  </div><div class="line">    &#125;  </div><div class="line">    <span class="keyword">if</span>(my_block_is_empty(&amp;(*s)))  </div><div class="line">    &#123;  </div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _DEBUG_  </span></div><div class="line">    <span class="built_in">printf</span>(<span class="string">"free %p\n "</span>,( *s)-&gt;ptr);  </div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span>  </span></div><div class="line">        <span class="built_in">free</span>((*s)-&gt; ptr);  </div><div class="line">        *s=(*s)-&gt;pre;  </div><div class="line">    &#125;  </div><div class="line">    T tmp;  </div><div class="line">    tmp = *(( *s)-&gt;ptr+( *s)-&gt;index);  </div><div class="line">     --(( *s)-&gt;index);  </div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _DEBUG_  </span></div><div class="line">              <span class="built_in">printf</span>(<span class="string">"return %ld\n"</span>,tmp);  </div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span>  </span></div><div class="line">    </div><div class="line">    <span class="keyword">return</span> tmp;  </div><div class="line">&#125;  </div><div class="line">  </div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/*_MY_STACK_H_*/</span></span></div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
  
  
</search>
