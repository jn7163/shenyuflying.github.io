<!DOCTYPE html>
<html lang="zh-Hans">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="小宇" />


    
    


<meta name="description" content="Shen Yu">
<meta property="og:type" content="website">
<meta property="og:title" content="小宇的博客">
<meta property="og:url" content="http://shenyu.wiki/index.html">
<meta property="og:site_name" content="小宇的博客">
<meta property="og:description" content="Shen Yu">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="小宇的博客">
<meta name="twitter:description" content="Shen Yu">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">
<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
<link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">


    <link rel="alternate" href="/atom.xml" title="小宇的博客" type="application/atom+xml">



    <link rel="shortcut icon" href="/uploads/siteicon.png">





    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>小宇的博客</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: false,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/uploads/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">小宇</a></h1>
        </hgroup>

        
        <p class="header-subtitle">Coding for fun</p>
        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="true" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-home icon-2x">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">归档</a></li>
                        
                            <li><a href="/tags/">标签</a></li>
                        
                            <li><a href="/map/">导航</a></li>
                        
                            <li><a href="/message/">留言</a></li>
                        
                            <li><a href="/about/">关于</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:shenyufly@163.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="http://github.com/shenyuflying" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux使用/">Linux使用</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux编程/">Linux编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PLSQL/">PLSQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PostgreSQL/">PostgreSQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PostgreSQL使用/">PostgreSQL使用</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PostgreSQL内核/">PostgreSQL内核</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/">Shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/assembly/">assembly</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/">c</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gdb/">gdb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/golang/">golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mathjax/">mathjax</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sed/">sed</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wget/">wget</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/基础知识/">基础知识</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/备份还原/">备份还原</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/小宇带你学PostgreSQL内核/">小宇带你学PostgreSQL内核</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工具/">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/开源社区/">开源社区</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/技术分享/">技术分享</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/接口/">接口</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/操作系统/">操作系统</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库/">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库，PostgreSQL/">数据库，PostgreSQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/文章/">文章</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/旅行/">旅行</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/本地化/">本地化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/架构/">架构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/查询优化/">查询优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/汇编调试方法/">汇编调试方法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/爱好/">爱好</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编程/">编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编程语言/">编程语言</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/网站/">网站</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/语言层/">语言层</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/读书/">读书</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/调优/">调优</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">专注于基础软件研发</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">小宇</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/uploads/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">小宇</a></h1>
            </hgroup>
            
            <p class="header-subtitle">Coding for fun</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">归档</a></li>
                
                    <li><a href="/tags/">标签</a></li>
                
                    <li><a href="/map/">导航</a></li>
                
                    <li><a href="/message/">留言</a></li>
                
                    <li><a href="/about/">关于</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:shenyufly@163.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="http://github.com/shenyuflying" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap">
  
    <article id="post-The-best-career-advice-I’ve-received" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/22/The-best-career-advice-I’ve-received/" class="article-date">
      <time datetime="2017-01-22T01:09:25.000Z" itemprop="datePublished">2017-01-22</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/22/The-best-career-advice-I’ve-received/">The best career advice I’ve received</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>#The best career advice I’ve received</p>
<p>Posted at October 15, 2013 by Nicholas C. Zakas</p>
<p>原文链接：<a href="https://www.nczonline.net/blog/2013/10/15/the-best-career-advice-ive-received/" target="_blank" rel="external">https://www.nczonline.net/blog/2013/10/15/the-best-career-advice-ive-received/</a></p>
<p>I recently had an interesting discussion with a colleague. We were recounting our job histories and how our, shall we say colorful personalities, could have negatively impacted us long term. The truth is, I was kind of an asshole coming out of college (some would argue I’m still kind of an asshole, but that’s beside the point). I was arrogant and bitingly sarcastic, a generally irreverent character. I thought I knew it all and was quite proud of myself for it.</p>
<p>I had a habit of telling more experienced engineers that they were doing things wrong, and despite being right most of the time, I didn’t have the personality to make it effective. During one particularly engaging conversation, one of the senior engineers stopped and said, in these exact words, “I’m going to beat the shit out of you if you don’t shut up.” I laughed it off because I knew he wouldn’t dare, and only years later did I realize the relevance of that statement: it was actually what he wanted to do.</p>
<p>Since that time I’ve grown up a lot, learned to watch what I say, and treat people with respect regardless of defining characteristics. The sarcasm stays in check while in a professional environment; I let it out to play when I’m with good friends. This self-control, along with a lot of other invaluable lessons, came to me not of my own accord, but through the careful guidance of the mentors I’ve had along the way. If not for them, who knows if my interpersonal relationships would have short-circuited my career.</p>
<p>The truth is that I have been incredibly blessed in my career because of the people I’ve come into contact with. My managers along the way molded a really rough-around-the-edges character into someone I’m proud to be. More than that, because of their influence, I’m not just a good programmer – I’m a good teammate and a good person. So impactful were these people on my life that I frequently recount their advice to the colleagues that I now mentor.</p>
<p>I also find their advice to be universally applicable, so I’d like to share the things I was told that helped me along the way. Of course, some of these are paraphrased since my memory for exact phrases isn’t all that great, but I believe I’ve captured the important parts correctly.</p>
<p>##Don’t be a short-order cook</p>
<p>My very first job lasted 8 months because the company shut down. As I was talking with my manager about what I would do next, he gave me this advice:</p>
<pre><code>Nicholas, you’re worth more than your code. Whatever your next gig is, make sure that you’re not a short-order cook. Don’t accept a job where you’re told exactly what to build and how to build it. You need to work somewhere that appreciates your insights into the product as well as your ability to build it.
</code></pre><p>This is something I’ve kept in mind throughout my career. Simply being an implementer isn’t good enough – you need to be involved in the process that leads up to implementation. Good engineers don’t just follow orders, they give feedback to and work with product owners to make the product better. Fortunately, I’ve chosen my jobs wisely and never ended up in a situation where people didn’t respect or value my insights.</p>
<p>##Self-promote</p>
<p>My second manager at Yahoo pulled me aside one day to give me some advice. He had been watching my work and felt like I was hiding a bit:</p>
<pre><code>You do great work. I mean really great work. I like how your code looks and that it rarely breaks. The problem is that others don’t see it. In order for you to get credit for the work you’re doing, you have to let people know. You need to do a bit of self-promotion to get noticed.
</code></pre><p>It took me a little while to digest what he was saying, but I finally figured it out. If you do good work, but no one knows that you did good work, then it doesn’t really help you. Your manager can back you up but can’t make your case for you. People within the organization need to understand your value, and the best way to do that is to tell people what you did.</p>
<p>This is advice I give to many of my colleagues now. Self-promoting doesn’t mean, “look at me, I’m awesome.” It means letting people know when you’ve hit major milestones, or when you’ve learned something new. It means showing people the work that you’re proud of. It means celebrating your accomplishments and the accomplishments of others. It means being visible within the organization. The engineer who sits quietly in a corner and just codes away is always a bit mysterious – don’t be like that. A quick email to say, “hey, I finished the new email layout. Let me know what you think” goes a long way.</p>
<p>##It’s about people</p>
<p>I was very title-driven earlier in my career. I always wanted to know what I had to do to be promoted. During my first one-on-one with my new manager on the Yahoo homepage, I asked what it would take for me to get promoted. His words still ring in my ears:</p>
<pre><code>At a certain point, you stop being judged on your technical knowledge and start being judged on the way you interact with people.
</code></pre><p>I’m not sure I’ve ever received a better insight into the software engineering profession since that time. He was exactly right. At that point, no one was questioning my technical ability. I was known as a guy who wrote good, high-quality code that rarely had bugs. What I lacked was leadership skill.</p>
<p>Since that time, I’ve seen countless engineers get stuck at one level in their career. Smart people, good code, but the inability to work effectively with others keeps them where they are. Anytime someone feels stuck in their software engineering career, I recount this advice and it has always been right on the money.</p>
<p>##None of this matters</p>
<p>I went through a period at Yahoo where I was frustrated. Maybe frustrated isn’t the right word, more like angry. I had angry outbursts and was arguing with people constantly. Things were going wrong and I didn’t like that. During one particularly rough day, I asked one of my mentors how he managed to stay calm when so many things were going wrong. His response:</p>
<pre><code>It’s easy. You see, none of this matters. So some crappy code got checked in, so the site went down. So what? Work can’t be your whole life. These aren’t real problems, they’re work problems. What really matters is what happens outside of work. I go home and my wife is waiting for me. That’s pretty nice.
</code></pre><p>I had moved to California from Massachusetts and had a hard time making friends. Work was my life, it was what kept me sane, so when it wasn’t going that meant my life wasn’t going well. This conversation made me realize I had to have something else going on in my life, something I could go back to and forget about the troubles I had at work.</p>
<p>He was right, once I shifted my mindset and recategorized the annoying things at work as “work things,” I was able to think more clearly. I was able to calm down at work and have much more pleasant interactions with people.</p>
<p>##Authority, your way</p>
<p>When I was first promoted to principal engineer at Yahoo, I sat down with my director to better understand what the role entailed. I knew I had to be more of a leader, but I was having trouble being authoritative. I asked for help. Here’s what he said:</p>
<pre><code>I can’t tell you how to be authoritative, that’s something you need to figure out on your own. Different people have different styles. What you need to do is find a style that you can live with, that makes you comfortable. I can’t tell you what that is, but you do need to find it for this position.
</code></pre><p>I spent a lot of time that year observing people of authority and how they interacted with others. I took note as to how they walked, how they talked, how they dealt with problem situations. I tried different styles before I finally came across one that worked for me. My style is uniquely me and anyone learning to be in a position of authority has to go through the same growing pains. My advantage was that my mentor clued me about the process up front.</p>
<p>##Moving from “how?” to “what?”</p>
<p>During a conversation with my manager at Yahoo, I asked what the expectations were with my new position. He answered:</p>
<pre><code>To this point in your career, you’ve answered the question, “how?” As in, we tell you what needs to be done and you figure out how to do it. At this point, though, you need to answer the question, “what?” I’m expecting you to come and tell me what needs to be done.
</code></pre><p>This is the part where I see a lot of engineers get tripped up, and I would have as well if not for this piece of advice. Switching from “how?” to “what?” is very hard and takes time to develop. It also takes a bit of maturity to be left to your own desires as to what you focus on. After all, if you can spend your time on anything you want, you are also solely responsible for what you produce.</p>
<p>At Box, we call this “running open loop,” meaning that you do your job with minimal oversight and yet still are making a significant positive impact on the engineering organization and the company as a whole. This is the step where many engineers fail to make the leap, and I still give this advice to anyone who is trying to get to the next level.</p>
<p>##Act like you’re in charge</p>
<p>I had just sat through a meeting where I had nothing to say. During my one-on-one with my director, I mentioned that I was just in a meeting where I had no idea why I was there and had nothing to contribute. He said:</p>
<pre><code>Don’t ever do that again. If you’re in a meeting, it’s because you are there to participate. If you’re not sure why you’re there, stop and ask. If you’re not needed, leave. You’re in a leadership position, act like it. Don’t go quietly into a room. Just act like you’re in charge and people will believe it.
</code></pre><p>In that piece of advice, my mentor had reminded me of a lesson I learned while acting in high school: no one knows when you’re acting. If you’re nervous but act like you’re not, then people won’t know that you’re nervous. The same with leadership. The old phrase fake it til you make it comes to mind. From that point on, I never sat quietly in a meeting. I made sure I only went to meetings that needed me to participate and then I would participate.</p>
<p>##Let them win</p>
<p>I went through a particular period where there were a lot of arguments on the team. I prided myself on ending those arguments with authority. I had a “my ruling is final” mentality, and my manager noticed that and gave me this piece of advice:</p>
<pre><code>I see a lot of arguing going on, and I see you pushing through to win a lot. I know that most of the time you are right, but every once in a while let them win. Pick the things that really matter to you and push for those but let the other things go. There’s no need to win every argument.
</code></pre><p>This was one piece of advice I resisted initially. I was right nearly all of the time, why would I ever let someone else win? However, as I had grown to trust his instincts, I gave it a shot. The result: there were less arguments. People didn’t feel like they had to get one over on me, and in turn, I became better at identifying things I really didn’t care that much about. I stuck to my guns on important issues and let the others ones get resolved by the other party. The intensity of all conversations dropped considerably.</p>
<p>##Conclusion</p>
<p>Looking back at the brash guy I was when I graduated college, my career could have ended up very different. I was seen as a malcontent, a smart but hard-to-deal-with guy who people dealt with because they had to. If it weren’t for the mentors I had along the way, as well as some humbling failures early in my career, my interpersonal skills (or lack thereof) could have very well done me in. These days, I regularly seek out those who are more experienced than me and ask for advice. I may no longer make big, glaring mistakes, but I also don’t want to wait for one to happen to seek out the experienced insights of someone I trust.</p>
<p>The nearly five years I was at Yahoo were some of the most transformative in my career. I got to work on interesting problems at a large scale, but moreso I was blessed with a series of wonderful managers and other mentors within my organization. I credit those conversations with turning me into a person that I’m proud of today, both at work and outside in “real life.”</p>
<p>If I can leave you with one overriding piece of career advice, it would be this: identify someone at your work that is smarter than you in some way (technically, organizationally, etc.) and attach yourself to them. See if you can regularly have lunch or coffee and pick their brain for the vast amount of knowledge it has. Your career, and maybe even your life, could end up drastically better by doing so.</p>
<p>如果还想看到更多此类文章，请移步到<a href="http://shenyu.wiki">小宇的博客</a>。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/爱好/">爱好</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/文章/">文章</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-汇编调试方法-20160526" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/19/汇编调试方法-20160526/" class="article-date">
      <time datetime="2017-01-19T12:07:51.000Z" itemprop="datePublished">2017-01-19</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/19/汇编调试方法-20160526/">汇编调试方法-20160526</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <blockquote>
<p>计算机基本架构、汇编基础知识、C语言与汇编、GDB汇编调试。带你进入C语言的底层世界。</p>
</blockquote>
<center><iframe height="498" width="510" src="http://player.youku.com/embed/XMjQxMTk0NjMyOA==" frameborder="0" 'allowfullscreen'=""></iframe></center>

<p>2016年5月26日</p>
<p>如果还想看到更多此类文章，请移步到<a href="http://shenyu.wiki">小宇的博客</a>。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/视频/">视频</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/assembly/">assembly</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/c/">c</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/汇编调试方法/">汇编调试方法</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/编程语言/">编程语言</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-汇编调试方法-20160506" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/19/汇编调试方法-20160506/" class="article-date">
      <time datetime="2017-01-19T11:07:51.000Z" itemprop="datePublished">2017-01-19</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/19/汇编调试方法-20160506/">汇编调试方法-20160506</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <blockquote>
<p>计算机基本架构、汇编基础知识、C语言与汇编、GDB汇编调试。带你进入C语言的底层世界。</p>
</blockquote>
<center><iframe height="498" width="510" src="http://player.youku.com/embed/XMjQxMTgzNzM2NA==" frameborder="0" 'allowfullscreen'=""></iframe></center>

<p>2016年5月6日</p>
<p>如果还想看到更多此类文章，请移步到<a href="http://shenyu.wiki">小宇的博客</a>。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/视频/">视频</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/assembly/">assembly</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/c/">c</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/汇编调试方法/">汇编调试方法</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/编程语言/">编程语言</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-修改hosts来访问谷歌" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/18/修改hosts来访问谷歌/" class="article-date">
      <time datetime="2017-01-18T07:41:42.000Z" itemprop="datePublished">2017-01-18</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/18/修改hosts来访问谷歌/">修改hosts来访问谷歌</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <blockquote>
<p>想用google查东西，可以通过修改hosts方式,非常简单。</p>
</blockquote>
<p>用root用户执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">git clone https://github.com/racaljk/hosts</div><div class="line">cp /etc/hosts /etc/hosts.bak</div><div class="line">cat hosts/hosts &gt; /etc/hosts</div><div class="line">rm -rf hosts</div></pre></td></tr></table></figure>
<p><a href="https://github.com/racaljk/hosts" target="_blank" rel="external">这个网址</a>上面有人在维护最新的hosts。如果hosts过期，可以通过这个脚本定时执行，来确保总是最新的。</p>
<center><img src="http://static.zybuluo.com/shenyuflying/5jgl6gv0e53fdfne1o0ofyjh/image_1b6o85n6c14021lv0s2bh0b190c9.png" alt="image_1b6o85n6c14021lv0s2bh0b190c9.png-212.2kB"></center>

<p>这样就可以来搜索需要的东西。比如我的博客就可以通过google搜到哦。</p>
<p>如果还想看到更多此类文章，请移步到<a href="http://shenyu.wiki">小宇的博客</a>。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/其他/">其他</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-如果你要给学生一些学习建议，你会说些什么" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/17/如果你要给学生一些学习建议，你会说些什么/" class="article-date">
      <time datetime="2017-01-17T13:19:22.000Z" itemprop="datePublished">2017-01-17</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/17/如果你要给学生一些学习建议，你会说些什么/">如果你要给学生一些学习建议，你会说些什么</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <blockquote>
<p>Q：如果你要给学生一些学习建议，你会说些什么？</p>
</blockquote>
<p><strong>吴恩达:</strong></p>
<p>当你在思考今天应该如何打发时间时，你需要考虑两个问题，一是你所做的事情是否能改变世界；二是你需要学习多少知识。</p>
<p>即使到了今天，我也是这样安排自己的时间的。</p>
<p>我们的社会为个体提供了改变世界的机会。拥有互联网化的技术与先进的沟通方式，创意与产品能够比以往更快的方式传播。只要有正确的想法与强大的执行力，任何人都能够做出贡献，造福世界上的其它人。</p>
<p>所以，问问自己，如果我实现了梦想，取得成功，它是否能帮助其它人？如果答案是肯定的，继续寻找你应该研究的方向；如果答案是否定的，说明你最大的潜能还没有爆发。</p>
<p>第二点是，特别是你还年轻的时候，不要吝惜自己在教育方面的投资。</p>
<p>我的「年轻」指的是那些小于 100 岁的人。</p>
<p>你学习的任何东西，在未来的某一天都会给你应有的报答。但这并不简单。当你走出校园，把时间花在学习上，短期内几乎看不到什么回报。没有老师督促你，但如果你能让自己在学习中得到快乐，开始尝试用各种方式思考，并与人们交流你所学到的东西，那么在数年时间内，你会在自己的领域里成为独挡一面的专家。</p>
<p>我个人非常爱阅读。我的 kindle 上有超过 1000 本书，而且每天晚上和周末我都会花时间阅读，涉猎的方向包括学术研究论文、商业战略书籍、具有变革及创新性的产品及进展、我所崇拜的人的自传等等。有时间我会看看 MOOC，也喜欢与能带给我启迪的人交流，不论对方是一个陌生人还是老朋友。</p>
<p>学习的过程能够帮助你决定工作的方向，当你看到其它人改变世界的先例，你也会知晓自己应该如何改变世界。</p>
<p>总而言之：即使做到这一点很难，但要不断投入（时间、金钱）学习。坚持寻找能够帮助人类的终极方式吧！</p>
<p>如果还想看到更多此类文章，请移步到<a href="http://shenyu.wiki">小宇的博客</a>。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/爱好/">爱好</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/文章/">文章</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/爱好/">爱好</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-hexo博客增加菜单栏目" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/16/hexo博客增加菜单栏目/" class="article-date">
      <time datetime="2017-01-16T03:32:36.000Z" itemprop="datePublished">2017-01-16</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/16/hexo博客增加菜单栏目/">hexo博客增加菜单栏目</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <blockquote>
<p>hexo中的yelee主题默认提供了<code>主页</code>、<code>归档</code>、<code>标签</code>、<code>关于</code>这几个菜单条目。那么如何增加新的条目呢？</p>
</blockquote>
<h2 id="新建页面"><a href="#新建页面" class="headerlink" title="新建页面"></a>新建页面</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hexo new page &quot;message&quot;</div></pre></td></tr></table></figure>
<p>新建的页面会在<code>source/message/index.md</code>这里，打开之后可以输入内容。</p>
<h2 id="加入到菜单栏目"><a href="#加入到菜单栏目" class="headerlink" title="加入到菜单栏目"></a>加入到菜单栏目</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim themes/yelee/_config.yml</div></pre></td></tr></table></figure>
<p>在<code>menu</code>下面加入新建立的<code>message</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">menu:</div><div class="line">  主页: /</div><div class="line">  归档: /archives/</div><div class="line">  标签: /tags/</div><div class="line">  导航: /map/</div><div class="line">  留言: /message/  ##加在这里</div><div class="line">  关于: /about/</div></pre></td></tr></table></figure></p>
<h2 id="更改css"><a href="#更改css" class="headerlink" title="更改css"></a>更改css</h2><p>博客增加了两个栏目：<code>导航</code>和<code>留言</code>。然后发现地方不够了，最后的<code>关于</code>被下面的图标覆盖了。怎么增加导航栏上下的高度呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim ./themes/yelee/source/css/_partial/main.styl</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">.header-menu&#123;</div><div class="line">    menu-line-height = (28/16)rem</div><div class="line">    font-weight: 550;</div><div class="line">    line-height: menu-line-height;</div><div class="line">    font-family: inherit;</div><div class="line">    cursor: pointer;</div><div class="line">    text-transform: uppercase;</div><div class="line">    float: none;</div><div class="line">    min-height: @line-height * 5; ## 增加这个，控制了菜单的最小高度。</div><div class="line">    max-height: @line-height * 7; ## 增加这个，控制了菜单的最大高度。</div><div class="line">    overflow: visible;</div><div class="line">    text-align: center;</div><div class="line">    display: -webkit-box;</div><div class="line">    -webkit-box-orient: horizontal;</div><div class="line">    -webkit-box-pack: center;</div><div class="line">    -webkit-box-align: center;</div><div class="line">    li&#123;</div><div class="line">        cursor: default;</div><div class="line">        a&#123;</div><div class="line">            font-size: (14/16)rem;</div><div class="line">            min-width: left-col-width;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最后的效果如下：</p>
<center><img src="http://static.zybuluo.com/shenyuflying/9wmd7ty8zmzysvltpy2o0p3s/image_1b6ijg51it7m1512m9m12331h8k9.png" alt="image_1b6ijg51it7m1512m9m12331h8k9.png-125.7kB"></center>

<p>如果还想看到更多此类文章，请移步到<a href="http://shenyu.wiki">小宇的博客</a>。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/技术分享/">技术分享</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hexo/">hexo</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/网站/">网站</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-PostgreSQL中的PL-SQL实现" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/13/PostgreSQL中的PL-SQL实现/" class="article-date">
      <time datetime="2017-01-13T01:15:30.000Z" itemprop="datePublished">2017-01-13</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/13/PostgreSQL中的PL-SQL实现/">PostgreSQL中的PL/SQL实现</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="基本流程"><a href="#基本流程" class="headerlink" title="基本流程"></a>基本流程</h2><ol>
<li>函数创建<br>1.1 create function的语法解析<br>1.2 创建plsql函数 ProcessUtility-&gt;CreateFunction-&gt;CreateProcedure</li>
<li>调用plsql函数<br>2.1 编译<br>2.2 执行</li>
</ol>
<h2 id="函数创建"><a href="#函数创建" class="headerlink" title="函数创建"></a>函数创建</h2><h3 id="create-function的语法解析"><a href="#create-function的语法解析" class="headerlink" title="create function的语法解析"></a>create function的语法解析</h3><p>创建plsql存储过程的基本语法：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">create</span> [<span class="keyword">or</span> <span class="keyword">replace</span>] <span class="keyword">function</span> &lt;fname&gt;</div><div class="line">		[(&lt;<span class="keyword">type</span><span class="number">-1</span>&gt; &#123; , &lt;<span class="keyword">type</span>-n&gt;&#125;)]</div><div class="line">		<span class="keyword">returns</span> &lt;<span class="keyword">type</span>-r&gt;</div><div class="line">		<span class="keyword">as</span> &lt;filename <span class="keyword">or</span> code <span class="keyword">in</span> <span class="keyword">language</span> <span class="keyword">as</span> appropriate&gt;</div><div class="line">		<span class="keyword">language</span> &lt;lang&gt; [<span class="keyword">with</span> <span class="keyword">parameters</span>]</div></pre></td></tr></table></figure></p>
<p>对应到实现gram.y:6770 中有<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">CreateFunctionStmt:</div><div class="line">			CREATE opt_or_replace FUNCTION func_name func_args_with_defaults</div><div class="line">			RETURNS func_return createfunc_opt_list opt_definition</div><div class="line">				&#123;</div><div class="line">					CreateFunctionStmt *n = makeNode(CreateFunctionStmt);</div><div class="line">					n-&gt;replace = $2;</div><div class="line">					n-&gt;funcname = $4;</div><div class="line">					n-&gt;parameters = $5;</div><div class="line">					n-&gt;returnType = $7;</div><div class="line">					n-&gt;options = $8;</div><div class="line">					n-&gt;withClause = $9;</div><div class="line">					$$ = (Node *)n;</div></pre></td></tr></table></figure></p>
<p>可以看到是主要解析如下内容：</p>
<ol>
<li>func_name 函数名</li>
<li>fuc_args 参数</li>
<li>fuc_return 返回值</li>
<li>createfunc_opt_list 内容，对于plsql来说</li>
</ol>
<h3 id="插入系统表"><a href="#插入系统表" class="headerlink" title="插入系统表"></a>插入系统表</h3><p>解析完了之后调用CreateFunction函数来实现实际的创建，然后调用ProcedureCreate来插入系统表pg_proc中<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function">ObjectAddress</span></div><div class="line"><span class="title">CreateFunction</span><span class="params">(CreateFunctionStmt *stmt,  <span class="comment">//入参就是语法解析返回的结构体</span></span></div><div class="line">                <span class="keyword">const</span> <span class="keyword">char</span> *queryString)</div><div class="line">&#123;</div><div class="line">...做一些检查和转换</div><div class="line">ProcedureCreate() <span class="comment">//来完成实际的创建工作，其实就是插入到了系统表pg_proc</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注意：此时只是把plsql的文本存下来了，并没有编译。编译会在后续进行</p>
<h2 id="调用plsql函数"><a href="#调用plsql函数" class="headerlink" title="调用plsql函数"></a>调用plsql函数</h2><p>plpgsql语言对应的处理函数，已经在系统初始化时通过脚本加载。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./backend/catalog/postgres.bki:insert ( <span class="string">"plpgsql"</span> t t <span class="string">"plpgsql_call_handler"</span> <span class="string">"plpgsql_inline_handler"</span> <span class="string">"plpgsql_validator"</span> <span class="string">"$libdir/plpgsql"</span> <span class="number">_</span>null_ )</div></pre></td></tr></table></figure></p>
<p>所以，当调用plsql函数就会调用相应的处理程序。相关函数在pl_handler.c文件中。<br>在该文件中我们看到如下函数：</p>
<p>_PG_init  系统启动加载plpgsql.so动态链接库之后，即调用该函数完成一系列初始化工作<br>plpgsql_call_handler 编译执行plsql函数<br>plpgsql_inline_handler 编译执行plsql匿名块<br>plpgsql_validator 在Create Function时检验函数的有效性</p>
<p>可以看到，当用户调用plsql函数时就会进入plpgsql_call_handler函数中,经过精简的函数如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function">Datum</span></div><div class="line"><span class="title">plpgsql_call_handler</span><span class="params">(PG_FUNCTION_ARGS)</span></div><div class="line">&#123;</div><div class="line">...</div><div class="line">	SPI_connect()  <span class="comment">// SPI 用于实际执行sql语句</span></div><div class="line"></div><div class="line">	func = plpgsql_compile(fcinfo, <span class="literal">false</span>); <span class="comment">// 编译plsql</span></div><div class="line">...</div><div class="line">	retval = plpgsql_exec_function(func, fcinfo, <span class="literal">NULL</span>); <span class="comment">//执行plsql</span></div><div class="line">...</div><div class="line">	SPI_finish() <span class="comment">// 断开SPI</span></div><div class="line">	<span class="keyword">return</span> retval;</div></pre></td></tr></table></figure>
<h2 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function">PLpgSQL_function *</span></div><div class="line"><span class="title">plpgsql_compile</span><span class="params">(FunctionCallInfo fcinfo, <span class="keyword">bool</span> forValidator)</span></div><div class="line">&#123;</div><div class="line">...</div><div class="line">先看hash表里面有没缓存，以及缓存是否失效，如果有效则直接返回，不用再编译啦。</div><div class="line">否则需要编译，调用do_compile()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> PLpgSQL_function *</span></div><div class="line"><span class="title">do_compile</span><span class="params">(FunctionCallInfo fcinfo,</span></div><div class="line">		   HeapTuple procTup,</div><div class="line">		   PLpgSQL_function *function,</div><div class="line">		   PLpgSQL_func_hashkey *hashkey,</div><div class="line">		   <span class="keyword">bool</span> forValidator)</div><div class="line">&#123;</div><div class="line">	plpgsql_scanner_init(proc_source); <span class="comment">// 这里的proc_source就是plsql函数文本</span></div><div class="line">	plpgsql_ns_init(); <span class="comment">// 初始化name stack</span></div><div class="line">	plpgsql_ns_push(NameStr(procStruct-&gt;proname), PLPGSQL_LABEL_BLOCK); <span class="comment">//name stack 中的第一个值就是proname</span></div><div class="line">	plpgsql_start_datums(); <span class="comment">// 初始化本地变量，默认先分配128个变量空间</span></div><div class="line">	plpgsql_resolve_polymorphic_argtypes(); <span class="comment">//解析函数参数</span></div><div class="line">	plpgsql_build_datatype(); <span class="comment">// 建立对应的数据类型</span></div><div class="line">	plpgsql_build_variable(); <span class="comment">// 分配入参的存储，加入变量空间，加入命名空间</span></div><div class="line">    plpgsql_build_variable(<span class="string">"found"</span>... <span class="comment">// 建立以后要用到的found变量</span></div><div class="line"> 	parse_rc = plpgsql_yyparse(); <span class="comment">// 词法、语法解析</span></div><div class="line"> 	<span class="keyword">if</span> (plpgsql_DumpExecTree)</div><div class="line">		plpgsql_dumptree(function);  <span class="comment">// 调试模式:打出编译树</span></div><div class="line">	plpgsql_HashTableInsert(function, hashkey); <span class="comment">// 加到编译缓存里面</span></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ps：调试模式很有用，可以通过下面方式打开：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">CREATE FUNCTION less_than(a text, b text) RETURNS boolean AS $$</div><div class="line"># option dump</div><div class="line">BEGIN</div><div class="line">RETURN a &lt; b;</div><div class="line">END;</div><div class="line">$$ LANGUAGE plpgsql;</div></pre></td></tr></table></figure>
<p>在函数体里面加上# option dump即可。执行会显示出来<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">STATEMENT:  select less_than (1 ,2);</div><div class="line"></div><div class="line">Execution tree of successfully compiled PL/pgSQL function less_than(text,text):</div><div class="line"></div><div class="line">Function's data area:</div><div class="line">    entry 0: VAR $1               type text (typoid 25) atttypmod -1</div><div class="line">    entry 1: VAR $2               type text (typoid 25) atttypmod -1</div><div class="line">    entry 2: VAR found            type bool (typoid 16) atttypmod -1</div><div class="line"></div><div class="line">Function's statements:</div><div class="line">  3:BLOCK &lt;&lt;*unnamed*&gt;&gt;</div><div class="line">  4:  RETURN 'SELECT a &lt; b'</div><div class="line">    END -- *unnamed*</div><div class="line"></div><div class="line">End of execution tree of function less_than(text,text)</div></pre></td></tr></table></figure></p>
<h3 id="语法解析"><a href="#语法解析" class="headerlink" title="语法解析"></a>语法解析</h3><p>postgreSQL 9.5的用户文档<br><a href="https://www.postgresql.org/docs/9.5/static/plpgsql.html" target="_blank" rel="external">https://www.postgresql.org/docs/9.5/static/plpgsql.html</a><br>可以对照用法来看实现<br>一个plsql形如<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[ &lt;&lt;label&gt;&gt; ]         -- [标签，可选]</div><div class="line">[ DECLARE             -- [DELARE开头</div><div class="line">    declarations ]    -- 中间是变量的声明，这部分是可选的]</div><div class="line">BEGIN                 -- BEGIN</div><div class="line">    statements        -- 各语句</div><div class="line">END [ label ];        -- END [标签，可选]</div></pre></td></tr></table></figure></p>
<p>对应到实现<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">pl_block		: decl_sect K_BEGIN proc_sect exception_sect K_END opt_label</div><div class="line">					&#123;</div><div class="line">						PLpgSQL_stmt_block *<span class="keyword">new</span>;</div><div class="line"></div><div class="line">						<span class="keyword">new</span> = palloc0(<span class="keyword">sizeof</span>(PLpgSQL_stmt_block));</div><div class="line">...各种成员填充</div><div class="line">						check_labels($<span class="number">1.l</span>abel, $<span class="number">6</span>, @<span class="number">6</span>);</div><div class="line">						plpgsql_ns_pop();</div><div class="line"></div><div class="line">						$$ = (PLpgSQL_stmt *)<span class="keyword">new</span>;</div><div class="line">					&#125;</div><div class="line">				;</div></pre></td></tr></table></figure></p>
<p>可以看到是按如下顺序解析的</p>
<ol>
<li>decl_sec 声明部分   –重点</li>
<li>prc_sec  语句部分   –重点</li>
<li>exception 异常部分</li>
<li>opt_label 标签部分<br>解析完成之后PLpgSQL_stmt_block强制转为一个PLpgSQL_stmt类型的结构返回，可以认为一个declare…begin…end对应一个PLpgSQL_stmt结构。</li>
</ol>
<h3 id="声明部分解析"><a href="#声明部分解析" class="headerlink" title="声明部分解析"></a>声明部分解析</h3><p>用户声明一个变量语法：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">name [ CONSTANT ] type [ COLLATE collation_name ] [ NOT NULL ] [ &#123; DEFAULT | := | = &#125; expression ];</div></pre></td></tr></table></figure></p>
<p>例子：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">quantity integer DEFAULT 32;</div><div class="line">url varchar := 'http://mysite.com';</div><div class="line">user_id CONSTANT integer := 10;</div></pre></td></tr></table></figure></p>
<p>先介绍下面两个全局变量用来存放plsql中的变量<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">PLpgSQL_datum **plpgsql_Datums;  <span class="comment">//变量数组</span></div><div class="line"><span class="keyword">int</span>			plpgsql_nDatums;     <span class="comment">//数组长度</span></div></pre></td></tr></table></figure></p>
<p>在pl_gram.y：478解析变量，并加入全局变量数组<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">decl_statement	: decl_varname decl_const decl_datatype decl_collate decl_notnull decl_defval</div><div class="line">		&#123;</div><div class="line">			PLpgSQL_variable	*var;</div><div class="line">...</div><div class="line">			var = plpgsql_build_variable($<span class="number">1.</span>name, $<span class="number">1.l</span>ineno,</div><div class="line">													 $<span class="number">3</span>, <span class="literal">true</span>);</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>对于解析的变量，加到变量数组里面<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function">PLpgSQL_variable *</span></div><div class="line"><span class="title">plpgsql_build_variable</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *refname, <span class="keyword">int</span> lineno, PLpgSQL_type *dtype,</span></div><div class="line">					   <span class="keyword">bool</span> add2namespace)</div><div class="line">&#123;</div><div class="line">	PLpgSQL_variable *result;</div><div class="line"></div><div class="line">	<span class="keyword">switch</span> (dtype-&gt;ttype)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">case</span> PLPGSQL_TTYPE_SCALAR:</div><div class="line">			&#123;</div><div class="line">				<span class="comment">/* Ordinary scalar datatype */</span></div><div class="line">				PLpgSQL_var *var;</div><div class="line">...</div><div class="line">				plpgsql_adddatum((PLpgSQL_datum *) var);</div><div class="line">				<span class="keyword">if</span> (add2namespace)</div><div class="line">					plpgsql_ns_additem(PLPGSQL_NSTYPE_VAR,</div><div class="line">									   var-&gt;dno,</div><div class="line">									   refname);</div><div class="line">				result = (PLpgSQL_variable *) var;</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>变量解析重点关注<br>decl_varname    – 变量名解析<br>decl_datatype   – 变量类型解析</p>
<h3 id="语句部分解析"><a href="#语句部分解析" class="headerlink" title="语句部分解析"></a>语句部分解析</h3><p>可以看到如下，是按每个语句规则匹配，不再详细展开了。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">proc_stmt		: pl_block <span class="string">';'</span></div><div class="line">						&#123; $$ = $<span class="number">1</span>; &#125;</div><div class="line">				| stmt_assign</div><div class="line">						&#123; $$ = $<span class="number">1</span>; &#125;</div><div class="line">				| stmt_if</div><div class="line">						&#123; $$ = $<span class="number">1</span>; &#125;</div><div class="line">				| stmt_case</div><div class="line">						&#123; $$ = $<span class="number">1</span>; &#125;</div><div class="line">				| stmt_loop</div><div class="line">						&#123; $$ = $<span class="number">1</span>; &#125;</div><div class="line">				| stmt_while</div><div class="line">						&#123; $$ = $<span class="number">1</span>; &#125;</div><div class="line">				| stmt_for</div><div class="line">						&#123; $$ = $<span class="number">1</span>; &#125;</div><div class="line">				| stmt_foreach_a</div><div class="line">						&#123; $$ = $<span class="number">1</span>; &#125;</div><div class="line">				| stmt_exit</div><div class="line">						&#123; $$ = $<span class="number">1</span>; &#125;</div><div class="line">				| stmt_return</div><div class="line">						&#123; $$ = $<span class="number">1</span>; &#125;</div><div class="line">				| stmt_raise</div><div class="line">						&#123; $$ = $<span class="number">1</span>; &#125;</div><div class="line">				| stmt_assert</div><div class="line">						&#123; $$ = $<span class="number">1</span>; &#125;</div><div class="line">				| stmt_execsql</div><div class="line">						&#123; $$ = $<span class="number">1</span>; &#125;</div><div class="line">				| stmt_dynexecute</div><div class="line">						&#123; $$ = $<span class="number">1</span>; &#125;</div><div class="line">				| stmt_perform</div><div class="line">						&#123; $$ = $<span class="number">1</span>; &#125;</div><div class="line">				| stmt_getdiag</div><div class="line">						&#123; $$ = $<span class="number">1</span>; &#125;</div><div class="line">				| stmt_open</div><div class="line">						&#123; $$ = $<span class="number">1</span>; &#125;</div><div class="line">				| stmt_fetch</div><div class="line">						&#123; $$ = $<span class="number">1</span>; &#125;</div><div class="line">				| stmt_move</div><div class="line">						&#123; $$ = $<span class="number">1</span>; &#125;</div><div class="line">				| stmt_close</div><div class="line">						&#123; $$ = $<span class="number">1</span>; &#125;</div><div class="line">				| stmt_null</div><div class="line">						&#123; $$ = $<span class="number">1</span>; &#125;</div><div class="line">				;</div></pre></td></tr></table></figure>
<h2 id="执行"><a href="#执行" class="headerlink" title="执行"></a>执行</h2><p>编译完了之后我们回到plpgsql_call_handler看到接下来要进入这个函数 plpgsql_exec_function来实际执行编译好的语句。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function">Datum</span></div><div class="line"><span class="title">plpgsql_exec_function</span><span class="params">(PLpgSQL_function *func, FunctionCallInfo fcinfo,</span></div><div class="line">					  EState *simple_eval_estate)</div><div class="line">&#123;</div><div class="line"></div><div class="line">	plpgsql_estate_setup();<span class="comment">//填充PLpgSQL_execstate estat结构体，该结构体里面保存了执行状态的基本信息。</span></div><div class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; estate.ndatums; i++)</div><div class="line">		estate.datums[i] = copy_plpgsql_datum(func-&gt;datums[i]); <span class="comment">//注意：这里把func里面的本地变量挨个拷贝到了estate  里面</span></div><div class="line">	...</div><div class="line">	把入参的值赋给对应的本地变量</div><div class="line">    ...</div><div class="line">    rc = exec_stmt_block(&amp;estate, func-&gt;action); <span class="comment">//实际执行阶段</span></div><div class="line">    </div><div class="line">    <span class="comment">// 对返回值进行处理</span></div></pre></td></tr></table></figure>
<p>接下来看看 exec_stmt_block 这个函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span></span></div><div class="line"><span class="title">exec_stmt_block</span><span class="params">(PLpgSQL_execstate *estate, PLpgSQL_stmt_block *block)</span></div><div class="line">&#123;</div><div class="line"></div><div class="line">    <span class="comment">// 先对本地变量进行初始化</span></div><div class="line">    rc = exec_stmts(estate, block-&gt;body); <span class="comment">//执行语句</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span></span></div><div class="line"><span class="title">exec_stmts</span><span class="params">(PLpgSQL_execstate *estate, List *stmts)</span></div><div class="line">&#123;</div><div class="line">	ListCell   *s;</div><div class="line"></div><div class="line">	foreach(s, stmts)  <span class="comment">// 遍历每个语句</span></div><div class="line">	&#123;</div><div class="line">		PLpgSQL_stmt *stmt = (PLpgSQL_stmt *) lfirst(s);</div><div class="line">		<span class="keyword">int</span>			rc = exec_stmt(estate, stmt);   <span class="comment">//执行一个单独的语句</span></div><div class="line"></div><div class="line">		<span class="keyword">if</span> (rc != PLPGSQL_RC_OK)</div><div class="line">			<span class="keyword">return</span> rc;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> PLPGSQL_RC_OK;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>exec_stmt 针对每种类型的语句来实际执行，可以看下列函数的源码，不再赘述。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span></span></div><div class="line"><span class="title">exec_stmt</span><span class="params">(PLpgSQL_execstate *estate, PLpgSQL_stmt *stmt)</span></div><div class="line">&#123;</div><div class="line">	PLpgSQL_stmt *save_estmt;</div><div class="line">	<span class="keyword">int</span>			rc = <span class="number">-1</span>;</div><div class="line"></div><div class="line">	save_estmt = estate-&gt;err_stmt;</div><div class="line">	estate-&gt;err_stmt = stmt;</div><div class="line"></div><div class="line">	<span class="comment">/* Let the plugin know that we are about to execute this statement */</span></div><div class="line">	<span class="keyword">if</span> (*plpgsql_plugin_ptr &amp;&amp; (*plpgsql_plugin_ptr)-&gt;stmt_beg)</div><div class="line">		((*plpgsql_plugin_ptr)-&gt;stmt_beg) (estate, stmt);</div><div class="line"></div><div class="line">	CHECK_FOR_INTERRUPTS();</div><div class="line"></div><div class="line">	<span class="keyword">switch</span> ((<span class="keyword">enum</span> PLpgSQL_stmt_types) stmt-&gt;cmd_type)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">case</span> PLPGSQL_STMT_BLOCK:</div><div class="line">			rc = exec_stmt_block(estate, (PLpgSQL_stmt_block *) stmt);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line"></div><div class="line">		<span class="keyword">case</span> PLPGSQL_STMT_ASSIGN:</div><div class="line">			rc = exec_stmt_assign(estate, (PLpgSQL_stmt_assign *) stmt);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line"></div><div class="line">		<span class="keyword">case</span> PLPGSQL_STMT_PERFORM:</div><div class="line">			rc = exec_stmt_perform(estate, (PLpgSQL_stmt_perform *) stmt);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line"></div><div class="line">		<span class="keyword">case</span> PLPGSQL_STMT_GETDIAG:</div><div class="line">			rc = exec_stmt_getdiag(estate, (PLpgSQL_stmt_getdiag *) stmt);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line"></div><div class="line">		<span class="keyword">case</span> PLPGSQL_STMT_IF:</div><div class="line">			rc = exec_stmt_if(estate, (PLpgSQL_stmt_if *) stmt);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line"></div><div class="line">		<span class="keyword">case</span> PLPGSQL_STMT_CASE:</div><div class="line">			rc = exec_stmt_case(estate, (PLpgSQL_stmt_case *) stmt);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line"></div><div class="line">		<span class="keyword">case</span> PLPGSQL_STMT_LOOP:</div><div class="line">			rc = exec_stmt_loop(estate, (PLpgSQL_stmt_loop *) stmt);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line"></div><div class="line">		<span class="keyword">case</span> PLPGSQL_STMT_WHILE:</div><div class="line">			rc = exec_stmt_while(estate, (PLpgSQL_stmt_while *) stmt);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line"></div><div class="line">		<span class="keyword">case</span> PLPGSQL_STMT_FORI:</div><div class="line">			rc = exec_stmt_fori(estate, (PLpgSQL_stmt_fori *) stmt);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line"></div><div class="line">		<span class="keyword">case</span> PLPGSQL_STMT_FORS:</div><div class="line">			rc = exec_stmt_fors(estate, (PLpgSQL_stmt_fors *) stmt);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line"></div><div class="line">		<span class="keyword">case</span> PLPGSQL_STMT_FORC:</div><div class="line">			rc = exec_stmt_forc(estate, (PLpgSQL_stmt_forc *) stmt);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line"></div><div class="line">		<span class="keyword">case</span> PLPGSQL_STMT_FOREACH_A:</div><div class="line">			rc = exec_stmt_foreach_a(estate, (PLpgSQL_stmt_foreach_a *) stmt);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line"></div><div class="line">		<span class="keyword">case</span> PLPGSQL_STMT_EXIT:</div><div class="line">			rc = exec_stmt_exit(estate, (PLpgSQL_stmt_exit *) stmt);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line"></div><div class="line">		<span class="keyword">case</span> PLPGSQL_STMT_RETURN:</div><div class="line">			rc = exec_stmt_return(estate, (PLpgSQL_stmt_return *) stmt);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line"></div><div class="line">		<span class="keyword">case</span> PLPGSQL_STMT_RETURN_NEXT:</div><div class="line">			rc = exec_stmt_return_next(estate, (PLpgSQL_stmt_return_next *) stmt);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line"></div><div class="line">		<span class="keyword">case</span> PLPGSQL_STMT_RETURN_QUERY:</div><div class="line">			rc = exec_stmt_return_query(estate, (PLpgSQL_stmt_return_query *) stmt);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line"></div><div class="line">		<span class="keyword">case</span> PLPGSQL_STMT_RAISE:</div><div class="line">			rc = exec_stmt_raise(estate, (PLpgSQL_stmt_raise *) stmt);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line"></div><div class="line">		<span class="keyword">case</span> PLPGSQL_STMT_ASSERT:</div><div class="line">			rc = exec_stmt_assert(estate, (PLpgSQL_stmt_assert *) stmt);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line"></div><div class="line">		<span class="keyword">case</span> PLPGSQL_STMT_EXECSQL:</div><div class="line">			rc = exec_stmt_execsql(estate, (PLpgSQL_stmt_execsql *) stmt);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line"></div><div class="line">		<span class="keyword">case</span> PLPGSQL_STMT_DYNEXECUTE:</div><div class="line">			rc = exec_stmt_dynexecute(estate, (PLpgSQL_stmt_dynexecute *) stmt);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line"></div><div class="line">		<span class="keyword">case</span> PLPGSQL_STMT_DYNFORS:</div><div class="line">			rc = exec_stmt_dynfors(estate, (PLpgSQL_stmt_dynfors *) stmt);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line"></div><div class="line">		<span class="keyword">case</span> PLPGSQL_STMT_OPEN:</div><div class="line">			rc = exec_stmt_open(estate, (PLpgSQL_stmt_open *) stmt);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line"></div><div class="line">		<span class="keyword">case</span> PLPGSQL_STMT_FETCH:</div><div class="line">			rc = exec_stmt_fetch(estate, (PLpgSQL_stmt_fetch *) stmt);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line"></div><div class="line">		<span class="keyword">case</span> PLPGSQL_STMT_CLOSE:</div><div class="line">			rc = exec_stmt_close(estate, (PLpgSQL_stmt_close *) stmt);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line"></div><div class="line">		<span class="keyword">default</span>:</div><div class="line">			estate-&gt;err_stmt = save_estmt;</div><div class="line">			elog(ERROR, <span class="string">"unrecognized cmdtype: %d"</span>, stmt-&gt;cmd_type);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/* Let the plugin know that we have finished executing this statement */</span></div><div class="line">	<span class="keyword">if</span> (*plpgsql_plugin_ptr &amp;&amp; (*plpgsql_plugin_ptr)-&gt;stmt_end)</div><div class="line">		((*plpgsql_plugin_ptr)-&gt;stmt_end) (estate, stmt);</div><div class="line"></div><div class="line">	estate-&gt;err_stmt = save_estmt;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> rc;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/技术分享/">技术分享</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PLSQL/">PLSQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PostgreSQL/">PostgreSQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据库/">数据库</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-PostgreSQL逻辑备份还原" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/12/PostgreSQL逻辑备份还原/" class="article-date">
      <time datetime="2017-01-12T09:27:58.000Z" itemprop="datePublished">2017-01-12</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/12/PostgreSQL逻辑备份还原/">PostgreSQL逻辑备份还原</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <h1 id="主要内容"><a href="#主要内容" class="headerlink" title="主要内容"></a>主要内容</h1><h2 id="pg-dump"><a href="#pg-dump" class="headerlink" title="pg_dump"></a>pg_dump</h2><ol>
<li>pg_dump 参数解析</li>
<li>pg_dump 基本流程</li>
<li>pg_dump 中的事务</li>
</ol>
<h2 id="pg-restore"><a href="#pg-restore" class="headerlink" title="pg_restore"></a>pg_restore</h2><ol>
<li>pg_restore 参数解析</li>
<li>pg_restore 基本流程</li>
<li>pg_restore 中的事务</li>
</ol>
<h2 id="补充内容"><a href="#补充内容" class="headerlink" title="补充内容"></a>补充内容</h2><ol>
<li>时间紧迫的情况下如何尽快会恢复</li>
<li>并行备份/恢复</li>
<li>其他的备份方式</li>
<li>思考</li>
<li>FAQ</li>
</ol>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/技术分享/">技术分享</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PostgreSQL/">PostgreSQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PostgreSQL内核/">PostgreSQL内核</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/备份还原/">备份还原</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据库/">数据库</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/2017/01/12/PostgreSQL逻辑备份还原/#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-【小宇带你学PostgreSQL内核】第五课：rewriter分析和重写（上）" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/08/【小宇带你学PostgreSQL内核】第五课：rewriter分析和重写（上）/" class="article-date">
      <time datetime="2017-01-08T16:23:14.000Z" itemprop="datePublished">2017-01-08</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/08/【小宇带你学PostgreSQL内核】第五课：rewriter分析和重写（上）/">【小宇带你学PostgreSQL内核】第五课：rewriter分析和重写（上）</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <center><iframe height="498" width="510" src="http://player.youku.com/embed/XMTk0NDk1OTQ2MA==" frameborder="0" 'allowfullscreen'=""></iframe></center>

<p>如果还想看到更多此类文章，请移步到<a href="http://shenyu.wiki">小宇的博客</a>。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/视频/">视频</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PostgreSQL/">PostgreSQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PostgreSQL内核/">PostgreSQL内核</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/小宇带你学PostgreSQL内核/">小宇带你学PostgreSQL内核</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据库/">数据库</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/语言层/">语言层</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-git统计代码贡献" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/05/git统计代码贡献/" class="article-date">
      <time datetime="2017-01-05T09:09:02.000Z" itemprop="datePublished">2017-01-05</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/05/git统计代码贡献/">git统计代码贡献</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <blockquote>
<p>辛苦了一年，到年终总结的时候啦。想统计一下今年贡献了多少代码。那么怎么用git来统计某个作者贡献代码行数呢？</p>
</blockquote>
<p>思路是采用git log打出来每次提交的信息。可以加上<code>--author</code>参数来指明是哪个作者的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ git log   --pretty=format:&apos;%an %Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr)%Creset&apos; --abbrev-commit --date=relative --shortstat --author=&quot;Shen&quot;</div></pre></td></tr></table></figure></p>
<p>打出来的结果如下所示：</p>
<center> <img src="http://static.zybuluo.com/shenyuflying/x2n5fklgimkamh9mulxlcj61/image_1b5jmt36dc6f1tj412mi173i1kcr9.png" alt="image_1b5jmt36dc6f1tj412mi173i1kcr9.png-116.2kB"> </center>

<p>能够看到每次提交的代码变更行数，接下来祭出grep和awk神器来做下统计吧！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ git log   --pretty=format:&apos;%Cred%h%Creset %an-%C(yellow)%d%Creset %s %Cgreen(%cr)%Creset&apos; --abbrev-commit --date=relative --shortstat --author=&quot;Shen&quot; |grep &quot;insertions&quot; |awk &apos;&#123;sum += $4 + $6&#125; END &#123;print sum&#125;&apos;</div><div class="line">7185</div></pre></td></tr></table></figure></p>
<p>在这个分支上贡献了7185行代码，再接再厉！</p>
<p>如果还想看到更多此类文章，请移步到<a href="http://shenyu.wiki">小宇的博客</a>。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/技术分享/">技术分享</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/">git</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/工具/">工具</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2014-2017 小宇
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





    <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>